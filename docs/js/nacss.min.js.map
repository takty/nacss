{"version":3,"sources":["nacss.js"],"names":["window","NS","initializeQuerySelector","s","initialize","document","querySelector","initializeQuerySelectorAll","ts","querySelectorAll","t","target","is","Array","from","getElementsByTagName","tis","ifs","NACSS","delayImage","filter","e","includes","delayIframe","figs","ss","contentImageAlt","contentFigureCaption","contentIframeAspect","contentUnderline","as","linkApply","CSS","supports","linkAnchorScroll","observedSelector","sgs","getElementsByClassName","h","push","jaSegmenter","properNouns","jaKerning","doAssignAttribute","doDisableOnSelecting","left","right","alignFloat","uls","listCustomized","tsc","tst","tabScroll","tabStack","tabs","tableNeatWidth","tableUsableView","if_os","os_ifs","fig_a","viewerIframe","viewerImage","scroll","hasClass","tar","cls","key","substr","startsWith","undefined","dataset","classList","contains","setClass","enabled","val","c","join","add","remove","getScrollOffset","getComputedStyle","documentElement","parseInt","scrollPaddingTop","Number","isNaN","throttle","fn","isRunning","args","requestAnimationFrame","resizeListeners","scrollListeners","onResize","doFirst","onIntersect","targets","threshold","rootMargin","vs","length","fill","tm","Map","forEach","i","set","mt","io","st","clearTimeout","setTimeout","disconnect","IntersectionObserver","es","get","isIntersecting","replace","observe","init","addEventListener","l","passive","tars","opts","Object","assign","styleAlign","classLeft","classRight","classCenter","minWidth","assignEventListener","aws","map","onScroll","storeWidth","update","style","aw","a","w","switchFloatOne","getBoundingClientRect","width","cw","contentWidth","parentElement","wn","origCls","checkDisplay","innerWidth","display","ph","parseFloat","paddingLeft","paddingRight","clientWidth","alt","src","trim","endsWith","substring","idx","lastIndexOf","navigator","userAgent","toLowerCase","fig","fcs","fc","innerHTML","fs","f","aspectRatio","extractIframeSize","height","sW","sH","indexOf","spans","styleList","span","setStyle","type","textDecorationLine","re","RegExp","getAttribute","match","removeAttribute","saveAttribute","at","v","setAttribute","restoreAttribute","isPolyfillNeeded","proto","BLANK_IMG","offset","blankImage","HTMLImageElement","prototype","hide","show","opacity","minHeight","delayImageIsNeeded","HTMLIFrameElement","contentDocument","location","delayIframeIsNeeded","removeHeadWhiteSpaces","str","mzs","removeTailWhiteSpaces","removeWhiteSpacesBetweenZenChars","g1","d","g2","styleKerning","styleDisabled","kernElement","dict","removeKerning","removeEventListener","elm","df","createDocumentFragment","childNodes","appendChild","parentNode","replaceChild","apply","ks","getKerning","createFragment","nodeType","kernTextNode","tn","isHead","isTail","isEnd","textContent","nt","nextSibling","innerText","parentNext","p","HTMLElement","pd","isSiblingBlock","pp","n","greedy","isPreviousBlockGreedy","previousSibling","isBlock","tagName","nextNodeText","assignAttr","strArray","ret","concat","c0","c1","has","k","isInteger","createTextNode","slice","createElement","Set","addPairs","cs0","cs1","addSolos","head","jaApplyKerning","sortProperNouns","styleSegment","segmentElement","removeSegment","sty","className","ws","getSegment","pns","sort","b","segmentTextNode","IW","split","AW","AI1","PRE_KANJI","PRE_NUM","createCharTypeArray","weightByCharTypes","strA","weightByPhrases","weightByPhraseAndType","CLS_ALL","CLS_WO_KANJI","CLS_ORIG","CHAR_PATTERNS","getCharType","test","PAIRS","II","KK","HH","NN","OO","TT","HI","NH","NK","NI","ON","NO","t0","t1","phrases","factor","phA","phL","bgn","idx0","indexOfArray","idx1","prevCts","nextCts","prevW","nextW","tsL","array","searchElement","fromIndex","j","temp","appendPhrase","isOriginalCharPhrase","isOrig","end","jaApplySegmenter","isUrlAnchor","url","outIsUp","id","getElementById","href","hash","top","styleLinkImage","styleLinkSimple","styleLinkAnchor","styleLinkExternal","styleLinkFile","allowedClasses","ALLOWED_CLASSES","extensionTable","EXT_TABLE","isUrlExternal","addClass","applyByUrl","addClassByUrl","doc","docx","xls","xlsx","ppt","pptx","pdf","isLinkImage","isLinkEmpty","isLinkSimple","isLinkSimpleUrl","ok","cs","getFileType","protocol","host","extTab","linkApplyByUrl","linkIsLinkImage","DURATION","isScrolling","anchorWithListener","duration","oes","mo","MutationObserver","rs","r","addedNodes","oe","childList","subtree","onClick","doClick","button","ctrlKey","shiftKey","altKey","metaKey","currentTarget","smoothScrollToHash","matchMedia","matches","stopPropagation","preventDefault","smoothScrollToElement","history","pushState","focus","start","pageYOffset","timeStart","posY","getScrollPos","wh","offsetHeight","loop","time","scrollTo","easing","spt","customizedType","doClearStyle","ul","listStyleType","styleEffect","getFirstHeading","container","children","createAnchor","title","spanning","styleBar","styleCurrent","styleActive","hashPrefix","inst","create","onHashChanged","getCurrentByHash","active","cont","cid","hs","extractHeaders","noHash","bars","bar","createBar","insertBefore","assignEvent","prefix","fh","curH","activate","li","clicked","y","innerHeight","getFirstVisible","find","maxHeightRate","doRemoveHeader","resize","scrollIntoView","behavior","getAnchorPage","ps","curIdx","extractHeadersAndPages","bar0","bar1","firstChild","isAccordion","findIndex","curP","removeChild","pointerEvents","scrollToTab","flexDirection","ul0","ul1","r0","bottom","r1","a0","a1","minH","getMinHeight","marginBtm","marginBottom","marginTop","mb","Math","max","lt","cm","fullWidthRate","cellMinWidth","cellMinAspect","cellMinLength","maxRowSize","maxBorderWidth","before","after","styleNeat","styleFull","styleScrollRight","styleScrollLeft","getCommonMetrics","padH","padV","dcTd","makeDummyCell","dcTh","tarTabs","noTarTabs","isTarget","gcCount","delay","removeDummyCell","initScroll","tab","td","paddingTop","paddingBottom","charW","lineH","getTextSize","nodeName","fontFamily","fontSize","clientHeight","cMat","cMet","rows","tr","hasChildNodes","ch","rob","ResizeObserver","scrollWidth","scrollLeft","grid","makeCellGrid","setCellWidth","calcNewWidths","getMetrics","css","collectCells","maxWidth","g","gr","tds","x","col","row","q","nr","origTabW","origCellWs","HTMLTableCellElement","met","gc","whiteSpace","gw","newWs","fixWs","minW","calcMinWidth","widenTabWidth","calcMaxLineLength","dc","ls","round","tempW","tempH","wNew","wFix","rem","nw","min","capableWindowHeightRate","styleHeaderContainer","styleHeaderTable","styleScrollBar","_createHeaderClone","_createBarClone","forced","el","op","onTableScroll","ro","doResize","contentRect","onWindowScroll","thead","tHead","_createPseudoHeader","hc","ht","cloneNode","trs","tBodies","containsOnlyTh","ths","trsH","createTHead","spacer","overflowX","_updateHeaderSize","_updateScrollBarSize","tw","hw","oTrs","cTrs","copyWidth","o","tag","os","disabled","getScrollBarWidth","tBottom","rh","hTop","hBottom","wY0","wY1","inView","tLeft","tScrollLeft","hCy","_updateHeaderVisibility","_updateBarVisibility","visible","tabLeft","tabScrollLeft","sL","offsetWidth","parent","getPropertyValue","overflowY","getBreakPointSize","bpW","bpH","getBrowser","ua","getDevice","styleRoot","styleCloser","stylePrev","styleNext","styleCaption","styleOpen","styleVisible","styleInstantly","createViewer","frameInst","frame","caption","opener","_onOpen","assignEventHandler","processHash","fi","currentId","cur","dlg","click","btnPrev","btnNext","doClose","state","doOpen","checkHash","ih","instanceCount","prevInstance","_onClose","btn","divCap","body","_setAdjacentInstance","instantly","replaceState","prev","_setNextInstance","next","newUrl","name","back","calcHash","asHex","charCodeAt","toString","getTouchPoint","pxo","pageXOffset","pyo","pageX","pageY","touchDistance","x1","screenX","y1","screenY","x2","y2","sqrt","pow","preventWindowTouchMove","isTouching","stopImmediatePropagation","getCursorPoint","initializeImageViewer","styleOpener","styleOpenerWrapper","createImageFrame","extractImageCaption","assignImageOpenerStyle","styleImageFrame","styleLoaded","maxZoomRate","scale","realScale","baseSize","isLs","margin","frm","img","_enableMouseGesture","_enableTouchGesture","setSize","setSource","winAs","imgAs","outlineWidth","nbs","naturalWidth","naturalHeight","_doCenteringImage","_setScaledSize","size","imgW","imgH","frmW","frmH","xS","yS","isMoving","zoomListener","cx","cy","ix","iy","scrollTop","deltaY","lastTouchCount","baseDist","updatePoint","fsx","fsy","touchPointToImagePoint","touches","dist","Infinity","initializeIframeViewer","ifms","createIframeFrame","assignIframeOpenerStyle","ifm","styleIframeFrame","filterSource","pause","hasAttribute","contentWindow","postMessage","URL","URLSearchParams","search","append"],"mappings":"AAUA,aAEAA,OAAM,MAAYA,OAAM,OAAa,GAGrC,SAAWC,GAEV,CAWC,SAASC,EAAwBC,GAEhCC,EADUC,SAASC,cAAcH,IAIlC,SAASI,EAA2BJ,GACnC,MAAMK,EAAKH,SAASI,iBAAiBN,GACrC,IAAK,MAAMO,KAAKF,EAAIJ,EAAWM,GAGhC,SAASN,EAAWO,GAGnB,MAAMC,EAAMC,MAAMC,KAAKH,EAAOI,qBAAqB,QAC7CC,EAAMH,MAAMC,KAAKH,EAAOF,iBAAiB,cACzCQ,EAAMJ,MAAMC,KAAKH,EAAOI,qBAAqB,WAEnDG,MAAMC,WAAWP,EAAGQ,QAAOC,IAAML,EAAIM,SAASD,MAC9CH,MAAMK,YAAYN,GAIlB,MAAMO,EAAOb,EAAOI,qBAAqB,UACnCU,EAAOd,EAAOI,qBAAqB,QAEzCG,MAAMQ,gBAAgBd,GACtBM,MAAMS,qBAAqBH,GAC3BN,MAAMU,oBAAoBX,GAC1BC,MAAMW,iBAAiBJ,GAIvB,MAAMK,EAAKnB,EAAOI,qBAAqB,KACvCG,MAAMa,UAAUD,GAEXE,IAAIC,SAAS,kBAAmB,WACpCf,MAAMgB,iBAAiBJ,EAAI,CAAEK,iBAAkB,SAKhD,MAAMC,EAAMvB,MAAMC,KAAKH,EAAO0B,uBAAuB,cACrD,IAAK,MAAMC,IAAK,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,CACnC,MAAM9B,EAAKG,EAAOF,iBAAkB,IAAG6B,kBACvC,IAAK,MAAM5B,KAAKF,EAAI4B,EAAIG,KAAK7B,GAG9BQ,MAAMsB,YAAYJ,EAAK,CAAEK,YAAa,KACtCvB,MAAMwB,UAAU,CAAC/B,GAAS,CAAEgC,mBAAmB,EAAOC,sBAAsB,IAI5E,MAAMC,EAAQhC,MAAMC,KAAKH,EAAO0B,uBAAuB,cACjDS,EAAQjC,MAAMC,KAAKH,EAAO0B,uBAAuB,eACvDnB,MAAM6B,WAAW,CAAEF,KAAAA,EAAMC,MAAAA,GAAS,IAIlC,MAAME,EAAMrC,EAAOI,qBAAqB,MACxCG,MAAM+B,eAAeD,GAIrB,MAAME,EAAMvC,EAAOF,iBAAiB,iCAC9B0C,EAAMxC,EAAOF,iBAAiB,yBACpCS,MAAMkC,UAAUF,GAChBhC,MAAMmC,SAASF,GAIf,MAAMG,EAAO3C,EAAOI,qBAAqB,SAEzCG,MAAMqC,eAAeD,GACrBpC,MAAMsC,gBAAgBF,GAItB,MAAMG,EAAS5C,MAAMC,KAAKH,EAAO0B,uBAAuB,kBAClDqB,EAAS7C,MAAMC,KAAKH,EAAOF,iBAAiB,4BAC5CkD,EAAS9C,MAAMC,KAAKH,EAAOF,iBAAiB,aAElDS,MAAM0C,aAAaH,EAAOC,GAC1BxC,MAAM2C,YAAYF,GAGlB,MAAMnD,EAAKG,EAAOF,iBAAiB,2BACnCS,MAAM4C,OAAOtD,GAGdP,EAAGC,wBAA6BA,EAChCD,EAAGM,2BAA6BA,EAejC,SAASwD,EAASC,EAAKC,GACtB,MAAMC,EAAMD,EAAIE,OAAO,GACvB,OAAIF,EAAIG,WAAW,UACUC,IAArBL,EAAIM,QAAQJ,GAEZF,EAAIO,UAAUC,SAASN,GAIhC,SAASO,EAAST,EAAKC,EAAKS,GAAU,EAAMC,EAAM,IACjD,MAAMT,EAAMD,EAAIE,OAAO,GACvB,GAAIF,EAAIG,WAAW,KACdM,EACHV,EAAIM,QAAQJ,GAAOS,SAEZX,EAAIM,QAAQJ,OAEd,CACN,MAAMU,EAAI,CAACV,EAAKS,GAAKE,KAAK,KACtBH,EACHV,EAAIO,UAAUO,IAAIF,GAElBZ,EAAIO,UAAUQ,OAAOH,IAuBxB,SAASI,IACR,MAAM7E,EAAM8E,iBAAiB5E,SAAS6E,iBAChCP,EAAMQ,SAAShF,EAAEiF,kBACvB,OAAOC,OAAOC,MAAMX,GAAO,EAAIA,EAOhC,SAASY,EAASC,GACjB,IAAIC,EACJ,MAAO,IAAIC,KACND,IACJA,GAAY,EACZE,uBAAsB,KACrBF,GAAY,EACZD,KAAME,QAKT,MAAME,EAAkB,GAClBC,EAAkB,GAExB,SAASC,EAASN,EAAIO,GAAU,GAC3BA,GAASP,IACbI,EAAgBrD,KAAKgD,EAASC,IAqB/B,SAASQ,EAAYR,EAAIS,EAASC,EAAY,EAAGC,EAAa,iBAC7D,MAAMC,EAAKvF,MAAMoF,EAAQI,QAAQC,MAAK,GAChCC,EAAK,IAAIC,IACfP,EAAQQ,SAAQ,CAAC/F,EAAGgG,IAAMH,EAAGI,IAAIjG,EAAGgG,KAUpC,IAAIE,EAAK,EACLC,EAAK,KACLC,EAAK,KACThB,GAAS,KACRc,GAAM5B,IACF8B,GAAIC,aAAaD,GACrBA,EAAKE,YAAW,KACXH,GAAIA,EAAGI,aACXJ,EAhBF,WACC,MAAMA,EAAK,IAAIK,sBAAsBC,IACpC,IAAK,MAAM9F,KAAK8F,EAAIf,EAAGG,EAAGa,IAAI/F,EAAEV,SAAWU,EAAEgG,eAC7C7B,EAAGY,KACD,CAAED,WAAYA,EAAWmB,QAAQ,IAAM,GAAEV,OAASV,UAAAA,IACrD,IAAK,MAAMxF,KAAKuF,EAASY,EAAGU,QAAQ7G,GACpC,OAAOmG,EAUDW,KACH,QACD,GApCJnH,SAASoH,iBAAiB,oBAAoB,KAC7CzH,OAAOyH,iBAAiB,UAAU,KACjC,IAAK,MAAMC,KAAK9B,EAAiB8B,MAC/B,CAAEC,SAAS,IACd3H,OAAOyH,iBAAiB,UAAU,KACjC,IAAK,MAAMC,KAAK7B,EAAiB6B,MAC/B,CAAEC,SAAS,OAoCf,CAWC,SAASvH,EAAWwH,EAAO,GAAIC,EAAO,KACrCD,EAAOE,OAAOC,OAAO,CAAElF,KAAM,GAAIC,MAAO,IAAM8E,IACtC,KAASvB,OAASuB,EAAI,MAAUvB,SAAW,IAEnDwB,EAAOC,OAAOC,OAAO,CACpBC,WAAa,WACbC,UAAa,YACbC,WAAa,aACbC,YAAa,cACbC,SAAa,KACXP,GAEHb,YAAW,KACVqB,EAAoBT,EAAI,KAAUC,EAAI,UAAeA,GACrDQ,EAAoBT,EAAI,MAAWC,EAAI,WAAgBA,KACrD,IAGJ,SAASQ,EAAoBvG,EAAImC,EAAK4D,GACrC,MAAMS,EAAMxG,EAAGyG,KAAIlH,GAAK,CAACA,EAAG,MA7E9B,SAAkBmE,EAAIO,GAAU,GAC3BA,GAASP,IACbK,EAAgBtD,KAAKgD,EAASC,IA4E7BgD,EAAS,IAAMC,EAAWH,EAAKrE,EAAK4D,KAAO,GAC3C/B,GAAS,IAAM4C,EAAOJ,EAAKrE,EAAK4D,KAAO,GAOxC,SAASY,EAAWH,EAAKK,EAAOd,GAC/B,IAAK,MAAMe,KAAMN,EAAK,CACrB,MAAOO,EAAGC,GAAKF,EACX,GAAKE,IACTC,EAAeF,GAAG,EAAOF,EAAOd,GAChCe,EAAG,GAAKC,EAAEG,wBAAwBC,MAClCF,EAAeF,GAAG,EAAMF,EAAOd,KAIjC,SAASa,EAAOJ,EAAKrE,EAAK4D,GACzB,IAAK,MAAMe,KAAMN,EAAK,CACrB,MAAOO,EAAGC,GAAKF,EACTM,EAAKC,EAAaN,EAAEO,eACpBC,EAAKR,EAAEG,wBAAwBC,MACjCI,EAAU,GAALH,GAAYJ,EAAIO,IACxBT,EAAG,GAAKS,GAGV,IAAK,MAAOR,EAAGC,KAAMR,EAAK,CAEzBS,EAAeF,EADJM,EAAaN,EAAEO,eAAe,GAClBN,EAAIjB,EAAKO,SAAUnE,EAAK4D,IAIjD,SAASkB,EAAeF,EAAGnE,EAAS4E,EAASzB,GACxCnD,IAAYX,EAAS8E,EAAGhB,EAAKG,cAChCvD,EAASoE,EAAGhB,EAAKG,YAAY,EAAMsB,GACnCT,EAAEtE,UAAUQ,OAAOuE,GACnBT,EAAEtE,UAAUO,IAAI+C,EAAKM,eAEjBzD,GAAWX,EAAS8E,EAAGhB,EAAKG,cAChCa,EAAEtE,UAAUQ,OAAO8C,EAAKM,aACxBU,EAAEtE,UAAUO,IAAIwE,GAChB7E,EAASoE,EAAGhB,EAAKG,YAAY,IAI/B,SAASmB,EAAa9H,EAAGkI,GAAe,GACvC,GAAU,OAANlI,EACH,OAAOrB,OAAOwJ,WAEf,MAAMrJ,EAAI8E,iBAAiB5D,GAC3B,GAAIkI,GAA8B,WAAdpJ,EAAEsJ,QACrB,OAAON,EAAa9H,EAAE+H,eAEvB,MAAMM,EAAKC,WAAWxJ,EAAEyJ,aAAeD,WAAWxJ,EAAE0J,cACpD,OAAOxI,EAAEyI,YAAcJ,EAGxBzJ,EAAG8C,WAAa3C,EAKjB,CAWC,SAASA,EAAWI,GACnB,IAAK,MAAME,KAAKF,EACf,IAAKE,EAAEqJ,KAAOrJ,EAAEsJ,IAAK,CACpB,IAAIA,EAAMtJ,EAAEsJ,IAAIC,OACZD,EAAIE,SAAS,OAAMF,EAAMA,EAAIG,UAAU,EAAGH,EAAI3D,OAAS,IAC3D,MAAM+D,EAAMJ,EAAIK,YAAY,KAC5B,IAAa,IAATD,EAAY,SAChB1J,EAAEqJ,IAAMC,EAAIG,UAAUC,EAAM,IAK/BnK,EAAGyB,gBAAkBtB,EAGtB,CAYC,SAASA,EAAWoB,GAEnB,GADWxB,OAAOsK,UAAUC,UAAUC,cAC/BlJ,SAAS,WACf,IAAK,MAAMmJ,KAAOjJ,EAAM,CACvBiJ,EAAI9B,MAAMM,MAAQ,GAElB,MAAMyB,EAAMD,EAAI1J,qBAAqB,cAC/B4J,EAAMD,EAAIrE,OAASqE,EAAI,GAAK,KAC9BC,IACHA,EAAGC,UAAa,SAAQD,EAAGC,qBAM/B3K,EAAG0B,qBAAuBvB,EAG3B,CAWC,SAASA,EAAWyK,GACnB,IAAK,MAAMC,KAAKD,EACf,IAAKC,EAAEnC,MAAMoC,YAAa,CACzB,MAAOjC,EAAGxG,GAAK0I,EAAkBF,GAC7BhC,GAAKxG,IACRwI,EAAEnC,MAAMoC,YAAe,GAAEjC,OAAOxG,MAMpC,SAAS0I,EAAkBF,GAC1B,IAAIhC,EAAI3D,SAAS2F,EAAE7B,OACf3G,EAAI6C,SAAS2F,EAAEG,QACnB,GAAInC,GAAKxG,EAAG,MAAO,CAACwG,EAAGxG,GAEvB,MAAM4I,EAAKJ,EAAEnC,MAAMM,MACbkC,EAAKL,EAAEnC,MAAMsC,OACnB,OAAIC,EAAGE,QAAQ,QAAUF,EAAG7E,OAAS,GACjC8E,EAAGC,QAAQ,QAAUD,EAAG9E,OAAS,EADU,CAAC,EAAG,IAEnDyC,EAAI3D,SAAS+F,GACb5I,EAAI6C,SAASgG,GACTrC,GAAKxG,EAAU,CAACwG,EAAGxG,GAChB,CAAC,EAAG,IAGZrC,EAAG2B,oBAAsBxB,EAG1B,CAWC,SAASA,EAAWiL,EAAOxD,EAAO,IACjCA,EAAOC,OAAOC,OAAO,CACpBuD,UAAW,gBACTzD,GAEH,IAAK,MAAM0D,KAAQF,EAClBG,EAASD,EAAM1D,GAIjB,SAAS2D,EAAS9K,EAAGmH,GACpB,MAAM4D,EAAO/K,EAAEiI,MAAM+C,mBACrB,GAAa,cAATD,EAAsB,CACzB,MAAME,EAAK,IAAIC,OAAO,2BAA6BH,EAAO,SAAU,MAChE/K,EAAEmL,aAAa,SAASC,MAAMH,GACjCjL,EAAEqL,gBAAgB,SAElBrL,EAAEiI,MAAM+C,mBAAqB,GAE9BjH,EAAS/D,EAAGmH,EAAKyD,YAInBrL,EAAG4B,iBAAmBzB,EAKvB,CAWC,SAAS4L,EAActL,EAAGuL,EAAIlC,EAAM,MACnC,MAAMmC,EAAIxL,EAAEmL,aAAaI,GACrBC,IACHxL,EAAE4D,QAAQ2H,GAAMC,EACZnC,EACHrJ,EAAEyL,aAAaF,EAAIlC,GAEnBrJ,EAAEqL,gBAAgBE,IAKrB,SAASG,EAAiB1L,EAAGuL,GAC5B,MAAMC,EAAIxL,EAAE4D,QAAQ2H,GAChBC,IACHxL,EAAEyL,aAAaF,EAAIC,UACZxL,EAAE4D,QAAQ2H,IAInB,SAASI,EAAiBC,GACzB,QAAU,YAAaA,GAIxB,CAWC,MAAMC,EAAY,yEAGlB,SAASnM,EAAWI,EAAIqH,EAAO,IAC9B,GAAkB,IAAdrH,EAAG6F,OAAP,CAOA,GALAwB,EAAOC,OAAOC,OAAO,CACpByE,OAAY,IACZC,WAAYF,GACV1E,GAECwE,EAAiBK,iBAAiBC,WAAY,CACjD,IAAK,MAAMjM,KAAKF,EACfoM,EAAKlM,EAAGmH,EAAI,YAEb7B,GAAYI,IACX,IAAK,IAAIM,EAAI,EAAGA,EAAIlG,EAAG6F,OAAQK,GAAK,EAAG,CACtC,MAAMhG,EAAIF,EAAGkG,GACThG,EAAE4D,QAAQ0F,KAAO5D,EAAGM,IACvBmG,EAAKnM,MAGLF,EAAI,EAAI,SAAQqH,EAAI,gBAGxB7H,OAAOyH,iBAAiB,eAAe,KACtC,IAAK,MAAM/G,KAAKF,EACXE,EAAE4D,QAAQ0F,KACb6C,EAAKnM,GAE4B,SAA9BA,EAAEmL,aAAa,YAClBnL,EAAEyL,aAAa,UAAW,YAG1B,IAGJ,SAASS,EAAKlM,EAAG+L,GAChBT,EAActL,EAAG,MAAO+L,GACxBT,EAActL,EAAG,UACjBA,EAAEiI,MAAMmE,QAAU,EAClB,MAAMxK,EAAI5B,EAAEmL,aAAa,UACrBvJ,IACH5B,EAAEiI,MAAMoE,UAAYzK,EAAI,MAI1B,SAASuK,EAAKnM,GACbA,EAAE+G,iBAAiB,QAAQ,KAC1B/G,EAAEiI,MAAMoE,UAAY,GACpBrM,EAAEiI,MAAMmE,QAAY,MAErBV,EAAiB1L,EAAG,OACpB0L,EAAiB1L,EAAG,UAGrBT,EAAGkB,WAAqBf,EACxBH,EAAG+M,mBAAqBX,EAGzB,CAWC,SAASjM,EAAWI,EAAIqH,EAAO,IAC9B,GAAkB,IAAdrH,EAAG6F,OAAP,CAMA,GAJAwB,EAAOC,OAAOC,OAAO,CACpByE,OAAQ,KACN3E,GAECwE,EAAiBY,kBAAkBN,WAAY,CAClD,IAAK,MAAMjM,KAAKF,EACfoM,EAAKlM,GAENsF,GAAYI,IACX,IAAK,IAAIM,EAAI,EAAGA,EAAIlG,EAAG6F,OAAQK,GAAK,EAAG,CACtC,MAAMhG,EAAIF,EAAGkG,GACThG,EAAE4D,QAAQ0F,KAAO5D,EAAGM,IACvBmG,EAAKnM,MAGLF,EAAI,EAAI,SAAQqH,EAAI,gBAGxB7H,OAAOyH,iBAAiB,eAAe,KACtC,IAAK,MAAM/G,KAAKF,EACXE,EAAE4D,QAAQ0F,KACb6C,EAAKnM,GAE4B,SAA9BA,EAAEmL,aAAa,YAClBnL,EAAEyL,aAAa,UAAW,YAG1B,IAGJ,SAASS,EAAKlM,GACbsL,EAActL,EAAG,OAGlB,SAASmM,EAAKnM,GACb,MAAMwL,EAAIxL,EAAE4D,QAAF,IACN4H,IACHxL,EAAEwM,gBAAgBC,SAAS7F,QAAQ4E,UAC5BxL,EAAE4D,QAAF,KAITrE,EAAGsB,YAAsBnB,EACzBH,EAAGmN,oBAAsBf,GAM3B,CAWC,SAASgB,EAAsBC,GAC9B,MAAMC,EAAMD,EAAIxB,MAAM,wBAEtB,OADYyB,GAAO,EAAIA,EAAIlH,OAAUkH,EAAI,GAAK,IAClCD,EAAIhG,QAAQ,QAAS,IAGlC,SAASkG,EAAsBF,GAC9B,OAAOA,EAAIhG,QAAQ,QAAS,IAG7B,SAASmG,EAAiCH,GAGzC,OAAOA,EAAIhG,QAAQ,sIAAsI,CAACwE,EAAO4B,EAAIC,EAAGC,IAAOF,EAAKE,IAIrL,CAWC,SAASxN,EAAWI,EAAIqH,EAAO,IAC9B,GAAkB,IAAdrH,EAAG6F,OAAP,CAEAwB,EAAOC,OAAOC,OAAO,CACpB8F,aAAsB,UACtBC,cAAsB,eACtBnL,mBAAsB,EACtBC,sBAAsB,GACpBiF,GAEH,IAAK,MAAMnH,KAAKF,EAEf,GADAuN,EAAYrN,EAAGsN,EAAMnG,GACjBA,EAAI,mBAAyBA,EAAI,qBAA0B,CAC9D,MAAMiD,EAAI,KACTmD,EAAcvN,EAAGmH,GACjBnH,EAAEwN,oBAAoB,cAAepD,IAEtCpK,EAAE+G,iBAAiB,cAAeqD,KAKrC,SAASmD,EAAcE,EAAKtG,GAC3B,IAAK,MAAM1H,KAAKU,MAAMC,KAAKqN,EAAIpN,qBAAqB,SACnD,GAAIgD,EAAS5D,EAAG0H,EAAKgG,cAAe,CACnC,MAAMO,EAAK/N,SAASgO,yBACpB,IAAK,MAAMzJ,KAAK/D,MAAMC,KAAKX,EAAEmO,YAC5BF,EAAGG,YAAY3J,GAEhBzE,EAAEqO,WAAWC,aAAaL,EAAIjO,IAKjC,SAASuO,EAAMpB,EAAKzF,EAAO,IAC1BA,EAAOC,OAAOC,OAAO,CACpB8F,aAAmB,UACnBC,cAAmB,eACnBnL,mBAAmB,GACjBkF,GAEH,MAAM8G,EAAKC,EAAWtB,EAAKU,GAAM,EAAOnG,EAAKlF,mBAC7C,OAAIgM,EAAGtI,OACCwI,EAAevB,EAAKqB,EAAI9G,GAEzB,KAOR,SAASkG,EAAYI,EAAKH,EAAMnG,GAC/B,IAAK,MAAMjD,KAAK/D,MAAMC,KAAKqN,EAAIG,YACX,IAAf1J,EAAEkK,SACA/K,EAASa,EAAGiD,EAAKiG,gBAAgBC,EAAYnJ,EAAGoJ,EAAMnG,GAClC,IAAfjD,EAAEkK,UACZC,EAAanK,EAAGoJ,EAAMnG,GAKzB,SAASkH,EAAaC,EAAIhB,EAAMnG,GAC/B,MAAOoH,EAAQC,GAAUC,EAAMH,GAE/B,IAAI1B,EAAM0B,EAAGI,YACTH,IAAQ3B,EAAMD,EAAsBC,IACpC4B,IAAQ5B,EAAME,EAAsBF,IACxCA,EAAMG,EAAiCH,GAEvC,IAAI+B,EAAK,GAIT,GAHIL,EAAGM,aAA2C,IAA5BN,EAAGM,YAAYR,UAA+D,WAA7C7J,iBAAiB+J,EAAGM,aAAa7F,UACvF4F,EAAKL,EAAGM,YAAYC,YAEhBP,EAAGM,aAAeN,EAAGR,WAAWc,YAAa,CACjD,MAAME,EAAaR,EAAGR,WAAWc,YACjC,GAA4B,IAAxBE,EAAWV,SAAgB,CAClB7J,iBAAiBuK,GAAY/F,QACjCnI,SAAS,YAChB+N,EAAKG,EAAWD,WAGU,IAAxBC,EAAWV,WACdO,EAAKG,EAAWJ,aAIlB,MAAMT,EAAKC,EAAWtB,EAAKU,EAAMiB,EAAQI,EAAIxH,EAAKlF,mBAClD,GAAIgM,EAAGtI,OAAQ,CACd,MAAMyE,EAAI+D,EAAevB,EAAKqB,EAAI9G,GAClCmH,EAAGR,WAAWC,aAAa3D,EAAGkE,IAIhC,SAASG,EAAMH,GACd,MAAMS,EAAIT,EAAGR,WACb,KAAMiB,aAAaC,aAAc,MAAO,EAAC,GAAO,GAChD,MAAMC,EAAK1K,iBAAiBwK,GAAGhG,QAC/B,IAAKkG,EAAGrO,SAAS,UAChB,OAAOsO,EAAeZ,GAEvB,GAAW,iBAAPW,EAAuB,CAC1B,GAA4B,IAAxBF,EAAEnB,WAAWjI,OAChB,OAAOuJ,EAAeZ,GAEvB,MAAMa,EAAKJ,EAAEjB,WACb,GAAIqB,EAAI,CAEP,IADY5K,iBAAiB4K,GAAIpG,QACxBnI,SAAS,UACjB,OAAOsO,EAAeH,GAAG,IAI5B,MAAO,EAAC,GAAO,GAGhB,SAASG,EAAeE,EAAGC,GAAS,GACnC,MAAO,CAACA,EAASC,EAAsBF,EAAEG,iBAAmBC,EAAQJ,EAAEG,iBAAkBC,EAAQJ,EAAER,cAGnG,SAASY,EAAQJ,GAChB,OAAU,OAANA,GACEA,aAAaJ,cACD,OAAdI,EAAEK,UACElL,iBAAiB6K,GAAGrG,QAAQnI,SAAS,WAG9C,SAAS0O,EAAsBF,GAC9B,OAAa,CACZ,GAAU,OAANA,EAAY,OAAO,EACvB,GAAmB,IAAfA,EAAEhB,SACL,MAAkB,OAAdgB,EAAEK,UACElL,iBAAiB6K,GAAGrG,QAAQnI,SAAS,UAE9C,GAAmB,IAAfwO,EAAEhB,WACAgB,EAAEV,YAAYnF,OAAQ,OAAO,EAEnC6F,EAAIA,EAAEG,iBAQR,SAASrB,EAAWtB,EAAKU,EAAMiB,EAAQmB,EAAcC,GACpD,IAAIC,EAAWzP,MAAMC,KAAKwM,GAC1B,MAAMiD,EAAM,GAERH,EAAa/J,SAChBiK,EAAWA,EAASE,OAAO3P,MAAMC,KAAKsP,KAEvC,IAAI1I,EAAI,EAER,IAAK,IAAIhB,EAAI,EAAGA,EAAI4J,EAASjK,OAAQK,GAAK,EAAG,CAC5C,MAAM+J,EAAKH,EAAS5J,GACdgK,EAAKJ,EAAS5J,EAAI,GAExB,IAAImC,EAAI,GACG,KAAP4H,GAAoB,KAAPC,GAAa1C,EAAK2C,IAAIF,EAAKC,KAC3C7H,EAAIwH,EAAa,IAAM,0BAEd,IAAN3J,GAAWuI,GAAiB,KAAPwB,GAAazC,EAAK2C,IAAIF,KAC9C5H,GAAKwH,EAAa,IAAM,sBAErBxH,EAAExC,QACDqB,IACH6I,EAAIhO,KAAKmF,GACTA,EAAI,GAEL6I,EAAIhO,KAAKsG,IAETnB,GAAK,EAIP,OADI6I,EAAIlK,QAAUqB,GAAG6I,EAAIhO,KAAKmF,GACvB6I,EAGR,SAAS1B,EAAevB,EAAKqB,EAAI9G,GAChC,MAAMyI,EAAWzP,MAAMC,KAAKwM,GACtBxC,EAAIzK,SAASgO,yBACnB,IAAI3H,EAAI,EACR,IAAK,MAAMkK,KAAKjC,EACf,GAAItJ,OAAOwL,UAAUD,GAAI,CACxB,MAAMd,EAAIzP,SAASyQ,eAAeR,EAASS,MAAMrK,EAAGA,EAAIkK,GAAG/L,KAAK,KAChEiG,EAAEyD,YAAYuB,GACdpJ,GAAKkK,MACC,CACN,MAAMd,EAAIzP,SAAS2Q,cAAc,QACjClB,EAAEvB,YAAYlO,SAASyQ,eAAeR,EAASS,MAAMrK,EAAGA,EAAI,GAAG7B,KAAK,MAChE+L,EAAEvK,QAAU,EACf5B,EAASqL,EAAGjI,EAAKgG,cAAc,EAAM+C,GAErCd,EAAEnH,MAAQiI,EAEX9F,EAAEyD,YAAYuB,GACdpJ,GAAK,EAGP,OAAOoE,EAOR,MAAMkD,EAAO,IAAIiD,IACjB,CAQC,SAASC,EAASlD,EAAMmD,EAAKC,GAC5B,IAAK,MAAMX,KAAMU,EAChB,IAAK,MAAMT,KAAMU,EAChBpD,EAAKlJ,IAAI2L,EAAKC,GAKjB,SAASW,EAASrD,EAAMsD,GACvB,IAAK,MAAMhP,KAAKgP,EACftD,EAAKlJ,IAAIxC,GAjBX4O,EAASlD,EAAM,WAAY,aAC3BkD,EAASlD,EAAM,YAAa,aAC5BkD,EAASlD,EAAM,YAAa,aAC5BkD,EAASlD,EAAM,YAAa,aAC5BkD,EAASlD,EAAM,YAAa,aAC5BqD,EAASrD,EAAM,aAiBhB/N,EAAGyC,UAAiBtC,EACpBH,EAAGsR,eAAiB7C,EAGrB,CAWC,SAAStO,EAAWI,EAAIqH,EAAO,IAC9B,GAAkB,IAAdrH,EAAG6F,OAAP,CAQAmL,EANA3J,EAAOC,OAAOC,OAAO,CACpB0J,aAAsB,GACtB3D,cAAsB,oBACtBlL,sBAAsB,EACtBH,YAAsB,IACpBoF,IAGH,IAAK,MAAMnH,KAAKF,EAEf,GADAkR,EAAehR,EAAGmH,GACdA,EAAI,qBAA0B,CACjC,MAAMiD,EAAI,KACT6G,EAAcjR,EAAGmH,GACjBnH,EAAEwN,oBAAoB,cAAepD,IAEtCpK,EAAE+G,iBAAiB,cAAeqD,KAKrC,SAAS6G,EAAcxD,EAAKtG,GAC3B,MAAM+J,EAAM/J,EAAK4J,aACjB,IAAK,MAAMtR,KAAKU,MAAMC,KAAKqN,EAAIpN,qBAAqB,SACnD,GAAoB,IAAf6Q,EAAIvL,QAAgC,KAAhBlG,EAAE0R,WAAqB9N,EAAS5D,EAAGyR,GAAM,CACjE,MAAMxD,EAAK/N,SAASgO,yBACpB,IAAK,MAAMzJ,KAAK/D,MAAMC,KAAKX,EAAEmO,YAC5BF,EAAGG,YAAY3J,GAEhBzE,EAAEqO,WAAWC,aAAaL,EAAIjO,IAKjC,SAASuO,EAAMpB,EAAKzF,EAAO,IAM1B2J,EALA3J,EAAOC,OAAOC,OAAO,CACpB0J,aAAe,GACf3D,cAAe,oBACfrL,YAAe,IACboF,IAGH,MAAOrH,EAAIsR,GAAMC,EAAWzE,EAAKzF,EAAKpF,aACtC,OAAOoM,EAAevB,EAAK9M,EAAIsR,EAAIjK,GAGpC,SAAS2J,EAAgB3J,GACxB,MAAMmK,EAAMnK,EAAI,YAAgBU,KAAIlH,GAAKR,MAAMC,KAAKO,KACpD2Q,EAAIC,MAAK,CAACpJ,EAAGqJ,IACLA,EAAE7L,OAASwC,EAAExC,SAErBwB,EAAI,YAAkBmK,EAOvB,SAASN,EAAevD,EAAKtG,GAC5B,IAAK,MAAMjD,KAAK/D,MAAMC,KAAKqN,EAAIG,YACX,IAAf1J,EAAEkK,SACA/K,EAASa,EAAGiD,EAAKiG,gBAAgB4D,EAAe9M,EAAGiD,GAC/B,IAAfjD,EAAEkK,UACZqD,EAAgBvN,EAAGiD,GAKtB,SAASsK,EAAgBnD,EAAInH,GAC5B,IAAIyF,EAAM0B,EAAGI,YACb9B,EAAMG,EAAiCH,GAEvC,MAAO9M,EAAIsR,GAAMC,EAAWzE,EAAKzF,EAAKpF,aAChCqI,EAAI+D,EAAevB,EAAK9M,EAAIsR,EAAIjK,GACtCmH,EAAGR,WAAWC,aAAa3D,EAAGkE,GAO/B,MAAMoD,EAAK,0lCAA0lCC,MAAM,KACrmCC,EAAK,0MAA0MD,MAAM,KAErNE,EAAY,4BAA4BF,MAAM,KAC9CG,EAAY,MAAMH,MAAM,KACxBI,EAAY,MAAMJ,MAAM,KAE9B,SAASN,EAAWzE,EAAK7K,GACxB,MAAMjC,EAAKkS,EAAoBpF,GACzBwE,EAAKjR,MAAML,EAAG6F,QAAQC,KAAK,GAEjCqM,EAAkBnS,EAAIsR,GAEtB,MAAMc,EAAO/R,MAAMC,KAAKwM,GASxB,OARI7K,EAAY4D,QAAQwM,EAAgBD,EAAMd,EAAIrP,GAAc,GAChEoQ,EAAgBD,EAAMd,EAAIM,GAAK,GAC/BS,EAAgBD,EAAMd,EAAIQ,EAAI,GAE9BO,EAAgBD,EAAMd,EAAIS,GAAM,EAAG,GACnCO,EAAsBF,EAAMpS,EAAIsR,EAAIU,EAAWO,EAAc,KAAM,EAAG,GACtED,EAAsBF,EAAMpS,EAAIsR,EAAIW,EAAWO,EAAc,IAAM,EAAG,GAE/D,CAACxS,EAAIsR,GAOb,MAAMkB,EAAe,WACfD,EAAe,YACfE,EAAe,MAEfC,EAAgB,CACrB,CAAC,IAAK,qBACN,CAAC,IAAK,qBACN,CAAC,IAAK,gBACN,CAAC,IAAK,WACN,CAAC,IAAK,gBACN,CAAC,IAAK,iDACN,CAAC,IAAK,aACN,CAAC,IAAK,QAGP,SAASR,EAAoBpF,GAC5B,MAAM9M,EAAK,GACX,IAAK,MAAMoE,KAAK0I,EACf9M,EAAG+B,KAAK4Q,EAAYvO,IAErB,OAAOpE,EAGR,SAAS2S,EAAYvO,GACpB,IAAK,MAAOlE,EAAG+O,KAAMyD,EACpB,GAAIzD,EAAE2D,KAAKxO,GAAI,OAAOlE,EAEvB,MAAO,IAOR,MAAM2S,EAAQ,CACb,MAAO,EAAG,KAAM,EAChB,KAAM,EACN,KAAM,GAAI,MAAO,GACjB,MAAO,EAAG,MAAO,EACjBC,GAAM,EAAGC,GAAM,EAAGC,GAAM,EAAIC,GAAM,EAAGC,GAAM,EAAGC,GAAM,EACpDC,GAAM,EACNC,GAAM,EAAGC,GAAM,EAAGC,GAAM,EACxBC,GAAM,EAAGC,GAAM,GAGhB,SAAStB,EAAkBnS,EAAIsR,GAC9B,IAAK,IAAIpL,EAAI,EAAGA,EAAIlG,EAAG6F,OAAQK,GAAK,EAAG,CACtC,MAAMwN,EAAK1T,EAAGkG,EAAI,GACZyN,EAAK3T,EAAGkG,GACdoL,EAAGpL,KAAO2M,EAAMa,EAAKC,IAAO,IAAMd,EAAM,IAAMc,IAAO,IAAMd,EAAMa,EAAK,MAAQ,IA2DhF,SAASrB,EAAgBD,EAAMd,EAAIsC,EAASC,EAAQ7H,EAAS,GAC5D,IAAK,MAAM9C,KAAM0K,EAAS,CACzB,MAAME,EAAMzT,MAAMC,KAAK4I,GACjB6K,EAAMD,EAAIjO,OAEhB,IAAK,IAAImO,EAAM,IAAK,CACnB,MAAMC,EAAOC,EAAa9B,EAAM0B,EAAKE,GACrC,IAAc,IAAVC,EAAa,MACjB,MAAME,EAAOF,EAAOF,EAEpBzC,EAAG2C,EAAOjI,KAAY+H,EAAM/H,GAAU6H,EACtC,IAAK,IAAI3N,EAAI,EAAGA,EAAI6N,EAAM/H,EAAQ9F,GAAK,EACtCoL,EAAG2C,EAAOjI,EAAS9F,IAAO6N,EAAM/H,EAEjCgI,EAAMG,IAKT,SAAS7B,EAAsBF,EAAMpS,EAAIsR,EAAIsC,EAASQ,EAASC,EAASC,EAAOC,GAC9E,MAAMC,EAAMxU,EAAG6F,OAEf,IAAK,MAAMqD,KAAM0K,EAAS,CACzB,MAAME,EAAMzT,MAAMC,KAAK4I,GACjB6K,EAAMD,EAAIjO,OAEhB,IAAK,IAAImO,EAAM,IAAM,CACpB,MAAMC,EAAOC,EAAa9B,EAAM0B,EAAKE,GACrC,IAAc,IAAVC,EAAa,MACjB,MAAME,EAAOF,EAAOF,EAEpB,IACW,IAATE,GAA0B,IAATA,GAAcG,EAAQtT,SAASd,EAAGiU,EAAO,OAC1DE,IAASK,GAAQL,EAAOK,GAAOH,EAAQvT,SAASd,EAAGmU,KACnD,CACD7C,EAAG2C,IAASK,EACRH,EAAO7C,EAAGzL,SAAQyL,EAAG6C,IAASI,GAClC,IAAK,IAAIrO,EAAI,EAAGA,EAAI6N,EAAK7N,GAAK,EAAGoL,EAAG2C,EAAO/N,IAAM6N,EAElDC,EAAMG,IAKT,SAASD,EAAaO,EAAOC,EAAeC,EAAY,GACvD,GAAIF,MAAAA,EACH,OAAQ,EAET,GAAqB,IAAjBA,EAAM5O,OACT,OAAO,EAER,IAAK,IAAIK,EAAIyO,EAAWzO,EAAIuO,EAAM5O,OAAS6O,EAAc7O,OAAS,EAAGK,GAAK,EAAG,CAC5E,IAAIoF,GAAQ,EAEZ,IAAK,IAAIsJ,EAAI,EAAGA,EAAIF,EAAc7O,OAAQ+O,GAAK,EAC9C,GAAIH,EAAMvO,EAAI0O,KAAOF,EAAcE,GAAI,CACtCtJ,GAAQ,EACR,MAGF,GAAIA,EACH,OAAOpF,EAGT,OAAQ,EAOT,SAASmI,EAAevB,EAAK9M,EAAIsR,EAAIjK,GACpC,MAAMuG,EAAK/N,SAASgO,yBACpB,IAAIgH,EAAO,GACPb,EAAO,EAEPpK,EAAM,EACV,IAAK,MAAMxF,KAAK0I,EAAK,CACpB,GAAIwE,EAAG1H,IAAQ,EAAG,CAEjBkL,EAAalH,EAAIiH,EADFE,EAAqB/U,EAAIgU,EAAKpK,GACdvC,EAAK4J,cACpC4D,EAAO,GACPb,EAAOpK,EAERiL,GAAQzQ,EACRwF,GAAQ,EAET,GAAIiL,EAAKhP,OAAQ,CAEhBiP,EAAalH,EAAIiH,EADFE,EAAqB/U,EAAIgU,EAAKhU,EAAG6F,QACjBwB,EAAK4J,cAErC,OAAOrD,EAGR,SAASkH,EAAalH,EAAId,EAAKkI,EAAQ7M,GACtC,GAAI6M,EACHpH,EAAGG,YAAYlO,SAASyQ,eAAexD,QACjC,CACN,MAAMjM,EAAIhB,SAAS2Q,cAAc,QACjC3P,EAAEkN,YAAYlO,SAASyQ,eAAexD,IAClC3E,EAAMtC,QAAQ5B,EAASpD,EAAGsH,GAC9ByF,EAAGG,YAAYlN,IAIjB,SAASkU,EAAqB/U,EAAIgU,EAAKiB,GACtC,IAAK,IAAI/O,EAAI8N,EAAK9N,EAAI+O,EAAK/O,GAAK,EAAG,CAClC,MAAMhG,EAAIF,EAAGkG,GACb,IAAKuM,EAAS3R,SAASZ,GACtB,OAAO,EAGT,OAAO,EAGRT,EAAGuC,YAAmBpC,EACtBH,EAAGyV,iBAAmBhH,GAMxB,CAWC,SAASiH,EAAYC,EAAK/M,EAAI,KAAMgN,EAAU,MAC7C,GAAY,OAARD,GAAwB,KAARA,EAAY,CAC/B,MAAMnG,EAAImG,EAAIxK,QAAQ,KACtB,IAAW,IAAPqE,EAAU,CACb,MAAMqG,EAAKF,EAAIzL,UAAUsF,EAAI,GAC7B,GAAIqG,EAAGzP,OAAQ,CACd,MAAM3F,EAAIL,SAAS0V,eAAeD,GAClC,GAAU,OAANpV,IAEI,IAAN+O,GACAmG,EAAIzL,UAAU,EAAGsF,KAAOtC,SAAS6I,KAAK1O,QAAQ6F,SAAS8I,KAAO9I,SAAS8I,KAAO,IAAK,KAClF,CACD,GAAIpN,GAAKgN,EAAS,CACjB,MAAM/U,EAAO+H,EAAEG,wBAAwBkN,IAC1BxV,EAAEsI,wBAAwBkN,IAC9BpV,IAAM+U,EAAQ,IAAK,GAE7B,OAAO,KAMZ,OAAO,EAIR,CAWC,SAASnH,EAAM5M,EAAI+F,EAAO,IACzBA,EAAOC,OAAOC,OAAO,CACpBoO,eAAmB,eACnBC,gBAAmB,gBACnBC,gBAAmB,gBACnBC,kBAAmB,kBACnBC,cAAmB,cACnBC,eAAmBC,EACnBC,eAAmBC,EACnBC,cAAmBA,GACjB/O,GAEH,IAAK,MAAMgB,KAAK/G,EACf+U,EAAShO,EAAGA,EAAEgD,aAAa,QAAShE,GAItC,SAASiP,EAAWhV,EAAI+F,EAAO,IAC9BA,EAAOC,OAAOC,OAAO,CACpBsO,gBAAmB,gBACnBC,kBAAmB,kBACnBC,cAAmB,cACnBG,eAAmBC,EACnBC,cAAmBA,GACjB/O,GAEH,IAAK,MAAMgB,KAAK/G,EACfiV,EAAclO,EAAGA,EAAEgD,aAAa,QAAShE,GAI3C,MAAM4O,EAAkB,CACvB,YACA,cACA,aACA,iBACA,aACA,oBACA,cACA,oBACA,oBACA,aACA,aAGKE,EAAY,CACjBK,IAAM,MACNC,KAAM,MACNC,IAAM,MACNC,KAAM,MACNC,IAAM,MACNC,KAAM,MACNC,IAAM,OAOP,SAAST,EAAShO,EAAG+M,EAAK/N,GACrB0P,EAAY1O,EAAGhB,GAClBpD,EAASoE,EAAGhB,EAAKsO,gBAEbqB,EAAY3O,GACfkO,EAAclO,EAAG+M,EAAK/N,GACZ4P,EAAa5O,KACvBpE,EAASoE,EAAGhB,EAAKuO,iBACbsB,EAAgB7O,EAAG+M,IACtBnR,EAASoE,EAAGhB,EAAKuO,iBAAiB,EAAM,OAEzCW,EAAclO,EAAG+M,EAAK/N,IAKzB,SAAS0P,EAAY1O,EAAGhB,GACvB,GAAIgB,EAAEgJ,UACL,IAAK,MAAMjN,KAAKiE,EAAEgJ,UAAUQ,MAAM,KACjC,IAAKxK,EAAK2O,eAAelV,SAASsD,GAAI,OAAO,EAG/C,IAAI+S,GAAK,EACT,IAAK,MAAM/S,KAAKiE,EAAEyF,WACjB,GAAmB,IAAf1J,EAAEkK,SAAgB,CACrB,GAAK6I,GAAoB,QAAd/S,EAAEuL,QAEN,CACNwH,GAAK,EACL,MAHAA,GAAK,EAOR,OAAOA,EAGR,SAASF,EAAa5O,GACrB,GAAIA,EAAEgJ,UAAW,OAAO,EACxB,MAAM+F,EAAK/O,EAAEyF,WACb,GAAkB,IAAdsJ,EAAGvR,OAAc,OAAO,EAC5B,IAAK,MAAMzB,KAAKgT,EAAI,CACnB,GAAIhT,EAAEiN,UAAW,OAAO,EACxB,GAAmB,IAAfjN,EAAEkK,UACa,OAAdlK,EAAEuL,UAAqBlL,iBAAiBL,GAAG6E,QAAQnI,SAAS,UAC/D,OAAO,EAIV,OAAO,EAGR,SAASkW,EAAY3O,GACpB,OAAQA,EAAEgJ,WAAqC,IAAxBhJ,EAAEyF,WAAWjI,OAGrC,SAASqR,EAAgB7O,EAAG+M,GAC3B,OAAe,OAARA,GAAwB,KAARA,GAAc/M,EAAEyF,WAAWjI,QAAUwC,EAAE+B,UAAUX,SAAW2L,EAOpF,SAASmB,EAAclO,EAAG+M,EAAK/N,GAC9B,MAAMgO,EAAU,EAAC,GACbF,EAAYC,EAAK/M,EAAGgN,GACvBpR,EAASoE,EAAGhB,EAAKwO,iBAAiB,EAAMR,EAAQ,GAAK,KAAO,IAClDhO,EAAK+O,cAAchB,IAC7BnR,EAASoE,EAAGhB,EAAKyO,mBAElB,MAAM5V,EAAImX,EAAYjC,EAAK/N,EAAK6O,gBAC5BhW,IACH+D,EAASoE,EAAGhB,EAAK0O,eACjB9R,EAASoE,EAAGhB,EAAK0O,eAAe,EAAM7V,IAIxC,SAASkW,EAAchB,GACtB,QAAY,OAARA,GAAwB,KAARA,GACdA,EAAIxR,WAAY,GAAE+I,SAAS2K,aAAa3K,SAAS4K,UACjDnC,EAAI9J,MAAM,kBAAmB8J,EAAI9J,MAAM,UAQ9C,SAAS+L,EAAYjC,EAAKoC,GACzB,GAAY,OAARpC,GAAwB,KAARA,IAAeA,EAAI1L,SAAS,KAAM,CACrD,MAAMyD,EAAIiI,EAAIxK,QAAQ,MACtB,IAAW,IAAPuC,EAAU,CACb,MAAMxN,EAAIyV,EAAIxK,QAAQ,IAAKuC,EAAI,GAC/BiI,GAAc,IAAPzV,EAAY,GAAKyV,EAAIzL,UAAUhK,EAAI,GAE3C,MAAMsP,EAAImG,EAAIvL,YAAY,KAC1B,IAAW,IAAPoF,EAAU,CAEb,OAAOuI,EADKpC,EAAIzL,UAAUsF,EAAI,GAAGjF,gBACX,MAGxB,OAAO,KAGRvK,EAAG8B,UAAiB2M,EACpBzO,EAAGgY,eAAiBnB,EAEpB7W,EAAGiY,gBAAkBX,EAGtB,CAWC,MAAMY,EAAW,IAEjB,IAAIC,GAAc,EAClB,MAAMC,EAAqB,IAAIpH,IAE/B,SAAS7Q,EAAW0B,EAAI+F,EAAO,IAC9BA,EAAOC,OAAOC,OAAO,CACpBuQ,SAAkBH,EAClBhW,iBAAkB,MAChB0F,GAEH,IAAK,MAAMgB,KAAK/G,EACf4M,EAAM7F,EAAGhB,GAIV,GAFAxH,SAASoH,iBAAiB,SAAS,KAAQ2Q,GAAc,KAErDvQ,EAAI,iBAAsB,CAC7B,MAAM0Q,EAAMlY,SAASI,iBAAiBoH,EAAI,kBAC1C,GAAI0Q,EAAIlS,OAAQ,CACf,MAAMmS,EAAK,IAAIC,kBAAiBC,IAC/B,IAAK,MAAMC,KAAKD,EACf,IAAK,MAAM5I,KAAK6I,EAAEC,WACE,IAAf9I,EAAEhB,UAAgC,MAAdgB,EAAEK,SACzBzB,EAAMoB,EAAGjI,MAKb,IAAK,MAAMgR,KAAMN,EAChBC,EAAGjR,QAAQsR,EAAI,CACdC,WAAW,EACXC,SAAW,MAOhB,SAASrK,EAAM7F,EAAGhB,GACjB,IAAKwQ,EAAmB1H,IAAI9H,GAAI,CAC/B,SAASmQ,EAAQ3X,GAAK4X,EAAQ5X,EAAGwG,IAClB,MAAXgB,EAAEmN,MAA2B,SAAXnN,EAAEmN,MAAmBL,EAAY9M,EAAEmN,SACxDnN,EAAEpB,iBAAiB,QAASuR,GAC5BX,EAAmBvT,IAAI+D,KAK1B,SAASoQ,EAAQ5X,EAAGwG,GACnB,GAAiB,IAAbxG,EAAE6X,QAAgB7X,EAAE8X,SAAW9X,EAAE+X,UAAY/X,EAAEgY,QAAUhY,EAAEiY,QAAS,OACxE,MAAMtD,EAAO3U,EAAEkY,cAAc1N,aAAa,QACpCzB,EAAO4L,EAAK5K,QAAQ,MACb,IAAThB,GACHoP,EAAmBnY,EAAG2U,EAAK7L,UAAUC,GAAMvC,EAAKyQ,UAIlD,SAASkB,EAAmBnY,EAAG4U,EAAMqC,EAAWH,GAC/C,MACMnU,EADgB,OAATiS,GAA0B,KAATA,GAAwB,MAATA,GAAyB,SAATA,EAC3C5V,SAAS6E,gBAAkB7E,SAAS0V,eAAeE,EAAK9L,UAAU,IAChFnG,IAAQhE,OAAOyZ,WAAW,oCAAoCC,UACjErY,EAAEsY,kBACFtY,EAAEuY,iBAEFC,EAAsB7V,EAAKsU,GACvBrC,IAASjW,OAAOmN,SAAS8I,MAC5B6D,QAAQC,UAAU,KAAM,KAAgB,SAAT9D,EAAkB,GAAKA,IASzD,SAAS4D,EAAsB7V,EAAKsU,EAAWH,EAAU6B,GAAQ,GAChE,MAAMC,EAAQja,OAAOka,YACrB,IAGIC,EAHAC,EAAOC,EAAarW,GACpBsW,EAAOja,SAAS6E,gBAAgBqV,aAMpC,SAASC,EAAKC,GACRrC,IACDkC,IAAOja,SAAS6E,gBAAgBqV,eACnCH,EAAOC,EAAarW,GACpBsW,EAAOja,SAAS6E,gBAAgBqV,cAEjCva,OAAO0a,SAAS,EAAGC,EAAOF,EAAON,EAAWF,EAAOG,EAAM9B,IACrDmC,EAAON,EAAY7B,EACtB3S,sBAAsB6U,IAEtBxa,OAAO0a,SAAS,EAAGL,EAAarW,IAChCgD,YAAW,IAAMhH,OAAO0a,SAAS,EAAGL,EAAarW,KAAO,IACpDgW,GAAShW,GAAOA,IAAQ3D,SAAS6E,iBACpClB,EAAIgW,QAEL5B,GAAc,IAlBhBA,GAAc,EACdzS,uBAAuB8U,IAAWN,EAAYM,EAAMD,EAAKC,MAsB1D,SAASJ,EAAarW,GACrB,MAAM4W,EAAMzV,SAASF,iBAAiB5E,SAAS6E,iBAAiBE,kBAChE,OAAOpB,EAAIgF,wBAAwBkN,IAAMlW,OAAOka,YAAcU,EAG/D,SAASD,EAAOja,EAAGwR,EAAGtN,EAAG+I,GAExB,OADAjN,GAAKiN,EAAI,GACD,GAAW/I,EAAIsN,GAAK,EAAIxR,EAAIA,EAAIwR,IAE/BtN,EAAIsN,GAAK,KADlBxR,GAC4BA,EAAI,GAAK,GAAKwR,EAG3CjS,EAAGiC,iBAAmB9B,EAEtBH,EAAG4Z,sBAAwBA,GAM7B,CAWC,SAASzZ,EAAW4C,EAAK6E,EAAO,IAC/BA,EAAOC,OAAOC,OAAO,CACpBuD,UAAgB,UAChBuP,eAAgB,GAChBC,cAAgB,GACdjT,GAEH,IAAK,MAAMkT,KAAM/X,EAChBwI,EAASuP,EAAIlT,GAIf,SAAS2D,EAAS9K,EAAGmH,GACpB,MAAM4D,EAAO/K,EAAEiI,MAAMqS,cACrB,GAAa,KAATvP,GAAwB,SAATA,GAAmB5D,EAAKgT,eAAevZ,SAASmK,GAAO,CACzE,GAAI5D,EAAKiT,aAAc,CACtB,MAAMnP,EAAK,IAAIC,OAAO,sBAAwBH,EAAO,SAAU,MAC3D/K,EAAEmL,aAAa,SAASC,MAAMH,GACjCjL,EAAEqL,gBAAgB,SAElBrL,EAAEiI,MAAMqS,cAAgB,GAG1BvW,EAAS/D,EAAGmH,EAAKyD,WAAW,EAAMG,IAIpCxL,EAAGgD,eAAiB7C,EAKrB,CAWC,SAASA,EAAWI,EAAIqH,EAAO,IACZ,IAAdrH,EAAG6F,SAEPwB,EAAOC,OAAOC,OAAO,CACpBkT,YAAa,mBACXpT,GAEH7B,GACA,SAAqBI,GACpB,IAAK,IAAIM,EAAI,EAAGA,EAAIlG,EAAG6F,OAAQK,GAAK,EAC/BN,EAAGM,IAAIjC,EAASjE,EAAGkG,GAAImB,EAAI,aAAiB,EAAM,aAH/BrH,EAAI,GAAK,uBAOlCR,OAAOyH,iBAAiB,eAAe,KACtC,IAAK,MAAM7C,KAAKpE,EACfiE,EAASG,EAAGiD,EAAI,aAAiB,EAAM,eAK1C5H,EAAG6D,OAAS1D,EAKb,CAWC,SAAS8a,EAAgBC,GACxB,MAAMvD,EAAKuD,EAAUC,SACrB,IAAK,IAAI1U,EAAI,EAAGA,EAAIkR,EAAGvR,OAAQK,GAAK,EACnC,GAAI,WAAW0M,KAAKwE,EAAGlR,GAAGyJ,SAAU,OAAOyH,EAAGlR,GAE/C,OAAO,KAGR,SAAS2U,EAAa/Y,GACrB,MAAMuG,EAAIxI,SAAS2Q,cAAc,KACjCnI,EAAEmN,KAAQ,IAAM1T,EAAEwT,GAClBjN,EAAEyS,MAAQhZ,EAAE6L,IAAIoB,UAChB,MAAM7O,EAAI4B,EAAE6L,IAAImN,MAAQhZ,EAAE6L,IAAImN,MAAQhZ,EAAE6L,IAAIvD,UAQ5C,OANA/B,EAAE+B,UAAYlK,EACdmI,EAAEpI,iBAAiB,SAASgG,SAAQpF,GAAKA,EAAE0D,WACvB,KAAhB8D,EAAE0G,YACL1G,EAAE+B,UAAYlK,GAEf6a,EAAS1S,GACFA,EAGR,SAAS0S,EAASla,GACjB,IAAK,MAAMuD,KAAK/D,MAAMC,KAAKO,EAAE+Z,UAC5B,GAAkB,MAAdxW,EAAEuL,SAAiC,UAAdvL,EAAEuL,QAAqB,CAC/C,MAAMhQ,EAAIE,SAAS2Q,cAAc,QACjC7Q,EAAEyK,UAAYhG,EAAEgG,UAChBvJ,EAAEoN,aAAatO,EAAGyE,GAClB2W,EAASpb,QAETob,EAAS3W,GAMZ,CAWC,SAASxE,EAAWwX,EAAI/P,EAAO,IAC9B,GAAkB,IAAd+P,EAAGvR,OAAc,OAErBwB,EAAOC,OAAOC,OAAO,CACpByT,SAAc,YACdC,aAAc,aACdC,YAAc,YACdC,WAAc,QACZ9T,GACH,MAAMjH,EAAK,GACX,IAAK,IAAI8F,EAAI,EAAGA,EAAIkR,EAAGvR,OAAQK,GAAK,EAAG,CACtC,MAAMkV,EAAOC,EAAOjE,EAAGlR,GAAIA,EAAI,EAAGmB,GAC9B+T,GAAMhb,EAAG2B,KAAKqZ,GAEnB5b,OAAOyH,iBAAiB,cAAc,IAAM7G,EAAG6F,QAAQqV,KAGxD,SAASA,EAAcF,GACtB,MAAM5X,EAAM+X,EAAiBH,EAAMzO,SAAS8I,MAC5C2F,EAAKI,OAAShY,EACdgD,YAAW,IAAM0B,EAAOkT,IAAO,IAOhC,SAASC,EAAOI,EAAMC,EAAKrU,GAC1B,MAAM+T,EAAO,CACZ/T,KAAAA,EACAzB,GAAQ,KACRpD,IAAQ,GACRgZ,OAAQ,MAEHG,EAAKC,EAAeH,EAAMC,EAAKrU,EAAK8T,YAC1C,GAAkB,IAAdQ,EAAG9V,OAAc,OAAO,EAE5B,MAAMgW,EAASlP,SAAS8I,KAAK5P,QAAU,EACjCiW,EAAS,GAWf,OAVAH,EAAG1V,SAAQ,CAACnE,EAAG8H,KACd,MAAMmS,EAAMC,EAAUL,EAAI7Z,EAAGuF,EAAMwU,GAAkB,IAARjS,GAC7C6R,EAAKQ,aAAaF,EAAIxB,GAAIzY,EAAE6L,KAC5BmO,EAAK/Z,KAAKga,GACVX,EAAK5Y,IAAIT,KAAKga,EAAIxB,OAEnB2B,EAAYd,EAAMU,GAElBV,EAAKI,OAASD,EAAiBH,EAAMzO,SAAS8I,MAC9CjP,YAAW,IAAM0B,EAAOkT,IAAO,KACxBA,EAGR,SAASG,EAAiBH,EAAM3F,GAC/B,MAAMH,EAAKG,EAAK3O,QAAQ,IAAK,IAC7B,GAAW,KAAPwO,EAAW,CACd,MAAM9R,EAAM3D,SAAS0V,eAAeD,GACpC,GAAI9R,GAAiC,IAA1B4X,EAAK5Y,IAAIoI,QAAQpH,GAC3B,OAAOA,EAGT,OAAO,KAOR,SAASoY,EAAeH,EAAMC,EAAKS,GAClC,MAAMC,EAAK1B,EAAgBe,GAC3B,IAAKW,EAAI,MAAO,GAChB,MAAM5N,EAAK4N,EAAGzM,QACRgM,EAAK,GAEX,IAAK,MAAMhO,KAAOtN,MAAMC,KAAKmb,EAAKb,UACjC,GAAIjN,EAAIgC,UAAYnB,EAAI,CACvB,MAAM8G,EAAM,GAAE6G,IAAST,KAAOC,EAAG9V,OAAS,IAC1C8V,EAAG5Z,KAAK,CAAE4L,IAAAA,EAAK2H,GAAAA,IAGjB,OAAOqG,EAGR,SAASK,EAAUL,EAAIU,EAAMhV,EAAMiV,GAClC,MAAM/B,EAAK1a,SAAS2Q,cAAc,MAClC+J,EAAGjF,GAAK+G,EAAK/G,GACbiF,EAAGlJ,UAAY,GACfpN,EAASsW,EAAIlT,EAAK2T,UACdsB,GAAUrY,EAASsW,EAAIlT,EAAK6T,aAChC,MAAM5Z,EAAK,GAEX,IAAK,MAAMQ,KAAK6Z,EAAI,CACnB,MAAMtT,EAAIwS,EAAa/Y,GACjBya,EAAK1c,SAAS2Q,cAAc,MAC9B1O,IAAMua,GAAMpY,EAASsY,EAAIlV,EAAK4T,cAClCsB,EAAGxO,YAAY1F,GACfkS,EAAGxM,YAAYwO,GACfjb,EAAGS,KAAKsG,GAET,MAAO,CAAEkS,GAAAA,EAAIjZ,GAAAA,GAOd,SAAS4a,EAAYd,EAAMU,GAC1B,IAAK,MAAMC,KAAOD,EACjBC,EAAIza,GAAG2E,SAAQ,CAACoC,EAAGnC,KAClBmC,EAAEpB,iBAAiB,SAAS,IAAMuR,EAAQ4C,EAAMU,EAAK5V,GAAGqU,SAG1D/U,GAAaI,IACZwV,EAAKxV,GAAKA,EACVsC,EAAOkT,KACLA,EAAK5Y,IAAK,GAGd,SAASgW,EAAQ4C,EAAMoB,GACtBpB,EAAKI,OAASgB,EACdhW,YAAW,KACV,GAAI4U,EAAKI,OAAQ,CAChB,MAAMiB,EAAIrB,EAAKI,OAAOhT,wBAAwBkN,IAC9C0F,EAAKI,OAAS,KACVhc,OAAOkd,YAAcD,GAAGvU,EAAOkT,MAElC,KAGJ,SAASlT,EAAOkT,GACf,MAAM5X,EAAM4X,EAAKI,OAASJ,EAAKI,OAASmB,EAAgBvB,GACxD,IAAK,MAAMb,KAAMa,EAAK5Y,IACrByB,EAASsW,EAAIa,EAAK/T,KAAK6T,YAAaX,IAAO/W,GAI7C,SAASmZ,EAAgBvB,GACxB,OAAKA,EAAKxV,GACHwV,EAAK5Y,IAAIoa,MAAK,CAACrC,EAAIrU,IAAMkV,EAAKxV,GAAGM,KADnB,KAItBzG,EAAGmD,UAAYhD,EAGhB,CAWC,SAASA,EAAWwX,EAAI/P,EAAO,IAC9B,GAAkB,IAAd+P,EAAGvR,OAAc,OAErBwB,EAAOC,OAAOC,OAAO,CACpByT,SAAgB,YAChBC,aAAgB,aAChBC,YAAgB,YAChBC,WAAgB,OAChB0B,cAAgB,GAChBC,gBAAgB,GACdzV,GACH,MAAMjH,EAAK,GACX,IAAK,IAAI8F,EAAI,EAAGA,EAAIkR,EAAGvR,OAAQK,GAAK,EAAG,CACtC,MAAMkV,EAAOC,EAAOjE,EAAGlR,GAAIA,EAAI,EAAGmB,GAC9B+T,GAAMhb,EAAG2B,KAAKqZ,GAEnB9V,GAAS,IAAMlF,EAAG6F,QAAQ8W,KAAS,GACnCvd,OAAOyH,iBAAiB,cAAc,IAAM7G,EAAG6F,QAAQqV,KAEvD9U,YAAW,KACV,MAAM8O,EAAK3I,SAAS8I,KAAK3O,QAAQ,IAAK,IACtC,GAAW,KAAPwO,EAAW,CACd,MAAM9R,EAAM3D,SAAS0V,eAAeD,GAChC9R,GAAKA,EAAIwZ,eAAe,CAAEC,SAAU,cAEvC,IAGJ,SAAS3B,EAAcF,GACtB,IAAIxR,EAAM2R,EAAiBH,EAAMzO,SAAS8I,MAC9B,OAAR7L,IAAcA,EAAMsT,EAAc9B,EAAMzO,SAAS8I,OACzC,OAAR7L,GAAcpD,YAAW,IAAM0B,EAAOkT,EAAMxR,IAAM,IAOvD,SAASyR,EAAOI,EAAMC,EAAKrU,GAC1B,MAAM+T,EAAO,CACZ/T,KAAAA,EACAoU,KAAAA,EACA0B,GAAQ,KACRrB,KAAQ,GACRsB,OAAQ,IAEFzB,EAAIwB,GAAME,EAAuB5B,EAAMC,EAAKrU,GACnD,GAAkB,IAAdsU,EAAG9V,OAAc,OAAO,EAC5BuV,EAAK+B,GAAKA,EAEV,MAAMG,EAAOtB,EAAUL,EAAItU,GACrBkW,EAAOvB,EAAUL,EAAItU,GAC3B+T,EAAKU,KAAK/Z,KAAKub,EAAMC,GAErB9B,EAAKQ,aAAaqB,EAAK/C,GAAIkB,EAAK+B,YAChC,IAAK,MAAMvO,KAAKkO,EAAI1B,EAAK1N,YAAYkB,GACrCwM,EAAK1N,YAAYwP,EAAKhD,IAEtB2B,EAAYd,GAEZ,MAAMtZ,EAAI6K,SAAS8I,KACnB,IAAI7L,EAAM2R,EAAiBH,EAAMtZ,GAIjC,OAHY,OAAR8H,IAAcA,EAAMsT,EAAc9B,EAAMtZ,IAChC,OAAR8H,IAAcA,EAAM6T,EAAYrC,IAAS,EAAI,GACjD5U,YAAW,IAAM0B,EAAOkT,EAAMxR,IAAM,IAC7BwR,EAGR,SAASG,EAAiBH,EAAM3F,GAC/B,IAA2B,IAAvBA,EAAK7K,QAAQ,KAAa,OAAO,KACrC,MAAMO,EAAK,IAAIC,OAAOqK,EAAO,IAAK,KAC5BnU,EAAK8Z,EAAKU,KAAK,GAAGxa,GACxB,IAAK,IAAI4E,EAAI,EAAGA,EAAI5E,EAAGuE,OAAQK,GAAK,EACnC,GAAI5E,EAAG4E,GAAGsP,KAAKlK,MAAMH,GAAK,OAAOjF,EAElC,OAAO,KAGR,SAASgX,EAAc9B,EAAM3F,GAC5B,MAAMH,EAAKG,EAAK3O,QAAQ,IAAK,IAC7B,GAAW,KAAPwO,EAAW,CACd,MAAM9R,EAAM3D,SAAS0V,eAAeD,GACpC,GAAI9R,EAAK,CACR,MAAMoG,EAAMwR,EAAK+B,GAAGO,WAAUzO,GAAKA,EAAEjL,SAASR,KAC9C,IAAa,IAAToG,EAAY,OAAOA,GAGzB,OAAO,KAOR,SAASyT,EAAuB5B,EAAMC,EAAKrU,GAC1C,MAAM+U,EAAK1B,EAAgBe,GAC3B,IAAKW,EAAI,MAAO,GAChB,MAAM5N,EAAK4N,EAAGzM,QACRgM,EAAK,GACLwB,EAAK,GACX,IAAIQ,EAAO,KAEX,IAAK,MAAMhQ,KAAOtN,MAAMC,KAAKmb,EAAKb,UACjC,GAAIjN,EAAIgC,UAAYnB,EAAI,CACvB,MAAM8G,EAAM,GAAEjO,EAAK8T,aAAaO,KAAOC,EAAG9V,OAAS,IACnD8V,EAAG5Z,KAAK,CAAE4L,IAAAA,EAAK2H,GAAAA,IAEXqI,GAAMR,EAAGpb,KAAK4b,GAClBA,EAAO9d,SAAS2Q,cAAc,OAC1BnJ,EAAKyV,eACRrB,EAAKmC,YAAYjQ,GAEjBgQ,EAAK5P,YAAYJ,QAGdgQ,GAAMA,EAAK5P,YAAYJ,GAI7B,OADIgQ,GAAMR,EAAGpb,KAAK4b,GACX,CAAChC,EAAIwB,GAGb,SAASnB,EAAUL,EAAItU,GACtB,MAAMkT,EAAK1a,SAAS2Q,cAAc,MAClC+J,EAAGlJ,UAAY,GACfpN,EAASsW,EAAIlT,EAAK2T,UAClB,MAAM1Z,EAAK,GAEX,IAAK,MAAMQ,KAAK6Z,EAAI,CACnB,MAAMtT,EAAIwS,EAAa/Y,GACjBya,EAAK1c,SAAS2Q,cAAc,MAClC+L,EAAGxO,YAAY1F,GACfkS,EAAGxM,YAAYwO,GACfjb,EAAGS,KAAKsG,GAET,MAAO,CAAEkS,GAAAA,EAAIjZ,GAAAA,GAOd,SAAS4a,EAAYd,GACpB,IAAK,MAAMW,KAAOX,EAAKU,KACtBC,EAAIza,GAAG2E,SAAQ,CAACoC,EAAGnC,KAClBmC,EAAEpB,iBAAiB,SAAUpG,GAAM2X,EAAQ3X,EAAGua,EAAMlV,QAKvD,SAASsS,EAAQ3X,EAAGua,EAAMxR,GAEzB,GADA/I,EAAEuY,iBAC6D,SAA3D3U,iBAAiB5D,EAAEV,OAAOyI,eAAeiV,cAA0B,OACvE,IAAIzI,EAAMvU,EAAEV,OAAOqV,KACf4F,EAAKgC,SAAWxT,IACnBA,GAAO,EACPwL,EAAMA,EAAItO,QAAQ,OAAQ,KAE3BwS,QAAQC,UAAU,GAAI,KAAMnE,GAC5BlN,EAAOkT,EAAMxR,GACbkU,EAAY1C,GAGb,SAASqC,EAAYrC,GACpB,MAA2D,WAApD3W,iBAAiB2W,EAAKU,KAAK,GAAGvB,IAAIwD,cAG1C,SAASD,EAAY1C,IACC,IAAjBA,EAAKgC,QACT5W,YAAW,KACV,OAAS+T,GAAIyD,IAASzD,GAAI0D,IAAS7C,EAAKU,KAClCoC,EAAKF,EAAIxV,wBACf,GAAI,GAAK0V,EAAGxI,KAAOwI,EAAGxI,KAAOlW,OAAOkd,aAAe,GAAKwB,EAAGC,QAAUD,EAAGC,QAAU3e,OAAOkd,YACxF,OAED,MAAM0B,EAAKH,EAAIzV,yBACXiV,EAAYrC,IAAUgD,EAAG1I,IAAM,GAAKlW,OAAOkd,YAAc0B,EAAGD,SAC/D/C,EAAKK,KAAKuB,eAAe,CAAEC,SAAU,aAEpC,IAGJ,SAAS/U,EAAOkT,EAAMxR,GACrB,MAAMuT,EAAK/B,EAAK+B,KACP7b,GAAI+c,IAAQ/c,GAAIgd,IAAQlD,EAAKU,KAEtC,IAAK,IAAI5V,EAAI,EAAGA,EAAIiX,EAAGtX,OAAQK,GAAK,EACnCjC,EAASoa,EAAGnY,GAAG0C,cAAewS,EAAK/T,KAAK4T,aAAc/U,IAAM0D,GAC5D3F,EAASqa,EAAGpY,GAAG0C,cAAewS,EAAK/T,KAAK4T,aAAc/U,IAAM0D,GAC5D3F,EAASkZ,EAAGjX,GAAIkV,EAAK/T,KAAK4T,aAAc/U,IAAM0D,GAE/CwR,EAAKgC,OAASxT,EAOf,SAASmT,EAAO3B,GACf,MAAMK,EAAOL,EAAKK,KAClB,GAAIgC,EAAYrC,GACfK,EAAKtT,MAAMoE,UAAY,OACjB,CACN,MAAMgS,EAAOC,EAAapD,GACpBtZ,EAAKyc,EAAO/e,OAAOkd,YAActB,EAAK/T,KAAKwV,cAAkB,GAAE0B,MAAW,GAChF9C,EAAKtT,MAAMoE,UAAYzK,GAEF,IAAjBsZ,EAAKgC,QACRlV,EAAOkT,EAAM,IAKhB,SAASoD,EAAapD,GACrB,OAASb,GAAIyD,IAASzD,GAAI0D,IAAS7C,EAAKU,KAExC,IAAI2C,EAAY9Z,SAASF,iBAAiBuZ,GAAKU,cAC3CC,EAAYha,SAASF,iBAAiBwZ,GAAKU,WAC3ClU,EAAS,EAEb,IAAK,MAAMwE,KAAKmM,EAAK+B,GAAI,CACxB,MAAMA,EAAK1Y,iBAAiBwK,GACtB7I,EAAKzB,SAASwY,EAAGwB,WACjBC,EAAKja,SAASwY,EAAGuB,cACjB5c,EAAKmN,EAAEzG,wBAAwBiC,OAErCgU,EAAYI,KAAKC,IAAIL,EAAWrY,GAChCuY,EAAYE,KAAKC,IAAIH,EAAWC,GAChCnU,EAAYoU,KAAKC,IAAIrU,EAAQ3I,GAE9B,OAAOkc,EAAIjE,aAAekE,EAAIlE,aAAe0E,EAAYE,EAAYlU,EAGtEhL,EAAGoD,SAAWjD,GAOf,CAWC,SAASA,EAAWkD,EAAMuE,EAAO,IAChC,GAAoB,IAAhBvE,EAAK+C,OAAc,OAEvB,MAAMkZ,EAAKjc,EAAKA,EAAK+C,OAAS,GACxBmZ,EAAK1X,OAAOC,OAAO,CACxB0X,cAAkB,IAClBC,aAAkB,GAClBC,cAAkB,EAAI,EACtBC,cAAkB,EAClBC,WAAkB,IAClBC,eAAkB,EAClBC,OAAkB,KAClBC,MAAkB,KAClBC,UAAkB,eAClBC,UAAkB,eAClBC,iBAAkB,iBAClBC,gBAAkB,iBAChBvY,EAAMwY,EAAiBd,IAE1BC,EAAGc,MAA4B,EAApBd,EAAGM,eACdN,EAAGe,MAA4B,EAApBf,EAAGM,eACdN,EAAGgB,KAAOC,EAAclB,EAAI,MAC5BC,EAAGkB,KAAOD,EAAclB,EAAI,MAE5B,MAAMoB,EAAU,GAAIC,EAAY,GAChC,IAAK,MAAMlgB,KAAK4C,EACXud,EAASngB,EAAG8e,GAAKmB,EAAQpe,KAAK7B,GAC7BkgB,EAAUre,KAAK7B,GAErB8e,EAAGsB,QAAUH,EAAQta,OAErB,IAAK,MAAM3F,KAAKigB,EAAS,CACxB,MAAMI,IAASvB,EAAGO,SAAWP,EAAGO,OAAOrf,IAAM,GAclC8E,EAbR,KACFkJ,EAAMhO,EAAG8e,GACT/a,EAAS/D,EAAG8e,EAAGS,WACXT,EAAGQ,OAAOR,EAAGQ,MAAMtf,GACF,KAAf8e,EAAGsB,SAAeE,EAAgBzB,EAAIC,KASlB,KAAZ7R,EARZoT,GAQiCvb,IAAOwB,WAAWxB,EAAImI,GAA3D,IAAYnI,EAAImI,EANhB,GAAI6R,EAAGC,cACN,IAAK,MAAM/e,KAAKkgB,EAAW,CACflgB,EAAE0I,cAAcU,YAClB0V,EAAGC,cAAgB/e,EAAEoJ,aAAarF,EAAS/D,EAAG8e,EAAGU,WAI5De,EAAWN,EAASnB,GAGrB,SAASa,EAAiBa,GACzB,MAAMC,EAAKD,EAAIngB,qBAAqB,MAAM,GACpCZ,EAAI8E,iBAAiBkc,GACrBb,EAAQ3W,WAAWxJ,EAAEyJ,aAAeD,WAAWxJ,EAAE0J,cACjD0W,EAAQ5W,WAAWxJ,EAAEihB,YAAczX,WAAWxJ,EAAEkhB,gBAC/CC,EAAOC,GAASC,EAAYL,GACnC,MAAO,CAAEb,KAAAA,EAAMC,KAAAA,EAAMe,MAAAA,EAAOC,MAAAA,GAG7B,SAASC,EAAYrT,GACpB,MAAMR,EAAItN,SAAS2Q,cAAc7C,EAAIsT,UACrC9T,EAAExB,aAAa,QAAU,iDAAgDgC,EAAIxF,MAAM+Y,YAAc,uBAAuBvT,EAAIxF,MAAMgZ,UAAY,cAC9IhU,EAAE/C,UAAY,IACduD,EAAIK,WAAWD,YAAYZ,GAC3B,MAAM7E,EAAI6E,EAAE7D,YACNxH,EAAIqL,EAAEiU,aAEZ,OADAjU,EAAEa,WAAW4P,YAAYzQ,GAClB,CAAC7E,EAAGxG,GAGZ,SAASme,EAAc/f,EAAGyP,GACzB,MAAMxC,EAAItN,SAAS2Q,cAAcb,GAEjC,OADAxC,EAAExB,aAAa,QAAU,6EAClBzL,EAAE6N,YAAYZ,GAGtB,SAASqT,EAAgBzB,EAAIsC,GAC5BtC,EAAGnB,YAAYyD,EAAKrB,MACpBjB,EAAGnB,YAAYyD,EAAKnB,MAGrB,SAASG,EAASK,EAAKY,GACtB,GAAwB,IAApBZ,EAAIa,KAAK1b,OAAc,OAAO,EAClC,GAAIyb,EAAKjC,WAAaqB,EAAIa,KAAK1b,OAAQ,OAAO,EAE9C,MAAMqZ,aAAEA,EAAFC,cAAgBA,GAAkBmC,EACxC,IAAK,MAAME,KAAMd,EAAIa,KACpB,GAAKC,EAAGC,gBACR,IAAK,MAAMnS,KAAKkS,EAAG1T,WAAY,CAC9B,MAAMU,EAAKc,EAAEK,QACb,GAAW,OAAPnB,GAAsB,OAAPA,EAAa,SAChC,GAAI,EAAI7J,SAAS2K,EAAEjE,aAAa,WAAY,IAAK,SACjD,GAAI,EAAI1G,SAAS2K,EAAEjE,aAAa,WAAY,IAAK,SACjD,MAAM3C,EAAK4G,EAAEhG,YACPoY,EAAKpS,EAAE8R,aACb,GAAI1Y,EAAKwW,GAAgBxW,EAAKgZ,EAAKvC,EAAe,OAAO,EAG3D,OAAO,EAOR,SAASsB,EAAW3d,EAAMwe,GACzB,MAAMK,EAAM,IAAIC,gBAAe7J,IAC9B,IAAK,MAAMM,KAAMN,EAAK/P,EAASqQ,EAAGlY,OAAQmhB,MAE3C,IAAK,MAAMphB,KAAK4C,EACf6e,EAAI5a,QAAQ7G,GACZA,EAAE+G,iBAAiB,SAAUlC,GAAS,KAAQiD,EAAS9H,EAAGohB,OAI5D,SAAStZ,EAAS0Y,EAAKY,GACtB,GAAIZ,EAAImB,YAAcnB,EAAIpX,YAAc,EAAG,CAC1C,MAAM6O,EAAIuI,EAAIoB,YAAcpB,EAAImB,YAAcnB,EAAIpX,aAClDrF,EAASyc,EAAKY,EAAK3B,iBAAkBxH,EAAI,KACzClU,EAASyc,EAAKY,EAAK1B,gBAAiB,IAAOzH,QAE3ClU,EAASyc,EAAKY,EAAK3B,kBAAkB,GACrC1b,EAASyc,EAAKY,EAAK1B,iBAAiB,GAQtC,SAAS1R,EAAMwS,EAAKY,GACnBZ,EAAInV,gBAAgB,SAChBmV,EAAIvY,MAAMM,QAAOiY,EAAIvY,MAAMM,MAAQ,MACnCiY,EAAIvY,MAAMsC,SAAQiW,EAAIvY,MAAMsC,OAAS,MAEzC,MAAMsX,EAAQC,EAAatB,GAG3BuB,EAAaF,EADCG,EAAcH,EADdza,OAAOC,OAAO4a,EAAWzB,EAAKqB,GAAOT,KAInD,MAAMlK,EAAKsJ,EAAIngB,qBAAqB,WAChC6W,EAAGvR,SAAQuR,EAAG,GAAGhN,UAAa,SAAQgN,EAAG,GAAGhN,oBAOjD,SAAS4X,EAAa9hB,GACrB,MAAMkiB,EAAMC,EAAaniB,GACzB,IAAIoiB,EAAW,EACf,IAAK,MAAMlL,KAAMgL,EAAKE,EAAWzD,KAAKC,IAAIwD,EAAUlL,EAAGvR,QACvD,MAAM0c,EAAI,GACV,IAAK,MAAMnL,KAAMgL,EAAKG,EAAExgB,KAAK,IAAI1B,MAAMiiB,IAEvC,IAAK,IAAI7F,EAAI,EAAGA,EAAI8F,EAAE1c,OAAQ4W,GAAK,EAAG,CACrC,MAAM+F,EAAKD,EAAE9F,GACPgG,EAAML,EAAI3F,GAChB,IAAIvW,EAAI,EAER,IAAK,IAAIwc,EAAI,EAAGA,EAAIJ,EAAUI,GAAK,EAAG,CACrC,GAAqB,iBAAVF,EAAGE,IAA6B,OAAVF,EAAGE,GAAa,SAEjD,MAAM/B,EAAK8B,EAAIvc,GACTyc,EAAMhe,SAASgc,EAAGtV,aAAa,YAAc,EAAG,IAChDuX,EAAMje,SAASgc,EAAGtV,aAAa,YAAc,EAAG,IAGtD,GAFAmX,EAAGE,GAAK/B,EAEJ,EAAIgC,EACP,IAAK,IAAI1T,EAAI,EAAGA,EAAI0T,EAAK1T,GAAK,EAAGuT,EAAGE,EAAIzT,GAAKA,EAE9C,GAAI,EAAI2T,EACP,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAKC,GAAK,EAAG,CAChC,MAAMC,EAAKP,EAAE9F,EAAIoG,GACjB,IAAK,IAAI5T,EAAI,EAAGA,EAAI0T,EAAK1T,GAAK,EAAG6T,EAAGJ,EAAIzT,GAAK,KAI/C,GADA/I,GAAK,EACDuc,EAAI5c,QAAUK,EAAG,OAGvB,OAAOqc,EAGR,SAASF,EAAaniB,EAAGkiB,EAAM,IAC9B,IAAK,MAAMZ,KAAMthB,EAAEqhB,KAAM,CACxB,MAAMnK,EAAK,GACX,GAAIoK,EAAGC,gBACN,IAAK,MAAMnS,KAAKkS,EAAG1T,WAAY,CAC9B,MAAMU,EAAKc,EAAEK,QACF,OAAPnB,GAAsB,OAAPA,GAAa4I,EAAGrV,KAAKuN,GAG1C8S,EAAIrgB,KAAKqV,GAEV,OAAOgL,EAOR,SAASD,EAAWzB,EAAKqB,GACxB,MAAMgB,EAAWrC,EAAIpX,YACf0Z,EAAa,GACnB,IAAK,IAAIN,EAAI,EAAGA,EAAIX,EAAK,GAAGlc,OAAQ6c,GAAK,EACxC,IAAK,IAAIjG,EAAI,EAAGA,EAAIsF,EAAKlc,OAAQ4W,GAAK,EAAG,CACxC,MAAM8F,EAAIR,EAAKtF,GAAGiG,GAClB,GAAIH,aAAaU,uBAAyBV,EAAElX,aAAa,WAAY,CACpE2X,EAAWjhB,KAAKwgB,EAAEjZ,aAClB,OAIH,MAAO,CAAEyZ,SAAAA,EAAUC,WAAAA,GAOpB,SAASd,EAAcH,EAAMmB,GAC5B,IAAK,MAAMV,KAAMT,EAChB,IAAK,MAAMoB,KAAMX,EACE,iBAAPW,GAA0B,OAAPA,IAAaA,EAAGhb,MAAMib,WAAa,UAGnE,MAAMC,EAAKtB,EAAK,GAAGlc,OACbyd,EAAQ,IAAIjjB,MAAMgjB,GAAIvd,KAAK,GAC3Byd,EAAQ,IAAIljB,MAAMgjB,GAAIvd,KAAK,GAEjC,IAAK,MAAM0c,KAAMT,EAChB,IAAK,IAAIW,EAAI,EAAGA,EAAIW,EAAIX,GAAK,EAAG,CAC/B,MAAM/B,EAAK6B,EAAGE,GACd,GAAI/B,MAAAA,GAAiD,iBAAPA,EAAiB,SAC/D,GAAI+B,EAAIW,EAAK,GAA0B,iBAAdb,EAAGE,EAAI,GAAiB,SACjD,GAAI,EAAI/d,SAASgc,EAAGtV,aAAa,WAAY,IAAK,SAClD,GAAI,EAAI1G,SAASgc,EAAGtV,aAAa,WAAY,IAAK,SAElD,MAAMmY,EAAOC,EAAa9C,EAAIuC,GAC9BI,EAAMZ,GAAK7D,KAAKC,IAAIwE,EAAMZ,GAAIc,GACzBA,IAAMD,EAAMb,GAAK7D,KAAKC,IAAIyE,EAAMb,GAAI/B,EAAGrX,cAI9C,OADAoa,EAAcJ,EAAOC,EAAOL,GACrBI,EAGR,SAASG,EAAa9C,EAAIuC,GACzB,MAAMpD,KAAEA,EAAFC,KAAQA,EAARe,MAAcA,EAAdC,MAAqBA,EAArBf,KAA4BA,EAA5BE,KAAkCA,EAAlChB,aAAwCA,EAAxCC,cAAsDA,EAAtDC,cAAqEA,GAAkB8D,EAC7F,GAAIS,EAAkBhD,GAAMvB,EAAe,OAAO,EAElDuB,EAAGvW,UAAYuW,EAAGvW,UAAUX,OAC5B,MAAMma,EAAoB,OAAfjD,EAAGhR,QAAmBqQ,EAAOE,EACxC0D,EAAGxZ,UAAYuW,EAAGvW,UAClB,MAAMhC,EAAKwb,EAAGta,YAAcwW,EACtB+D,EAAKhF,KAAKiF,OAAOF,EAAGxC,aAAerB,GAAQgB,GACjD,IAAIyC,EAAO,EACX,IAAK,IAAItd,EAAI,GAAIA,GAAK,EAAG,CACxB,MAAM6d,EAAQ,EAAK3b,EAAKlC,EAAI4a,EAAQ5a,EAAI4Z,EAClCkE,EAAQH,GAAM3d,EAAI6a,GAAShB,EACjC,GAAIgE,EAAQ7E,GAAgB6E,EAAQC,EAAQ7E,GAAkBqE,GAAQA,EAAOO,EAAQ,MACrFP,EAAOO,EAER,OAAQP,EAAO1C,EAAQ8C,EAAGta,YAAeka,EAAO,EAGjD,SAASG,EAAkBhD,GAC1B,MAEM3gB,EAFK2gB,EAAGvW,UAAUX,OACVoI,MAAM,mBACN9J,KAAIlH,GAAKA,EAAEiG,QAAQ,+BAAgC,IAAIjB,SACrE,OAAOgZ,KAAKC,OAAO9e,GAGpB,SAAS0jB,EAAcJ,EAAOC,EAAOL,GACpC,MAAMH,SAAEA,EAAFC,WAAYA,GAAeE,EACjC,IAAIe,EAAO,EAAGC,EAAO,EACrB,IAAK,IAAIhe,EAAI,EAAGA,EAAIod,EAAMzd,OAAQK,GAAK,EAClCod,EAAMpd,GACT+d,GAAQX,EAAMpd,GAEdge,GAAQX,EAAMrd,GAGhB,GAAI6c,EAAWkB,EAAOC,EAAM,OAC5B,IAAIC,EAAMpB,EAAWmB,EACrB,IAAK,IAAIhe,EAAI,EAAGA,EAAIod,EAAMzd,OAAQK,GAAK,EAAG,CACzC,IAAKod,EAAMpd,GAAI,SACf,MAAMke,EAAKd,EAAMpd,GACXoC,EAAIuW,KAAKwF,IAAID,EAAKH,EAAOE,EAAKnB,EAAW9c,IAC/Cie,GAAS7b,EAAI8b,EACbH,GAAS3b,EAAI8b,EACbd,EAAMpd,GAAK,EAAIoC,GAQjB,SAAS2Z,EAAaF,EAAMzQ,GAC3B,IAAK,MAAMkR,KAAMT,EAChB,IAAK,IAAIW,EAAI,EAAGA,EAAIF,EAAG3c,OAAQ6c,GAAK,EAAG,CACtC,MAAMS,EAAKX,EAAGE,GAAIpa,EAAIgJ,EAAGoR,GACpBpa,GAAO6a,aAAcF,uBAC1BE,EAAGhb,MAAMib,WAAa,KACtBD,EAAGhb,MAAMP,SAAaU,EAAI,KAC1B6a,EAAGhb,MAAMM,MAAa,OAIzBhJ,EAAGsD,eAAiBnD,EAGrB,CAWC,SAASA,EAAWkD,EAAMuE,EAAO,IAChC,GAAoB,IAAhBvE,EAAK+C,OAAc,OACvB,MAAMmZ,EAAK1X,OAAOC,OAAO,CACxB+c,wBAAyB,GACzBC,qBAAyB,gCACzBC,iBAAyB,4BACzBC,eAAyB,0BAEzB9E,iBAAkB,iBAClBC,gBAAkB,gBAClB5T,OAAkB,GAChB3E,GAEG+P,EAAK,GAAIpX,EAAK,IAAI8C,GACxB,IAAK,MAAM4d,KAAO1gB,EAAI,CACrB,MAAM8Q,EAAO4T,EAAmBhE,EAAK1B,GAC/BjD,EAAO4I,EAAgBjE,EAAK1B,GAClC5H,EAAGrV,KAAK,CAAE2e,IAAAA,EAAK5P,KAAAA,EAAMiL,IAAAA,IAErB,IAAI6I,GAAS,EACb,MAAMC,EAAK,CAACrhB,EAAKshB,IAAO/f,GAAS,KAC5B6f,EACHA,GAAS,GAETA,GAAS,EACTE,EAAGhD,WAAate,EAAIse,WAChBhR,GAAMiU,EAAcrE,EAAK5P,EAAMkO,OAGrC0B,EAAIzZ,iBAAiB,SAAU4d,EAAGnE,EAAK3E,IACvCA,EAAI9U,iBAAiB,SAAU4d,EAAG9I,EAAK2E,IAExC,MAAMsE,EAAK,IAAIpD,gBAAgBjb,IAC9B,IAAK,MAAM9F,KAAK8F,EAAI,CACnB,MAAMiD,EAAM5J,EAAG4K,QAAQ/J,EAAEV,QACnBiE,EAAIgT,EAAGxN,GACbqb,EAASpkB,EAAEqkB,YAAa9gB,EAAEsc,IAAKtc,EAAE0M,KAAM1M,EAAE2X,IAAKiD,OAGhD,IAAK,MAAM9e,KAAKF,EAAIglB,EAAGje,QAAQ7G,GAE/BV,OAAOyH,iBAAiB,SAAUlC,GAAS,KAC1C,IAAK,MAAMX,KAAKgT,EAAI+N,EAAe/gB,EAAEsc,IAAKtc,EAAE0M,KAAM1M,EAAE2X,IAAKiD,MACtD,CAAE7X,SAAS,IAEf,IAAIb,EAAK,KACThB,GAAS,KACR0Z,EAAGhT,OAASxH,IACR8B,GAAIC,aAAaD,GACrBA,EAAKE,YAAW,KACf,IAAK,MAAMpC,KAAKgT,EAAI6N,EAAS,KAAM7gB,EAAEsc,IAAKtc,EAAE0M,KAAM1M,EAAE2X,IAAKiD,KACvD,QACD,GAGJ,SAAS0F,EAAmBhE,EAAK1B,GAChC,IAAIoG,EAAQ1E,EAAI2E,MAChB,IAAKD,EAAO,CAEX,GADAA,EAAQE,EAAoB5E,IACvB0E,EAAO,OAAO,KACnB1E,EAAI2E,MAAQD,EAEb,MAAMG,EAAK1lB,SAAS2Q,cAAc,OAClCvM,EAASshB,EAAIvG,EAAGuF,sBAChB7D,EAAI1S,WAAWD,YAAYwX,GAE3B,MAAMC,EAAK3lB,SAAS2Q,cAAc,OAKlC,OAJAvM,EAASuhB,EAAIxG,EAAGwF,kBAChBe,EAAGxX,YAAYyX,GAEfA,EAAGzX,YAAYqX,EAAMK,WAAU,IACxBF,EAGR,SAASD,EAAoB5E,GAC5B,MAAMgF,EAAMhF,EAAIiF,QAAQ,GAAGpE,KAC3B,GAAmB,IAAfmE,EAAI7f,OAAc,OAAO,KAE7B,SAAS+f,EAAepE,GACvB,MAAMiB,EAAMjB,EAAGjhB,qBAAqB,MAC9BslB,EAAMrE,EAAGjhB,qBAAqB,MACpC,OAAmB,IAAfkiB,EAAI5c,QAAgBggB,EAAIhgB,OAAS,EAGtC,MAAMigB,EAAO,GACb,IAAK,MAAMtE,KAAMkE,EAAK,CACrB,IAAKE,EAAepE,GAAK,MACzBsE,EAAK/jB,KAAKyf,GAEX,GAAoB,IAAhBsE,EAAKjgB,OAAc,OAAO,KAE9B,MAAMuf,EAAQ1E,EAAIqF,cAClB,IAAK,MAAMvE,KAAMsE,EAAMV,EAAMrX,YAAYyT,GACzC,OAAO4D,EAGR,SAAST,EAAgBjE,EAAK1B,GAC7B,MAAMjD,EAAMlc,SAAS2Q,cAAc,OACnCvM,EAAS8X,EAAKiD,EAAGyF,gBACjB,MAAMuB,EAASnmB,SAAS2Q,cAAc,OAGtC,OAFAuL,EAAIhO,YAAYiY,GAChBtF,EAAI1S,WAAWD,YAAYgO,GACpBA,EAOR,SAASkJ,EAAS9M,EAAGuI,EAAK5P,EAAMiL,EAAKiD,GACpC0B,EAAIvY,MAAM8d,UAAavF,EAAImB,YAAcnB,EAAIpX,YAAc,EAAK,SAAW,KAEvEwH,GAAMoV,EAAkB/N,EAAGuI,EAAK5P,EAAMkO,GACtCjD,GAAKoK,EAAqBzF,EAAK3E,IAC/BjL,GAAQiL,IAAKoJ,EAAezE,EAAK5P,EAAMiL,EAAKiD,GAC5ClO,GAAMiU,EAAcrE,EAAK5P,EAAMkO,GAGpC,SAASkH,EAAkB/N,EAAGuI,EAAK5P,EAAMkO,GACxC,MAAMoH,EAAKjO,EAAIA,EAAE1P,MAAQiY,EAAIlY,wBAAwBC,MACrDqI,EAAK3I,MAAMma,SAAW8D,EAAK,KAC3BtV,EAAK3I,MAAMc,QAAW,OACtB6H,EAAK3I,MAAMuN,IAAWsJ,EAAGhT,OAAS,KAElC,MAAMoZ,EAAQ1E,EAAI2E,MACZgB,EAAKjB,EAAM5c,wBAAwBC,MACnC+c,EAAK1U,EAAK0M,WAChBgI,EAAGrd,MAAMM,MAAQ4d,EAAK,KAEtB,MAAMC,EAAOlB,EAAM7D,KACbgF,EAAOf,EAAGhI,WAAW+D,KAC3B,IAAK,IAAIrb,EAAI,EAAGA,EAAIogB,EAAKzgB,OAAQK,GAAK,EACrCsgB,EAAUF,EAAKpgB,GAAIqgB,EAAKrgB,GAAI,MAC5BsgB,EAAUF,EAAKpgB,GAAIqgB,EAAKrgB,GAAI,MAE7B,SAASsgB,EAAUC,EAAGriB,EAAGsiB,GACxB,MAAMC,EAAKF,EAAElmB,qBAAqBmmB,GAC5BtP,EAAKhT,EAAE7D,qBAAqBmmB,GAClC,IAAK,IAAIxgB,EAAI,EAAGA,EAAIygB,EAAG9gB,OAAQK,GAAK,EACnCkR,EAAGlR,GAAGiC,MAAMM,MAAQke,EAAGzgB,GAAGsC,wBAAwBC,MAAQ,MAK7D,SAAS0d,EAAqBzF,EAAK3E,GAClC,MAAM6K,EAAYlG,EAAImB,YAAcnB,EAAIpX,YAAc,EACtDyS,EAAI5T,MAAM8d,UAAgBW,EAAW,SAAW,KAChD7K,EAAI5T,MAAM0V,cAAgB+I,EAAW,OAAW,KAEhD7K,EAAI5T,MAAMma,SAAY,GAAE5B,EAAIpX,gBAC5ByS,EAAI5T,MAAMc,QAAU,OACpB,MAAMnH,EAAI6C,SAASkiB,EAAkBhnB,SAAS6E,kBAC1C,EAAI5C,IAAGia,EAAI5T,MAAMsC,OAAU3I,EAAI,EAAK,MACxCia,EAAIyB,WAAWrV,MAAMM,MAAS,GAAEiY,EAAImB,gBAOrC,SAASsD,EAAezE,EAAK5P,EAAMiL,EAAKiD,GACvC,MAAM7G,EAAIuI,EAAIlY,wBACRse,EAAU3O,EAAEgG,OACZ4I,GAAMrG,EAAI2E,OAAS3E,EAAIiF,QAAQ,IAAInd,wBACnCwe,EAAOD,EAAGrR,IAAKuR,EAAUF,EAAG5I,OAC5B+I,EAAMlI,EAAGhT,OAAQmb,EAAM3nB,OAAOkd,YAE9B0K,EAASN,EAAUE,EAAOhI,EAAGsF,yBAA2B6C,EAAMD,GAC9DG,EAAQlP,EAAE9V,KAAMilB,EAAc5G,EAAIoB,WACxC,GAAIhR,EAAM,CACT,MAAMyW,EAAM7G,EAAI2E,MAAMtL,aAEtByN,EAAwB1W,GADZsW,GAAUJ,EAAOE,GAAOA,EAAMJ,EAAUS,EACnBF,EAAOC,GAEzC,GAAIvL,EAAK,CAER0L,EAAqB1L,GADTqL,GAAUH,EAAUE,GAAOA,EAAML,EAChBO,EAAOC,IAItC,SAASE,EAAwB1W,EAAM4W,EAASC,EAASC,GACxD9W,EAAK3I,MAAMc,QAAUye,EAAU,QAAU,OACzC5W,EAAK3I,MAAM9F,KAAUslB,EAAU,KAC/B7W,EAAKgR,WAAgB8F,EAGtB,SAASH,EAAqB1L,EAAK2L,EAASC,EAASC,GACpD7L,EAAI5T,MAAMc,QAAUye,EAAU,QAAU,OACxC3L,EAAI5T,MAAM9F,KAAUslB,EAAU,KAC9B5L,EAAI+F,WAAgB8F,EAOrB,SAAS7C,EAAcrE,EAAK5P,EAAMkO,GACjC,MAAM6I,EAAKhJ,KAAKC,IAAI,EAAGD,KAAKwF,IAAI3D,EAAIoB,WAAYpB,EAAImB,YAAcnB,EAAIoH,cAGtE,GAFAhX,EAAKgR,WAAa+F,EAEdnH,EAAImB,YAAcnB,EAAIpX,YAAc,EAAG,CAC1C,MAAM6O,EAAIuI,EAAIoB,YAAcpB,EAAImB,YAAcnB,EAAIpX,aAClDrF,EAAS6M,EAAMkO,EAAGW,iBAAkBxH,EAAI,KACxClU,EAAS6M,EAAMkO,EAAGY,gBAAiB,IAAOzH,QAE1ClU,EAAS6M,EAAMkO,EAAGW,kBAAkB,GACpC1b,EAAS6M,EAAMkO,EAAGY,iBAAiB,GAQrC,SAASiH,EAAkBkB,GAC1B,MAAM5a,EAAItN,SAAS2Q,cAAc,OACjCrD,EAAExB,aAAa,QAAS,sEACxBoc,EAAOha,YAAYZ,GACnB,IAAI1E,EAAQ,EAAIjJ,OAAOiF,iBAAiB0I,GAAG6a,iBAAiB,SAE5D,GAAc,IAAVvf,EAAa,CAChB0E,EAAEhF,MAAM8f,UAAY,SACpB9a,EAAEhF,MAAMM,MAAQ,GAChB,MAAMrE,EAAIvE,SAAS2Q,cAAc,OACjCpM,EAAE+D,MAAMoE,UAAY,QACpBY,EAAEY,YAAY3J,GACd,MAAMsE,EAAK,EAAIlJ,OAAOiF,iBAAiBL,GAAG4jB,iBAAiB,SAC3Dvf,EAAQ0E,EAAE2a,YAAcpf,EAGzB,OADAqf,EAAOnK,YAAYzQ,GACZ1E,EAERhJ,EAAGuD,gBAAkBpD,EAMvB,CAWC,SAASsoB,IACR,IAAIC,EAAKC,EAET,MAAM9f,EAAI9I,OAAOwJ,WAEhBmf,EADG7f,EAAI,IACD,iBACIA,EAAI,IACR,kBACIA,EAAI,IACR,kBACIA,EAAI,KACR,mBACIA,EAAI,KACR,UAEA,cAEP,MAAMxG,EAAItC,OAAOkd,YAUjB,OARC0L,EADGtmB,EAAI,IACD,OACIA,EAAI,IACR,QACIA,EAAI,IACR,SAEA,QAEA,CAACqmB,EAAKC,GAOd,SAASC,IACR,MAAMC,EAAK9oB,OAAOsK,UAAUC,UAAUC,cACtC,OAAIse,EAAGxnB,SAAS,UACR,SAEJwnB,EAAGxnB,SAAS,UACR,SAEJwnB,EAAGxnB,SAAS,WACR,eADR,EAKD,SAASynB,IACR,MAAMD,EAAK9oB,OAAOsK,UAAUC,UAAUC,cAEhC+F,EAAM,GAkBZ,OAjBIuY,EAAGxnB,SAAS,YACfiP,EAAIhO,KAAK,WAENumB,EAAGxnB,SAAS,WACfiP,EAAIhO,KAAK,OACTgO,EAAIhO,KAAK,WACCumB,EAAGxnB,SAAS,SACtBiP,EAAIhO,KAAK,OACTgO,EAAIhO,KAAK,SACCumB,EAAGxnB,SAAS,YAAcwnB,EAAGxnB,SAAS,WAAa,eAAgBjB,WAC7EkQ,EAAIhO,KAAK,OACTgO,EAAIhO,KAAK,QACTgO,EAAIhO,KAAK,iBAELgO,EAAIlK,QACRkK,EAAIhO,KAAK,WAEHgO,EAGRtQ,EAAE,QAAc4oB,IAChB5oB,EAAE,OAAc8oB,IAEhBjjB,GAAS,MACP7F,EAAE,SAAcA,EAAE,WAAiByoB,OAClC,GAKJ,CAWC,SAAStoB,EAAWyK,EAAIhD,EAAO,IAC9B,GAAkB,IAAdgD,EAAGxE,OAAc,OAErBwB,EAAOC,OAAOC,OAAO,CACpBihB,UAAc,YACdC,YAAc,kBACdC,UAAc,gBACdC,UAAc,gBACdC,aAAc,mBAEdC,UAAgB,UAChBC,aAAgB,aAChBC,eAAgB,eAEhB5N,WAAY,WACV9T,GAEH,MAAMjH,EAAKiK,EAAGtC,KAAIuC,IACjB,MAAM8Q,EAAO4N,EAAa3hB,EAAMiD,EAAEmL,KAAMnL,EAAE2e,UAAW3e,EAAE4e,MAAO5e,EAAE6e,SAEhE,OADA7e,EAAE8e,OAAOniB,iBAAiB,SAASpG,GAAKwoB,EAAQjO,EAAMva,KAC/Cua,KAERkO,EAAmBlpB,GACnBmpB,EAAYnpB,EAAIiH,EAAI,YAGrB,SAASiiB,EAAmBlpB,GAC3BkF,GAAS,KACR,IAAK,MAAM8V,KAAQhb,EAAIgb,EAAKoO,GAAGvE,WAC/Bze,YAAW,KAAQ,IAAK,MAAM4U,KAAQhb,EAAIgb,EAAKoO,GAAGvE,aAAe,QAElEzlB,OAAOyH,iBAAiB,WAAWpG,IAClC,GAAkB,OAAd4oB,IAAuB5oB,EAAEgY,SAAWhY,EAAE8X,UAAY9X,EAAE+X,SAAU,CACjE,MAAM8Q,EAAMtpB,EAAGqpB,GACD,WAAV5oB,EAAE6C,IAAkBgmB,EAAIC,IAAIC,QACb,cAAV/oB,EAAE6C,IAAqBgmB,EAAIG,QAAQD,QACzB,eAAV/oB,EAAE6C,KAAsBgmB,EAAII,QAAQF,YAKhD,SAASL,EAAYnpB,EAAI+a,GACxB3b,OAAOyH,iBAAiB,YAAYpG,IACjB,OAAd4oB,GAAoBM,EAAQ3pB,EAAGqpB,IAC/B5oB,EAAEmpB,OAA6B,cAApBnpB,EAAEmpB,MAAF,WAAqDnmB,IAAlBhD,EAAEmpB,MAAF,IACjDC,EAAO7pB,EAAGS,EAAEmpB,MAAF,QAGZxqB,OAAOyH,iBAAiB,cAAc,IAAMijB,EAAU9pB,EAAI+a,EAAYxO,SAAS8I,QAC/EyU,EAAU9pB,EAAI+a,EAAYxO,SAAS8I,MAGpC,SAASyU,EAAU9pB,EAAI+a,EAAY1F,GAClC,GAAgD,IAA5C9I,SAAS8I,KAAK7K,QAAQ,IAAMuQ,GAAmB,OACnD,MAAMgP,EAAK1U,EAAK3O,QAAQ,IAAMqU,EAAY,IAC1C,GAAKgP,EACL,IAAK,IAAIjkB,EAAI,EAAGA,EAAI9F,EAAGyF,OAAQK,GAAK,EACnC,GAAI9F,EAAG8F,GAAGuP,OAAS0U,EAAI,CACJ,OAAdV,GAAsBA,IAAcvjB,GAAG6jB,EAAQ3pB,EAAGqpB,IACpC,OAAdA,GAAsBA,IAAcvjB,GAAG+jB,EAAO7pB,EAAG8F,IACrD,OASH,IAAIkkB,EAAgB,EAChBC,EAAgB,KAChBZ,EAAgB,KAEpB,SAAST,EAAa3hB,EAAMoO,EAAMwT,EAAWC,EAAOC,EAAU,MAC7D,MAAM/N,EAAO,GACbA,EAAK/T,KAAOA,EACZ+T,EAAKoO,GAAOP,EACZ7N,EAAK9F,GAAO8U,IACZhP,EAAK3F,KAAOA,EAEZ2F,EAAKuO,IAAM9pB,SAAS2Q,cAAc,OAClCvM,EAASmX,EAAKuO,IAAKtiB,EAAKmhB,WACxBpN,EAAKuO,IAAI1iB,iBAAiB,SAASpG,GAAKypB,EAASzpB,KACjDua,EAAKuO,IAAI5b,YAAYmb,GAErB,MAAMqB,EAAM1qB,SAAS2Q,cAAc,UAWnC,GAVAvM,EAASsmB,EAAKljB,EAAKohB,aACnBrN,EAAKuO,IAAI5b,YAAYwc,GAErBnP,EAAKyO,QAAUhqB,SAAS2Q,cAAc,UACtC4K,EAAK0O,QAAUjqB,SAAS2Q,cAAc,UACtCvM,EAASmX,EAAKyO,QAASxiB,EAAKqhB,WAC5BzkB,EAASmX,EAAK0O,QAASziB,EAAKshB,WAC5BvN,EAAKuO,IAAI5b,YAAYqN,EAAKyO,SAC1BzO,EAAKuO,IAAI5b,YAAYqN,EAAK0O,SAEtBX,EAAS,CACZ,MAAMqB,EAAS3qB,SAAS2Q,cAAc,OACtCga,EAAOpgB,UAAa,SAAQ+e,WAC5BllB,EAASumB,EAAQnjB,EAAKuhB,cACtBxN,EAAKuO,IAAI5b,YAAYyc,GAMtB,OAJA3qB,SAAS4qB,KAAK1c,YAAYqN,EAAKuO,KAE/Be,EAAqBtP,EAAMiP,GAC3BA,EAAejP,EACRA,EAOR,SAAS6O,EAAO7O,EAAMuP,GAAY,GAIjC,GAHA1mB,EAASmX,EAAKuO,IAAKvO,EAAK/T,KAAKwhB,WAC7BzN,EAAKoO,GAAGS,SAEJU,EAAW,CACdvP,EAAKoO,GAAGvE,WACRhhB,EAASmX,EAAKuO,IAAKvO,EAAK/T,KAAK0hB,gBAC7B9kB,EAASmX,EAAKuO,IAAKvO,EAAK/T,KAAKyhB,cAC7BtiB,YAAW,KAAQvC,EAASmX,EAAKuO,IAAKvO,EAAK/T,KAAK0hB,gBAAgB,KAAW,IAE3E,MAAM3T,EAAM,IAAMgG,EAAK/T,KAAK8T,WAAaC,EAAK3F,KAC9C6D,QAAQsR,aAAa,KAAM,GAAIxV,QAE/B5O,YAAW,KACV4U,EAAKoO,GAAGvE,WACRhhB,EAASmX,EAAKuO,IAAKvO,EAAK/T,KAAKyhB,gBAC3B,GAEJW,EAAYrO,EAAK9F,GAGlB,SAASyU,EAAQ3O,EAAMuP,GAAY,GAClCvP,EAAKoO,GAAGO,UAEJY,GACH1mB,EAASmX,EAAKuO,IAAKvO,EAAK/T,KAAK0hB,gBAC7B9kB,EAASmX,EAAKuO,IAAKvO,EAAK/T,KAAKyhB,cAAc,GAC3CtiB,YAAW,KAAQvC,EAASmX,EAAKuO,IAAKvO,EAAK/T,KAAK0hB,gBAAgB,KAAW,KAE3E9kB,EAASmX,EAAKuO,IAAKvO,EAAK/T,KAAKyhB,cAAc,GAE5CtiB,YAAW,KAAQvC,EAASmX,EAAKuO,IAAKvO,EAAK/T,KAAKwhB,WAAW,KAAW,KACtEY,EAAY,KAOb,SAASiB,EAAqBtP,EAAMyP,GACnCzP,EAAK0O,QAAQ3hB,MAAMc,QAAU,OACzB4hB,GACHzP,EAAKyO,QAAQ5iB,iBAAiB,SAASpG,IACtCA,EAAEsY,kBACF4Q,EAAQ3O,GAAM,GACd6O,EAAOY,GAAM,MAEdC,EAAiBD,EAAMzP,IAEvBA,EAAKyO,QAAQ1hB,MAAMc,QAAU,OAI/B,SAAS6hB,EAAiB1P,EAAM2P,GAC/B3P,EAAK0O,QAAQ7iB,iBAAiB,SAASpG,IACtCA,EAAEsY,kBACF4Q,EAAQ3O,GAAM,GACd6O,EAAOc,GAAM,MAEd3P,EAAK0O,QAAQ3hB,MAAMc,QAAU,KAG9B,SAASogB,EAAQjO,EAAMva,GAItB,GAHAA,EAAEuY,iBACF6Q,EAAO7O,GAEHzO,SAAS8I,KAAM,CAClB,MAAMuV,EAASre,SAAS6I,KAAK7R,OAAO,EAAGgJ,SAAS6I,KAAK5K,QAAQ,MAC7D0O,QAAQsR,aAAa,KAAM,GAAII,GAEhC,MAAM5V,EAAM,IAAMgG,EAAK/T,KAAK8T,WAAaC,EAAK3F,KAC9C6D,QAAQC,UAAU,CAAE0R,KAAM,YAAa3V,GAAI8F,EAAK9F,IAAM,KAAMF,GAG7D,SAASkV,EAASzpB,GACjBA,EAAEuY,iBACFE,QAAQ4R,OAaT,SAASC,EAASre,EAAKse,GAAQ,GAC9B,IAAItpB,EAAI,WACR,IAAK,IAAIoE,EAAI,EAAGA,EAAI4G,EAAIjH,OAAQK,GAAK,EACpCpE,GAAKgL,EAAIue,WAAWnlB,GACpBpE,IAAMA,GAAK,IAAMA,GAAK,IAAMA,GAAK,IAAMA,GAAK,IAAMA,GAAK,IAExD,OAAIspB,GAAe,WAAatpB,IAAM,GAAGwpB,SAAS,KAAK3nB,QAAQ,GACxD7B,IAAM,EAId,CAWC,SAASypB,EAAcvrB,GACtB,MAAMwrB,EAAMhsB,OAAOisB,YAAaC,EAAMlsB,OAAOka,YAC7C,IAAIgJ,EAAI,EAAGjG,EAAI,EAQf,OAPkB,IAAdzc,EAAG6F,QACN6c,EAAI1iB,EAAG,GAAG2rB,MAAQH,EAClB/O,EAAIzc,EAAG,GAAG4rB,MAAQF,GACR,GAAK1rB,EAAG6F,SAClB6c,GAAK1iB,EAAG,GAAG2rB,MAAQ3rB,EAAG,GAAG2rB,OAAS,EAAIH,EACtC/O,GAAKzc,EAAG,GAAG4rB,MAAQ5rB,EAAG,GAAG4rB,OAAS,EAAIF,GAEhC,CAAChJ,EAAGjG,GAGZ,SAASoP,EAAc7rB,GACtB,MAAM8rB,EAAK9rB,EAAG,GAAG+rB,QAASC,EAAKhsB,EAAG,GAAGisB,QAC/BC,EAAKlsB,EAAG,GAAG+rB,QAASI,EAAKnsB,EAAG,GAAGisB,QACrC,OAAOpN,KAAKuN,KAAKvN,KAAKwN,IAAIH,EAAKJ,EAAI,GAAKjN,KAAKwN,IAAIF,EAAKH,EAAI,IAG3D,SAASM,EAAuBhiB,GAC/B,IAAIiiB,GAAa,EACjB/sB,OAAOyH,iBAAiB,aAAcpG,IAChC0rB,IACL1rB,EAAEuY,iBACFvY,EAAE2rB,8BACA,CAAErlB,SAAS,IACdmD,EAAErD,iBAAiB,cAAc,KAAQslB,GAAa,KACtDjiB,EAAErD,iBAAiB,YAAY,KAAQslB,GAAa,KAGrD,SAASE,EAAe5rB,GACvB,MAAO,CAACA,EAAE8qB,MAAQnsB,OAAOisB,YAAa5qB,EAAE+qB,MAAQpsB,OAAOka,aAaxD,SAASgT,EAAsBprB,EAAI+F,EAAO,IACzC,GAAkB,IAAd/F,EAAGuE,OAAc,OAErBwB,EAAOC,OAAOC,OAAO,CACpBolB,YAAoB,kBACpBC,mBAAoB,0BAClBvlB,GAUHzH,EARW0B,EAAGyG,KAAIM,IACjB,MAAMoN,EAAO0V,EAAS9iB,EAAEmN,OACjByT,EAAWC,GAAS2D,EAAiBxlB,EAAMgB,EAAEmN,MAC9C2T,EAAU2D,EAAoBzkB,GAGpC,OAFA0kB,EAAuB1kB,EAAGhB,EAAI,YAAiBA,EAAI,oBAE5C,CAAE+hB,OAAQ/gB,EAAGoN,KAAAA,EAAMwT,UAAAA,EAAWC,MAAAA,EAAOC,QAAAA,MAE9B9hB,GAOhB,SAASwlB,EAAiBxlB,EAAMmC,GAO/B,MAAM4R,EAAO,CACZ/T,KAPDA,EAAOC,OAAOC,OAAO,CACpBylB,gBAAiB,gBACjBC,YAAiB,YACjBC,YAAiB,IACf7lB,GAGImC,IAAAA,EAEN2jB,MAAW,EACXC,UAAW,EACXC,SAAW,KACXC,MAAW,EACXC,OAAW,EAEXC,IAAK,KACLC,IAAK,MAgBN,OAbArS,EAAKoS,IAAM3tB,SAAS2Q,cAAc,OAClCvM,EAASmX,EAAKoS,IAAKpS,EAAK/T,KAAK2lB,iBAE7B5R,EAAKqS,IAAM5tB,SAAS2Q,cAAc,OAClC4K,EAAKqS,IAAIxmB,iBAAiB,SAASpG,GAAKA,EAAEsY,oBAC1CiC,EAAKoS,IAAIzf,YAAYqN,EAAKqS,KAE1BC,EAAoBtS,EAAMA,EAAKoS,KAC/BG,EAAoBvS,EAAMA,EAAKoS,KAE/BpS,EAAI,SAAe,IAAMwS,EAAQxS,GACjCA,EAAI,OAAe,IAAMyS,EAAUzS,GACnCA,EAAI,QAAe,OACZ,CAACA,EAAMA,EAAKoS,KAGpB,SAASV,EAAoBzkB,GAC5B,GAA6B,WAAzBA,EAAE2F,WAAW2B,QAAsB,CACtC,MAAMzF,EAAM7B,EAAE2F,WAAWzN,qBAAqB,cAC9C,GAAI,EAAI2J,EAAIrE,OACX,OAAOqE,EAAI,GAAGE,UAGhB,OAAO,KAGR,SAAS2iB,EAAuB1kB,EAAGskB,EAAaC,GAC/C3oB,EAASoE,EAAGskB,GACiB,WAAzBtkB,EAAE2F,WAAW2B,SAChB1L,EAASoE,EAAE2F,WAAY4e,GAQzB,SAASgB,EAAQxS,GAChB,MAAM0S,EAAQ1S,EAAKoS,IAAI1F,YAAc1M,EAAKoS,IAAIzT,aACxCgU,EAAQ3S,EAAKqS,IAAI3F,YAAc1M,EAAKqS,IAAI1T,aAC9CqB,EAAKkS,KAAQQ,EAAQC,EAErB,MAAM3W,EAAK3S,iBAAiB2W,EAAKqS,KACjCrS,EAAKmS,OAAqC,EAA5B5oB,SAASyS,EAAG4W,cAE1B,MAAMruB,EAAIyb,EAAKqS,IAAItlB,MACnBxI,EAAEiI,SAAY,GACdjI,EAAE4M,UAAY,GACV6O,EAAKkS,MACR3tB,EAAE8I,MAAU,eAAc2S,EAAKmS,YAC/B5tB,EAAE8K,OAAS,SAEX9K,EAAE8I,MAAW,OACb9I,EAAE8K,OAAY,eAAc2Q,EAAKmS,YACjC5tB,EAAE2iB,SAAW,QAGdlH,EAAKiS,SAAWjS,EAAKkS,KAAOlS,EAAKoS,IAAIlkB,YAAe8R,EAAKoS,IAAIpM,aAC7D,MAAM6M,EAAU7S,EAAKkS,KAAOlS,EAAKqS,IAAIS,aAAe9S,EAAKqS,IAAIU,cAE7D/S,EAAKgS,UAAYa,EAAM7S,EAAKiS,SAC5BjS,EAAK+R,MAAY,EACjBiB,EAAkBhT,EAAKoS,IAAKpS,EAAKqS,KAGlC,SAASI,EAAUzS,GAClB,MAAMqS,EAAMrS,EAAKqS,IACZA,EAAIjkB,MACRikB,EAAItlB,MAAMmE,QAAU,IACpBmhB,EAAIjkB,IAAM4R,EAAK5R,IACfikB,EAAIxmB,iBAAiB,QAAQ,KAC5B2mB,EAAQxS,GACRnX,EAASmX,EAAKoS,IAAKpS,EAAK/T,KAAK4lB,aAC7BzmB,YAAW,KAAQinB,EAAItlB,MAAMmE,QAAU,MAAQ,OASlD,SAAS+hB,EAAejT,EAAM+R,GAC7B/R,EAAK+R,MAAQtO,KAAKC,IAAI,EAAGD,KAAKwF,IAAIjJ,EAAK/T,KAAK6lB,YAAaC,IAEzD,MAAMmB,EAAQlT,EAAKiS,SAAWjS,EAAK+R,MAAQ/R,EAAKmS,OAAU,KACtDnS,EAAKkS,KACRlS,EAAKqS,IAAItlB,MAAMP,SAAW0mB,EAE1BlT,EAAKqS,IAAItlB,MAAMoE,UAAY+hB,EAE5BF,EAAkBhT,EAAKoS,IAAKpS,EAAKqS,KAGlC,SAASW,EAAkBZ,EAAKC,GAC/B,MAAMc,EAAOd,EAAI3F,YAAa0G,EAAOf,EAAI1T,aACnC0U,EAAOjB,EAAIlkB,YAAaolB,EAAOlB,EAAIpM,aACnCzhB,EAAI8tB,EAAItlB,MACdxI,EAAE0C,KAAQksB,EAAOE,GAAWA,EAAOF,GAAQ,EAAK,KAAQ,EACxD5uB,EAAE+V,IAAQ8Y,EAAOE,GAAWA,EAAOF,GAAQ,EAAK,KAAQ,EAGzD,SAASd,EAAoBtS,EAAMoS,GAClC,IAAImB,EAAK,EAAGC,EAAK,EACbC,GAAW,EAmCf,SAASC,EAAajuB,EAAGssB,GACxBtsB,EAAEsY,kBACFtY,EAAEuY,iBAEF,MAAO2V,EAAIC,GAAMvC,EAAe5rB,GAC1BouB,GAAMF,EAAKvB,EAAI1L,YAAc1G,EAAK+R,MAClC+B,GAAMF,EAAKxB,EAAI2B,WAAc/T,EAAK+R,MAExCkB,EAAejT,EAAM+R,GAErBK,EAAI1L,WAAamN,EAAK7T,EAAK+R,MAAQ4B,EACnCvB,EAAI2B,UAAaD,EAAK9T,EAAK+R,MAAQ6B,EA5CpCxB,EAAIvmB,iBAAiB,aAAapG,IAC7BA,EAAE6X,SACN7X,EAAEuY,kBACDuV,EAAIC,GAAMnC,EAAe5rB,GAC1BguB,GAAW,MAEZrB,EAAIvmB,iBAAiB,aAAapG,IACjC,IAAKguB,EAAU,OACfhuB,EAAEsY,kBACFtY,EAAEuY,iBAEF,MAAO2V,EAAIC,GAAMvC,EAAe5rB,GAChC2sB,EAAI1L,YAAc6M,EAAKI,EACvBvB,EAAI2B,WAAcP,EAAKI,EACvBL,EAAKI,EACLH,EAAKI,KAENxB,EAAIvmB,iBAAiB,aAAapG,IAC5BguB,IACLhuB,EAAEsY,kBACFtY,EAAEuY,qBAEHoU,EAAIvmB,iBAAiB,WAAW,KAAQ4nB,GAAW,KAEnDrB,EAAIvmB,iBAAiB,SAASpG,IAC7B,MAAMlB,EAAI,EAAIkB,EAAEuuB,OAAS,IAAM,GAC/BN,EAAajuB,EAAGua,EAAK+R,MAAQxtB,MAC3B,GACH6tB,EAAIvmB,iBAAiB,YAAYpG,IAC5Bua,EAAKgS,UAAY,GACrB0B,EAAajuB,EAAGua,EAAK+R,MAAQ/R,EAAKgS,UAAYhS,EAAKgS,UAAY,MAC7D,GAiBJ,SAASO,EAAoBvS,EAAMoS,GAClC,IAAIyB,EAAK,EAAGC,EAAK,EACbG,EAAiB,EACjBC,EAAW,EA2Cf,SAASC,EAAYvvB,GACpBqvB,EAAiBrvB,EAAG6F,QACnBopB,EAAIC,GAVN,SAAgCxM,EAAGjG,GAClC,MAAM+S,EAAMhC,EAAI1L,WACV2N,EAAMjC,EAAI2B,UAGhB,MAAO,EAFKzM,EAAI8M,GAAOpU,EAAK+R,OAChB1Q,EAAIgT,GAAOrU,EAAK+R,OAMjBuC,IAA0BnE,EAAcvrB,IA3CpDssB,EAAuBkB,GAEvBA,EAAIvmB,iBAAiB,cAAcpG,IAClCyuB,EAAW,EACXC,EAAY1uB,EAAE8uB,YAEfnC,EAAIvmB,iBAAiB,aAAapG,IACjCA,EAAEuY,iBACFvY,EAAEsY,kBAEF,MAAMnZ,EAAKa,EAAE8uB,QACTN,IAAmBrvB,EAAG6F,QACzB0pB,EAAYvvB,GAEb,MAAO+uB,EAAIC,GAAMzD,EAAcvrB,GAE/B,GAAI,GAAKA,EAAG6F,OAAQ,CACnB,MAAM+pB,EAAO/D,EAAc7rB,GAC3B,GAAIsvB,EAAU,CACb,MAAM3vB,EAAIiwB,GAAQN,EAAWlU,EAAK+R,OAC9BxtB,GAAKA,IAAMkwB,EAAAA,GACdxB,EAAejT,EAAMA,EAAK+R,MAAQxtB,GAEnC6tB,EAAI1L,WAAamN,EAAK7T,EAAK+R,MAAQ4B,EACnCvB,EAAI2B,UAAaD,EAAK9T,EAAK+R,MAAQ6B,EAEpCM,EAAWM,EAAOxU,EAAK+R,WAEvBK,EAAI1L,WAAamN,EAAK7T,EAAK+R,MAAQ4B,EACnCvB,EAAI2B,UAAaD,EAAK9T,EAAK+R,MAAQ6B,IAElC,CAAE7nB,SAAS,IAgBf1H,EAAG4D,YAAcqpB,EAGlB,CAWC,SAASoD,EAAuBnJ,EAAIoJ,EAAM1oB,EAAO,IAChD,GAAkB,IAAdsf,EAAG9gB,OAAc,OAErBwB,EAAOC,OAAOC,OAAO,CACpBolB,YAAoB,kBACpBC,mBAAoB,0BAClBvlB,GASHzH,EAPW+mB,EAAG5e,KAAI,CAAC0e,EAAGvgB,KACrB,MAAMuP,EAAO0V,EAAS4E,EAAK7pB,GAAGsD,MACvByf,EAAWC,GAAS8G,EAAkB3oB,EAAM0oB,EAAK7pB,IAGxD,OAFA+pB,EAAwBxJ,EAAGpf,EAAI,aAExB,CAAE+hB,OAAQ3C,EAAGhR,KAAAA,EAAMwT,UAAAA,EAAWC,MAAAA,EAAOC,QAAS,SAEvC9hB,GAOhB,SAAS2oB,EAAkB3oB,EAAM6oB,GAChC7oB,EAAOC,OAAOC,OAAO,CACpB4oB,iBAAkB,iBAClBlD,YAAkB,aAChB5lB,GAEH,MAAMmC,EAAM4mB,EAAaF,EAAI1mB,KAI7B,GAFA0mB,EAAI3kB,gBAAgB,OACpB2kB,EAAIvkB,aAAa,eAAgB,KAC5BukB,EAAI/nB,MAAMoC,YAAa,CAC3B,MAAOjC,EAAGxG,GAAK0I,EAAkB0lB,GAC7B5nB,GAAKxG,IACRouB,EAAI/nB,MAAMoC,YAAe,GAAEjC,OAAOxG,KAIpC,MAAMsZ,EAAO,CACZ/T,KAAAA,EAAMmC,IAAAA,EAAK0mB,IAAAA,EAEX/C,MAAW,EACXC,UAAW,EACXC,SAAW,KACXC,MAAW,EACXC,OAAW,EAEXC,IAAK,MAYN,OATApS,EAAKoS,IAAM3tB,SAAS2Q,cAAc,OAClCvM,EAASmX,EAAKoS,IAAKpS,EAAK/T,KAAK8oB,kBAE7B/U,EAAK8U,IAAIjpB,iBAAiB,SAASpG,GAAKA,EAAEsY,oBAC1CiC,EAAKoS,IAAIzf,YAAYqN,EAAK8U,KAE1B9U,EAAI,SAAe,OACnBA,EAAI,OAAe,IAAMyS,EAAUzS,GACnCA,EAAI,QAAe,IAAMiV,EAAMjV,GACxB,CAACA,EAAMA,EAAKoS,KAGpB,SAASyC,EAAwBxJ,EAAGkG,GACnC1oB,EAASwiB,EAAGkG,GAOb,SAASkB,EAAUzS,GAClB,MAAM8U,EAAM9U,EAAK8U,IACbA,EAAII,aAAa,kBACpBJ,EAAI3kB,gBAAgB,gBACpB2kB,EAAI/nB,MAAMmE,QAAU,IACpB4jB,EAAIjpB,iBAAiB,QAAQ,KAC5BhD,EAASmX,EAAKoS,IAAKpS,EAAK/T,KAAK4lB,aAC7BzmB,YAAW,KAAQ0pB,EAAI/nB,MAAMmE,QAAU,MAAQ,MAEhD4jB,EAAIxjB,gBAAgBC,SAAS7F,QAAQsU,EAAK5R,MAI5C,SAAS6mB,EAAMjV,GACVA,EAAK5R,IAAI5F,WAAW,4BACvBwX,EAAK8U,IAAIK,cAAcC,YAAY,oDAAqD,KAQ1F,SAASJ,EAAa5mB,GACrB,GAAIA,EAAI5F,WAAW,2BAA4B,CAC9C,MAAMwR,EAAM,IAAIqb,IAAIjnB,GACd2T,EAAM,IAAIuT,gBAAgBtb,EAAIub,QACpCxT,EAAGyT,OAAO,cAAe,GACzBxb,EAAIub,OAASxT,EACb3T,EAAM4L,EAAIkW,WAEX,OAAO9hB,EAGR,SAASgB,EAAkBF,GAC1B,IAAIhC,EAAI3D,SAAS2F,EAAE7B,OACf3G,EAAI6C,SAAS2F,EAAEG,QACnB,GAAInC,GAAKxG,EAAG,MAAO,CAACwG,EAAGxG,GAEvB,MAAM4I,EAAKJ,EAAEnC,MAAMM,MACbkC,EAAKL,EAAEnC,MAAMsC,OACnB,OAAIC,EAAGE,QAAQ,QAAUF,EAAG7E,OAAS,GACjC8E,EAAGC,QAAQ,QAAUD,EAAG9E,OAAS,EADU,CAAC,EAAG,IAEnDyC,EAAI3D,SAAS+F,GACb5I,EAAI6C,SAASgG,GACTrC,GAAKxG,EAAU,CAACwG,EAAGxG,GAChB,CAAC,EAAG,IAGZrC,EAAG2D,aAAe0sB,IAx5GrB,CA45GGtwB,OAAM","file":"nacss.min.js","sourcesContent":["/**\n *\n * Script\n *\n * @author Takuto Yanagida\n * @version 2021-12-06\n *\n */\n\n\n'use strict';\n\nwindow['NACSS'] = window['NACSS'] || {};\n\n\n(function (NS) {\n\n\t{\n\t\t/**\n\t\t *\n\t\t * Initializer\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-12-06\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction initializeQuerySelector(s) {\n\t\t\tconst t = document.querySelector(s);\n\t\t\tinitialize(t);\n\t\t}\n\t\t\n\t\tfunction initializeQuerySelectorAll(s) {\n\t\t\tconst ts = document.querySelectorAll(s);\n\t\t\tfor (const t of ts) initialize(t);\n\t\t}\n\t\t\n\t\tfunction initialize(target) {\n\t\t\t// Delay\n\t\t\n\t\t\tconst is  = Array.from(target.getElementsByTagName('img'));\n\t\t\tconst tis = Array.from(target.querySelectorAll('table img'));\n\t\t\tconst ifs = Array.from(target.getElementsByTagName('iframe'));\n\t\t\n\t\t\tNACSS.delayImage(is.filter(e => !tis.includes(e)));\n\t\t\tNACSS.delayIframe(ifs);\n\t\t\n\t\t\t// Content\n\t\t\n\t\t\tconst figs = target.getElementsByTagName('figure');\n\t\t\tconst ss   = target.getElementsByTagName('span');\n\t\t\n\t\t\tNACSS.contentImageAlt(is);\n\t\t\tNACSS.contentFigureCaption(figs);\n\t\t\tNACSS.contentIframeAspect(ifs);\n\t\t\tNACSS.contentUnderline(ss);\n\t\t\n\t\t\t// Link\n\t\t\n\t\t\tconst as = target.getElementsByTagName('a');\n\t\t\tNACSS.linkApply(as);\n\t\t\n\t\t\tif (!CSS.supports('scroll-behavior', 'smooth')) {\n\t\t\t\tNACSS.linkAnchorScroll(as, { observedSelector: 'main' });\n\t\t\t}\n\t\t\n\t\t\t// Japanese Text\n\t\t\n\t\t\tconst sgs = Array.from(target.getElementsByClassName('segmenter'));\n\t\t\tfor (const h of [1, 2, 3, 4, 5, 6]) {\n\t\t\t\tconst ts = target.querySelectorAll(`h${h}:not([class])`);\n\t\t\t\tfor (const t of ts) sgs.push(t);\n\t\t\t}\n\t\t\n\t\t\tNACSS.jaSegmenter(sgs, { properNouns: [] });\n\t\t\tNACSS.jaKerning([target], { doAssignAttribute: false, doDisableOnSelecting: false });\n\t\t\n\t\t\t// Align\n\t\t\n\t\t\tconst left  = Array.from(target.getElementsByClassName('alignleft'));\n\t\t\tconst right = Array.from(target.getElementsByClassName('alignright'));\n\t\t\tNACSS.alignFloat({ left, right }, {});\n\t\t\n\t\t\t// List\n\t\t\n\t\t\tconst uls = target.getElementsByTagName('ul');\n\t\t\tNACSS.listCustomized(uls);\n\t\t\n\t\t\t// Tab\n\t\t\n\t\t\tconst tsc = target.querySelectorAll('.tab-scroll, .pseudo-tab-page');\n\t\t\tconst tst = target.querySelectorAll('.tab-stack, .tab-page');\n\t\t\tNACSS.tabScroll(tsc);\n\t\t\tNACSS.tabStack(tst);\n\t\t\n\t\t\t// Table\n\t\t\n\t\t\tconst tabs = target.getElementsByTagName('table');\n\t\t\n\t\t\tNACSS.tableNeatWidth(tabs);\n\t\t\tNACSS.tableUsableView(tabs);\n\t\t\n\t\t\t// Viewer\n\t\t\n\t\t\tconst if_os  = Array.from(target.getElementsByClassName('iframe-opener'));\n\t\t\tconst os_ifs = Array.from(target.querySelectorAll('.iframe-opener + iframe'));\n\t\t\tconst fig_a  = Array.from(target.querySelectorAll('figure a'));\n\t\t\n\t\t\tNACSS.viewerIframe(if_os, os_ifs);\n\t\t\tNACSS.viewerImage(fig_a);\n\t\t\n\t\t\t// Scroll Effect\n\t\t\tconst ts = target.querySelectorAll('[data-nc-scroll-effect]');\n\t\t\tNACSS.scroll(ts);\n\t\t}\n\t\t\n\t\tNS.initializeQuerySelector    = initializeQuerySelector;\n\t\tNS.initializeQuerySelectorAll = initializeQuerySelectorAll;\n\t}\n\n\t// -------------------------------------------------------------------------\n\n\t/**\n\t *\n\t * Style Class Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-11-11\n\t *\n\t */\n\t\n\t\n\tfunction hasClass(tar, cls) {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn tar.dataset[key] !== undefined;\n\t\t} else {\n\t\t\treturn tar.classList.contains(key);\n\t\t}\n\t}\n\t\n\tfunction setClass(tar, cls, enabled = true, val = '') {\n\t\tconst key = cls.substr(1);\n\t\tif (cls.startsWith(':')) {\n\t\t\tif (enabled) {\n\t\t\t\ttar.dataset[key] = val;\n\t\t\t} else {\n\t\t\t\tdelete tar.dataset[key];\n\t\t\t}\n\t\t} else {\n\t\t\tconst c = [key, val].join('-');\n\t\t\tif (enabled) {\n\t\t\t\ttar.classList.add(c);\n\t\t\t} else {\n\t\t\t\ttar.classList.remove(c);\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction getSelector(cls) {\n\t\tif (cls.startsWith(':')) {\n\t\t\treturn `*[data-${cls.substr(1).replace(/([A-Z])/g, c => '-' + c.charAt(0).toLowerCase())}]`;\n\t\t} else {\n\t\t\treturn `*${cls}`;\n\t\t}\n\t}\n\t\n\t/**\n\t *\n\t * Utilities\n\t *\n\t * @author Takuto Yanagida\n\t * @version 2021-12-06\n\t *\n\t */\n\t\n\t\n\tfunction getScrollOffset() {\n\t\tconst s   = getComputedStyle(document.documentElement);\n\t\tconst val = parseInt(s.scrollPaddingTop);\n\t\treturn Number.isNaN(val) ? 0 : val;\n\t}\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction throttle(fn) {\n\t\tlet isRunning;\n\t\treturn (...args) => {\n\t\t\tif (isRunning) return;\n\t\t\tisRunning = true;\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tisRunning = false;\n\t\t\t\tfn(...args);\n\t\t\t});\n\t\t};\n\t}\n\t\n\tconst resizeListeners = [];\n\tconst scrollListeners = [];\n\t\n\tfunction onResize(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tresizeListeners.push(throttle(fn));\n\t}\n\t\n\tfunction onScroll(fn, doFirst = false) {\n\t\tif (doFirst) fn();\n\t\tscrollListeners.push(throttle(fn));\n\t}\n\t\n\tdocument.addEventListener('DOMContentLoaded', () => {\n\t\twindow.addEventListener('resize', () => {\n\t\t\tfor (const l of resizeListeners) l();\n\t\t}, { passive: true });\n\t\twindow.addEventListener('scroll', () => {\n\t\t\tfor (const l of scrollListeners) l();\n\t\t}, { passive: true });\n\t});\n\t\n\t\n\t// -----------------------------------------------------------------------------\n\t\n\t\n\tfunction onIntersect(fn, targets, threshold = 0, rootMargin = '* 0px 0px 0px') {\n\t\tconst vs = Array(targets.length).fill(false);\n\t\tconst tm = new Map();\n\t\ttargets.forEach((t, i) => tm.set(t, i));\n\t\n\t\tfunction init() {\n\t\t\tconst io = new IntersectionObserver((es) => {\n\t\t\t\tfor (const e of es) vs[tm.get(e.target)] = e.isIntersecting;\n\t\t\t\tfn(vs);\n\t\t\t}, { rootMargin: rootMargin.replace('*', `${mt}px`), threshold });\n\t\t\tfor (const t of targets) io.observe(t);\n\t\t\treturn io;\n\t\t}\n\t\tlet mt = 0;\n\t\tlet io = null;\n\t\tlet st = null;\n\t\tonResize(() => {\n\t\t\tmt = -getScrollOffset();\n\t\t\tif (st) clearTimeout(st);\n\t\t\tst = setTimeout(() => {\n\t\t\t\tif (io) io.disconnect();\n\t\t\t\tio = init();\n\t\t\t}, 100);\n\t\t}, true);\n\t}\n\t\n\n\t// Align -------------------------------------------------------------------\n\n\t{\n\t\t/**\n\t\t *\n\t\t * Float\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-11-17\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction initialize(tars = {}, opts = {}) {\n\t\t\ttars = Object.assign({ left: [], right: [] }, tars);\n\t\t\tif (tars['left'].length + tars['right'].length === 0 ) return;\n\t\t\n\t\t\topts = Object.assign({\n\t\t\t\tstyleAlign : ':ncAlign',\n\t\t\t\tclassLeft  : 'alignleft',\n\t\t\t\tclassRight : 'alignright',\n\t\t\t\tclassCenter: 'aligncenter',\n\t\t\t\tminWidth   : 240,  // px\n\t\t\t}, opts);\n\t\t\n\t\t\tsetTimeout(() => {\n\t\t\t\tassignEventListener(tars['left'], opts['classLeft'], opts);\n\t\t\t\tassignEventListener(tars['right'], opts['classRight'], opts);\n\t\t\t}, 0);  // Delay\n\t\t}\n\t\t\n\t\tfunction assignEventListener(as, cls, opts) {\n\t\t\tconst aws = as.map(e => [e, 0]);\n\t\t\tonScroll(() => storeWidth(aws, cls, opts), true);  // For lazy loading\n\t\t\tonResize(() => update(aws, cls, opts), true);\n\t\t}\n\t\t\n\t\t\n\t\t// -------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction storeWidth(aws, style, opts) {\n\t\t\tfor (const aw of aws) {\n\t\t\t\tconst [a, w] = aw;\n\t\t\t\tif (10 < w) continue;\n\t\t\t\tswitchFloatOne(a, false, style, opts);\n\t\t\t\taw[1] = a.getBoundingClientRect().width;\n\t\t\t\tswitchFloatOne(a, true, style, opts);\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction update(aws, cls, opts) {\n\t\t\tfor (const aw of aws) {\n\t\t\t\tconst [a, w] = aw;\n\t\t\t\tconst cw = contentWidth(a.parentElement);\n\t\t\t\tconst wn = a.getBoundingClientRect().width;\n\t\t\t\tif (wn < cw * 0.9 && w < wn) {\n\t\t\t\t\taw[1] = wn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (const [a, w] of aws) {\n\t\t\t\tconst cw = contentWidth(a.parentElement, true);\n\t\t\t\tswitchFloatOne(a, cw - w < opts.minWidth, cls, opts);\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction switchFloatOne(a, enabled, origCls, opts) {\n\t\t\tif (enabled && !hasClass(a, opts.styleAlign)) {\n\t\t\t\tsetClass(a, opts.styleAlign, true, origCls);\n\t\t\t\ta.classList.remove(origCls);\n\t\t\t\ta.classList.add(opts.classCenter);\n\t\t\t}\n\t\t\tif (!enabled && hasClass(a, opts.styleAlign)) {\n\t\t\t\ta.classList.remove(opts.classCenter);\n\t\t\t\ta.classList.add(origCls);\n\t\t\t\tsetClass(a, opts.styleAlign, false);\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction contentWidth(e, checkDisplay = false) {\n\t\t\tif (e === null) {\n\t\t\t\treturn window.innerWidth;\n\t\t\t}\n\t\t\tconst s = getComputedStyle(e);\n\t\t\tif (checkDisplay && s.display === 'inline') {\n\t\t\t\treturn contentWidth(e.parentElement);\n\t\t\t}\n\t\t\tconst ph = parseFloat(s.paddingLeft) + parseFloat(s.paddingRight);\n\t\t\treturn e.clientWidth - ph;\n\t\t}\n\t\t\n\t\tNS.alignFloat = initialize;\n\t}\n\n\t// Content -----------------------------------------------------------------\n\n\t{\n\t\t/**\n\t\t *\n\t\t * Image Alt\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-11-19\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction initialize(ts) {\n\t\t\tfor (const t of ts) {\n\t\t\t\tif (!t.alt && t.src) {\n\t\t\t\t\tlet src = t.src.trim();\n\t\t\t\t\tif (src.endsWith('/')) src = src.substring(0, src.length - 1);\n\t\t\t\t\tconst idx = src.lastIndexOf('/');\n\t\t\t\t\tif (idx === -1) continue;\n\t\t\t\t\tt.alt = src.substring(idx + 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tNS.contentImageAlt = initialize;\n\t}\n\n\t{\n\t\t/**\n\t\t *\n\t\t * Figure Caption\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-11-19\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\t// Wrap figure captions with spans for Firefox\n\t\tfunction initialize(figs) {\n\t\t\tconst ua = window.navigator.userAgent.toLowerCase();\n\t\t\tif (ua.includes('firefox')) {\n\t\t\t\tfor (const fig of figs) {\n\t\t\t\t\tfig.style.width = '';\n\t\t\n\t\t\t\t\tconst fcs = fig.getElementsByTagName('figcaption');\n\t\t\t\t\tconst fc  = fcs.length ? fcs[0] : null;\n\t\t\t\t\tif (fc) {\n\t\t\t\t\t\tfc.innerHTML = `<span>${fc.innerHTML}</span>`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tNS.contentFigureCaption = initialize;\n\t}\n\n\t{\n\t\t/**\n\t\t *\n\t\t * Iframe Aspect\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-11-19\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction initialize(fs) {\n\t\t\tfor (const f of fs) {\n\t\t\t\tif (!f.style.aspectRatio) {\n\t\t\t\t\tconst [w, h] = extractIframeSize(f);\n\t\t\t\t\tif (w && h) {\n\t\t\t\t\t\tf.style.aspectRatio = `${w} / ${h}`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction extractIframeSize(f) {\n\t\t\tlet w = parseInt(f.width);\n\t\t\tlet h = parseInt(f.height);\n\t\t\tif (w && h) return [w, h];\n\t\t\n\t\t\tconst sW = f.style.width;\n\t\t\tconst sH = f.style.height;\n\t\t\tif (sW.indexOf('px') !== sW.length - 2) return [0, 0];\n\t\t\tif (sH.indexOf('px') !== sH.length - 2) return [0, 0];\n\t\t\tw = parseInt(sW);\n\t\t\th = parseInt(sH);\n\t\t\tif (w && h) return [w, h];\n\t\t\treturn [0, 0];\n\t\t}\n\t\t\n\t\tNS.contentIframeAspect = initialize;\n\t}\n\n\t{\n\t\t/**\n\t\t *\n\t\t * Underline\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-11-19\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction initialize(spans, opts = {}) {\n\t\t\topts = Object.assign({\n\t\t\t\tstyleList: ':ncUnderline',\n\t\t\t}, opts);\n\t\t\n\t\t\tfor (const span of spans) {\n\t\t\t\tsetStyle(span, opts);\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction setStyle(t, opts) {\n\t\t\tconst type = t.style.textDecorationLine;\n\t\t\tif (type === 'underline') {\n\t\t\t\tconst re = new RegExp('text-decoration\\\\s*:\\\\s*' + type + '\\\\s*;?', 'gi');\n\t\t\t\tif (t.getAttribute('style').match(re)) {\n\t\t\t\t\tt.removeAttribute('style');\n\t\t\t\t} else {\n\t\t\t\t\tt.style.textDecorationLine = '';\n\t\t\t\t}\n\t\t\t\tsetClass(t, opts.styleList);\n\t\t\t}\n\t\t}\n\t\t\n\t\tNS.contentUnderline = initialize;\n\t}\n\n\t// Delay Loading -----------------------------------------------------------\n\n\t{\n\t\t/**\n\t\t *\n\t\t * Common Functions\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-11-11\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction saveAttribute(t, at, alt = null) {\n\t\t\tconst v = t.getAttribute(at);\n\t\t\tif (v) {\n\t\t\t\tt.dataset[at] = v;\n\t\t\t\tif (alt) {\n\t\t\t\t\tt.setAttribute(at, alt);\n\t\t\t\t} else {\n\t\t\t\t\tt.removeAttribute(at);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction restoreAttribute(t, at) {\n\t\t\tconst v = t.dataset[at];\n\t\t\tif (v) {\n\t\t\t\tt.setAttribute(at, v);\n\t\t\t\tdelete t.dataset[at];\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction isPolyfillNeeded(proto) {\n\t\t\treturn (!('loading' in proto));\n\t\t}\n\t\t\n\n\t\t{\n\t\t\t/**\n\t\t\t *\n\t\t\t * Image\n\t\t\t *\n\t\t\t * @author Takuto Yanagida\n\t\t\t * @version 2021-11-11\n\t\t\t *\n\t\t\t */\n\t\t\t\n\t\t\t\n\t\t\tconst BLANK_IMG = 'data:image/gif;base64,R0lGODdhAQABAPAAAP///wAAACwAAAAAAQABAEACAkQBADs=';\n\t\t\t\n\t\t\t\n\t\t\tfunction initialize(ts, opts = {}) {\n\t\t\t\tif (ts.length === 0) return;\n\t\t\t\n\t\t\t\topts = Object.assign({\n\t\t\t\t\toffset    : 100,\n\t\t\t\t\tblankImage: BLANK_IMG,\n\t\t\t\t}, opts);\n\t\t\t\n\t\t\t\tif (isPolyfillNeeded(HTMLImageElement.prototype)) {  // For Safari\n\t\t\t\t\tfor (const t of ts) {\n\t\t\t\t\t\thide(t, opts['blankImage']);\n\t\t\t\t\t}\n\t\t\t\t\tonIntersect(vs => {\n\t\t\t\t\t\tfor (let i = 0; i < ts.length; i += 1) {\n\t\t\t\t\t\t\tconst t = ts[i];\n\t\t\t\t\t\t\tif (t.dataset.src && vs[i]) {\n\t\t\t\t\t\t\t\tshow(t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}, ts, 0, `* 0px ${opts['offset']}px 0px`);\n\t\t\t\t}\n\t\t\t\n\t\t\t\twindow.addEventListener('beforeprint', () => {\n\t\t\t\t\tfor (const t of ts) {\n\t\t\t\t\t\tif (t.dataset.src) {\n\t\t\t\t\t\t\tshow(t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (t.getAttribute('loading') === 'lazy') {\n\t\t\t\t\t\t\tt.setAttribute('loading', 'eager');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, false);\n\t\t\t}\n\t\t\t\n\t\t\tfunction hide(t, blankImage) {\n\t\t\t\tsaveAttribute(t, 'src', blankImage);\n\t\t\t\tsaveAttribute(t, 'srcset');\n\t\t\t\tt.style.opacity = 0;\n\t\t\t\tconst h = t.getAttribute('height');\n\t\t\t\tif (h) {\n\t\t\t\t\tt.style.minHeight = h + 'px';\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction show(t) {\n\t\t\t\tt.addEventListener('load', () => {\n\t\t\t\t\tt.style.minHeight = '';\n\t\t\t\t\tt.style.opacity   = '';\n\t\t\t\t});\n\t\t\t\trestoreAttribute(t, 'src');\n\t\t\t\trestoreAttribute(t, 'srcset');\n\t\t\t}\n\t\t\t\n\t\t\tNS.delayImage         = initialize;\n\t\t\tNS.delayImageIsNeeded = isPolyfillNeeded;\n\t\t}\n\n\t\t{\n\t\t\t/**\n\t\t\t *\n\t\t\t * Iframe\n\t\t\t *\n\t\t\t * @author Takuto Yanagida\n\t\t\t * @version 2021-11-19\n\t\t\t *\n\t\t\t */\n\t\t\t\n\t\t\t\n\t\t\tfunction initialize(ts, opts = {}) {\n\t\t\t\tif (ts.length === 0) return;\n\t\t\t\n\t\t\t\topts = Object.assign({\n\t\t\t\t\toffset: 100,\n\t\t\t\t}, opts);\n\t\t\t\n\t\t\t\tif (isPolyfillNeeded(HTMLIFrameElement.prototype)) {  // For Safari\n\t\t\t\t\tfor (const t of ts) {\n\t\t\t\t\t\thide(t);\n\t\t\t\t\t}\n\t\t\t\t\tonIntersect(vs => {\n\t\t\t\t\t\tfor (let i = 0; i < ts.length; i += 1) {\n\t\t\t\t\t\t\tconst t = ts[i];\n\t\t\t\t\t\t\tif (t.dataset.src && vs[i]) {\n\t\t\t\t\t\t\t\tshow(t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}, ts, 0, `* 0px ${opts['offset']}px 0px`);\n\t\t\t\t}\n\t\t\t\n\t\t\t\twindow.addEventListener('beforeprint', () => {\n\t\t\t\t\tfor (const t of ts) {\n\t\t\t\t\t\tif (t.dataset.src) {\n\t\t\t\t\t\t\tshow(t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (t.getAttribute('loading') === 'lazy') {\n\t\t\t\t\t\t\tt.setAttribute('loading', 'eager');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, false);\n\t\t\t}\n\t\t\t\n\t\t\tfunction hide(t) {\n\t\t\t\tsaveAttribute(t, 'src');\n\t\t\t}\n\t\t\t\n\t\t\tfunction show(t) {\n\t\t\t\tconst v = t.dataset['src'];\n\t\t\t\tif (v) {\n\t\t\t\t\tt.contentDocument.location.replace(v);\n\t\t\t\t\tdelete t.dataset['src'];\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tNS.delayIframe         = initialize;\n\t\t\tNS.delayIframeIsNeeded = isPolyfillNeeded;\n\t\t}\n\t}\n\n\t// Japanese Text -----------------------------------------------------------\n\n\t{\n\t\t/**\n\t\t *\n\t\t * Common Functions\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-11-03\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction removeHeadWhiteSpaces(str) {\n\t\t\tconst mzs = str.match(/^[\\n\\r\\t ]*(\\u3000*)/);\n\t\t\tconst zs = (mzs && 1 < mzs.length) ? mzs[1] : '';\n\t\t\treturn zs + str.replace(/^\\s+/g, '');  // Trim left\n\t\t}\n\t\t\n\t\tfunction removeTailWhiteSpaces(str) {\n\t\t\treturn str.replace(/\\s+$/g, '');  // Trim right\n\t\t}\n\t\t\n\t\tfunction removeWhiteSpacesBetweenZenChars(str) {\n\t\t\t// White space character class excluding \\u3000\n\t\t\t// [ \\f\\n\\r\\t\\v​\\u00a0​\\u180e\\u2000​-\\u200a​\\u2028\\u2029\\u202f\\u205f​\\ufeff]\n\t\t\treturn str.replace(/([^\\x01-\\x7E\\xA1-\\xDF]+)([\\t\\n]+|[ \\f\\n\\r\\t\\v\\u00a0\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\ufeff]{2})([^\\x01-\\x7E\\xA1-\\xDF]+)/g, (match, g1, d, g2) => g1 + g2);\n\t\t}\n\t\t\n\n\t\t{\n\t\t\t/**\n\t\t\t *\n\t\t\t * Kerning\n\t\t\t *\n\t\t\t * @author Takuto Yanagida\n\t\t\t * @version 2021-12-06\n\t\t\t *\n\t\t\t */\n\t\t\t\n\t\t\t\n\t\t\tfunction initialize(ts, opts = {}) {\n\t\t\t\tif (ts.length === 0) return;\n\t\t\t\n\t\t\t\topts = Object.assign({\n\t\t\t\t\tstyleKerning        : ':ncKern',\n\t\t\t\t\tstyleDisabled       : ':ncNoKerning',\n\t\t\t\t\tdoAssignAttribute   : true,\n\t\t\t\t\tdoDisableOnSelecting: true,\n\t\t\t\t}, opts);\n\t\t\t\n\t\t\t\tfor (const t of ts) {\n\t\t\t\t\tkernElement(t, dict, opts);\n\t\t\t\t\tif (opts['doAssignAttribute'] && opts['doDisableOnSelecting']) {\n\t\t\t\t\t\tconst f = () => {\n\t\t\t\t\t\t\tremoveKerning(t, opts);\n\t\t\t\t\t\t\tt.removeEventListener('selectstart', f);\n\t\t\t\t\t\t};\n\t\t\t\t\t\tt.addEventListener('selectstart', f);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction removeKerning(elm, opts) {\n\t\t\t\tfor (const s of Array.from(elm.getElementsByTagName('span'))) {\n\t\t\t\t\tif (hasClass(s, opts.styleKerning)) {\n\t\t\t\t\t\tconst df = document.createDocumentFragment();\n\t\t\t\t\t\tfor (const c of Array.from(s.childNodes)) {\n\t\t\t\t\t\t\tdf.appendChild(c);\n\t\t\t\t\t\t}\n\t\t\t\t\t\ts.parentNode.replaceChild(df, s);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction apply(str, opts = {}) {\n\t\t\t\topts = Object.assign({\n\t\t\t\t\tstyleKerning     : ':ncKern',\n\t\t\t\t\tstyleDisabled    : ':ncNoKerning',\n\t\t\t\t\tdoAssignAttribute: true,\n\t\t\t\t}, opts);\n\t\t\t\n\t\t\t\tconst ks = getKerning(str, dict, false, opts.doAssignAttribute);\n\t\t\t\tif (ks.length) {\n\t\t\t\t\treturn createFragment(str, ks, opts);\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -----------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction kernElement(elm, dict, opts) {\n\t\t\t\tfor (const c of Array.from(elm.childNodes)) {\n\t\t\t\t\tif (c.nodeType === 1) {  // ELEMENT_NODE\n\t\t\t\t\t\tif (!hasClass(c, opts.styleDisabled)) kernElement(c, dict, opts);\n\t\t\t\t\t} else if (c.nodeType === 3) {  // TEXT_NODE\n\t\t\t\t\t\tkernTextNode(c, dict, opts);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction kernTextNode(tn, dict, opts) {\n\t\t\t\tconst [isHead, isTail] = isEnd(tn);\n\t\t\t\n\t\t\t\tlet str = tn.textContent;\n\t\t\t\tif (isHead) str = removeHeadWhiteSpaces(str);\n\t\t\t\tif (isTail) str = removeTailWhiteSpaces(str);\n\t\t\t\tstr = removeWhiteSpacesBetweenZenChars(str);\n\t\t\t\n\t\t\t\tlet nt = '';\n\t\t\t\tif (tn.nextSibling && tn.nextSibling.nodeType === 1 && getComputedStyle(tn.nextSibling).display === 'inline') {\n\t\t\t\t\tnt = tn.nextSibling.innerText;\n\t\t\t\t}\n\t\t\t\tif (!tn.nextSibling && tn.parentNode.nextSibling) {\n\t\t\t\t\tconst parentNext = tn.parentNode.nextSibling;\n\t\t\t\t\tif (parentNext.nodeType === 1) {  // ELEMENT_NODE\n\t\t\t\t\t\tconst pnd = getComputedStyle(parentNext).display;\n\t\t\t\t\t\tif (pnd.includes('inline')) {\n\t\t\t\t\t\t\tnt = parentNext.innerText;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (parentNext.nodeType === 3) {  // TEXT_NODE\n\t\t\t\t\t\tnt = parentNext.textContent;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\n\t\t\t\tconst ks = getKerning(str, dict, isHead, nt, opts.doAssignAttribute);\n\t\t\t\tif (ks.length) {\n\t\t\t\t\tconst f = createFragment(str, ks, opts);\n\t\t\t\t\ttn.parentNode.replaceChild(f, tn);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction isEnd(tn) {\n\t\t\t\tconst p = tn.parentNode;\n\t\t\t\tif (!(p instanceof HTMLElement)) return [false, false];\n\t\t\t\tconst pd = getComputedStyle(p).display;\n\t\t\t\tif (!pd.includes('inline')) {  // Block\n\t\t\t\t\treturn isSiblingBlock(tn);\n\t\t\t\t}\n\t\t\t\tif (pd === 'inline-block') {  // Inline block\n\t\t\t\t\tif (p.childNodes.length !== 1) {  // The parent has multiple nodes.\n\t\t\t\t\t\treturn isSiblingBlock(tn);\n\t\t\t\t\t}\n\t\t\t\t\tconst pp = p.parentNode;\n\t\t\t\t\tif (pp) {\n\t\t\t\t\t\tconst ppd = getComputedStyle(pp).display;\n\t\t\t\t\t\tif (!ppd.includes('inline')) {\n\t\t\t\t\t\t\treturn isSiblingBlock(p, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn [false, false];  // Not inline block\n\t\t\t}\n\t\t\t\n\t\t\tfunction isSiblingBlock(n, greedy = false) {\n\t\t\t\treturn [greedy ? isPreviousBlockGreedy(n.previousSibling) : isBlock(n.previousSibling), isBlock(n.nextSibling)];\n\t\t\t}\n\t\t\t\n\t\t\tfunction isBlock(n) {\n\t\t\t\tif (n === null) return true;\n\t\t\t\tif (!(n instanceof HTMLElement)) return false;\n\t\t\t\tif (n.tagName === 'BR') return true;\n\t\t\t\treturn !getComputedStyle(n).display.includes('inline');\n\t\t\t}\n\t\t\t\n\t\t\tfunction isPreviousBlockGreedy(n) {\n\t\t\t\twhile (true) {\n\t\t\t\t\tif (n === null) return true;\n\t\t\t\t\tif (n.nodeType === 1) {\n\t\t\t\t\t\tif (n.tagName === 'BR') return true;\n\t\t\t\t\t\treturn !getComputedStyle(n).display.includes('inline');\n\t\t\t\t\t}\n\t\t\t\t\tif (n.nodeType === 3) {\n\t\t\t\t\t\tif (!n.textContent.trim()) return true;\n\t\t\t\t\t}\n\t\t\t\t\tn = n.previousSibling;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -----------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction getKerning(str, dict, isHead, nextNodeText, assignAttr) {\n\t\t\t\tlet strArray = Array.from(str);\n\t\t\t\tconst ret = [];\n\t\t\t\n\t\t\t\tif (nextNodeText.length) {\n\t\t\t\t\tstrArray = strArray.concat(Array.from(nextNodeText));\n\t\t\t\t}\n\t\t\t\tlet l = 0;\n\t\t\t\n\t\t\t\tfor (let i = 0; i < strArray.length; i += 1) {\n\t\t\t\t\tconst c0 = strArray[i];\n\t\t\t\t\tconst c1 = strArray[i + 1];\n\t\t\t\n\t\t\t\t\tlet a = '';\n\t\t\t\t\tif (c0 !== '' && c1 !== '' && dict.has(c0 + c1)) {\n\t\t\t\t\t\ta = assignAttr ? 's' : 'letter-spacing:-0.4em;';\n\t\t\t\t\t}\n\t\t\t\t\tif (i === 0 && isHead && c0 !== '' && dict.has(c0)) {\n\t\t\t\t\t\ta += assignAttr ? 'h' : 'margin-left:-0.4em';\n\t\t\t\t\t}\n\t\t\t\t\tif (a.length) {\n\t\t\t\t\t\tif (l) {\n\t\t\t\t\t\t\tret.push(l);\n\t\t\t\t\t\t\tl = 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tret.push(a);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tl += 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (ret.length && l) ret.push(l);\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t\t\n\t\t\tfunction createFragment(str, ks, opts) {\n\t\t\t\tconst strArray = Array.from(str);\n\t\t\t\tconst f = document.createDocumentFragment();\n\t\t\t\tlet i = 0;\n\t\t\t\tfor (const k of ks) {\n\t\t\t\t\tif (Number.isInteger(k)) {\n\t\t\t\t\t\tconst n = document.createTextNode(strArray.slice(i, i + k).join(''));\n\t\t\t\t\t\tf.appendChild(n);\n\t\t\t\t\t\ti += k;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst n = document.createElement('span');\n\t\t\t\t\t\tn.appendChild(document.createTextNode(strArray.slice(i, i + 1).join('')));\n\t\t\t\t\t\tif (k.length <= 2) {\n\t\t\t\t\t\t\tsetClass(n, opts.styleKerning, true, k);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tn.style = k;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tf.appendChild(n);\n\t\t\t\t\t\ti += 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn f;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -----------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tconst dict = new Set();\n\t\t\t{\n\t\t\t\taddPairs(dict, '、，。．・｜：　', '「『（［｛〈《【〔');\n\t\t\t\taddPairs(dict, '」』）］｝〉》】〕', '、，。．・｜：,.');\n\t\t\t\taddPairs(dict, '」』）］｝〉》】〕', '「『（［｛〈《【〔');\n\t\t\t\taddPairs(dict, '「『（［｛〈《【〔', '「『（［｛〈《【〔');\n\t\t\t\taddPairs(dict, '」』）］｝〉》】〕', '」』）］｝〉》】〕');\n\t\t\t\taddSolos(dict, '「『（［｛〈《【〔');\n\t\t\t\n\t\t\t\tfunction addPairs(dict, cs0, cs1) {\n\t\t\t\t\tfor (const c0 of cs0) {\n\t\t\t\t\t\tfor (const c1 of cs1) {\n\t\t\t\t\t\t\tdict.add(c0 + c1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\n\t\t\t\tfunction addSolos(dict, head) {\n\t\t\t\t\tfor (const h of head) {\n\t\t\t\t\t\tdict.add(h);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tNS.jaKerning      = initialize;\n\t\t\tNS.jaApplyKerning = apply;\n\t\t}\n\n\t\t{\n\t\t\t/**\n\t\t\t *\n\t\t\t * Segmenter\n\t\t\t *\n\t\t\t * @author Takuto Yanagida\n\t\t\t * @version 2021-12-06\n\t\t\t *\n\t\t\t */\n\t\t\t\n\t\t\t\n\t\t\tfunction initialize(ts, opts = {}) {\n\t\t\t\tif (ts.length === 0) return;\n\t\t\t\n\t\t\t\topts = Object.assign({\n\t\t\t\t\tstyleSegment        : '',\n\t\t\t\t\tstyleDisabled       : ':ncNoSegmentation',\n\t\t\t\t\tdoDisableOnSelecting: true,\n\t\t\t\t\tproperNouns         : [],\n\t\t\t\t}, opts);\n\t\t\t\tsortProperNouns(opts);\n\t\t\t\n\t\t\t\tfor (const t of ts) {\n\t\t\t\t\tsegmentElement(t, opts);\n\t\t\t\t\tif (opts['doDisableOnSelecting']) {\n\t\t\t\t\t\tconst f = () => {\n\t\t\t\t\t\t\tremoveSegment(t, opts);\n\t\t\t\t\t\t\tt.removeEventListener('selectstart', f);\n\t\t\t\t\t\t};\n\t\t\t\t\t\tt.addEventListener('selectstart', f);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction removeSegment(elm, opts) {\n\t\t\t\tconst sty = opts.styleSegment;\n\t\t\t\tfor (const s of Array.from(elm.getElementsByTagName('span'))) {\n\t\t\t\t\tif ((sty.length === 0 && s.className === '') || hasClass(s, sty)) {\n\t\t\t\t\t\tconst df = document.createDocumentFragment();\n\t\t\t\t\t\tfor (const c of Array.from(s.childNodes)) {\n\t\t\t\t\t\t\tdf.appendChild(c);\n\t\t\t\t\t\t}\n\t\t\t\t\t\ts.parentNode.replaceChild(df, s);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction apply(str, opts = {}) {\n\t\t\t\topts = Object.assign({\n\t\t\t\t\tstyleSegment : '',\n\t\t\t\t\tstyleDisabled: ':ncNoSegmentation',\n\t\t\t\t\tproperNouns  : [],\n\t\t\t\t}, opts);\n\t\t\t\tsortProperNouns(opts);\n\t\t\t\n\t\t\t\tconst [ts, ws] = getSegment(str, opts.properNouns);\n\t\t\t\treturn createFragment(str, ts, ws, opts);\n\t\t\t}\n\t\t\t\n\t\t\tfunction sortProperNouns(opts) {\n\t\t\t\tconst pns = opts['properNouns'].map(e => Array.from(e));\n\t\t\t\tpns.sort((a, b) => {\n\t\t\t\t\treturn b.length - a.length;\n\t\t\t\t});\n\t\t\t\topts['properNouns'] = pns;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction segmentElement(elm, opts) {\n\t\t\t\tfor (const c of Array.from(elm.childNodes)) {\n\t\t\t\t\tif (c.nodeType === 1) {  // ELEMENT_NODE\n\t\t\t\t\t\tif (!hasClass(c, opts.styleDisabled)) segmentElement(c, opts);\n\t\t\t\t\t} else if (c.nodeType === 3) {  // TEXT_NODE\n\t\t\t\t\t\tsegmentTextNode(c, opts);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction segmentTextNode(tn, opts) {\n\t\t\t\tlet str = tn.textContent;\n\t\t\t\tstr = removeWhiteSpacesBetweenZenChars(str);\n\t\t\t\n\t\t\t\tconst [ts, ws] = getSegment(str, opts.properNouns);\n\t\t\t\tconst f = createFragment(str, ts, ws, opts);\n\t\t\t\ttn.parentNode.replaceChild(f, tn);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -----------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tconst IW = 'そうはいうものの,そればかりでなく,ありとあらゆる,いずれにしても,かけがえのない,そうしてみると,そうすることで,そうでないなら,そうではあるが,それにくわえて,それはさておき,どっちにしても,とはいうものの,なぜかというと,にもかかわらず,いいかえると,いずれにしろ,いずれにせよ,いってみれば,おもいきった,しかしながら,じつのところ,じつはいうと,そうしないと,そうではなく,そのためには,それどころか,それにしても,それによって,そればかりか,それはそうと,どちらにせよ,どっちにせよ,いろいろな,このように,さまざまな,さもないと,したがって,そういえば,そうしたら,そうすると,そうすれば,そうなると,そうなれば,そのかわり,それなのに,それゆえに,たくまざる,だとしたら,だとすると,だとすれば,ではあるが,というのは,というのも,というより,なぜならば,やすやすと,ようするに,ああいう,ああした,あたかも,あらゆる,あるいは,いかなる,いつかは,いっぱい,いろんな,いわゆる,おおきな,おかしな,おそらく,おなじく,おまけに,かえって,かくして,かわりに,くわえて,ぐんぐん,けれども,こういう,こうして,このため,しかるに,しばらく,すなわち,そういう,そうした,そのうえ,そのくせ,そのため,そもそも,それから,それから,それでは,それでも,それとも,それなら,それには,たいした,たいそう,たくさん,だけども,たとえば,たやすく,ちいさな,ちなみに,というか,どういう,とうてい,ときどき,ところが,どころか,ところで,となると,となれば,とにかく,とはいえ,ともあれ,とりわけ,ないしは,なかでも,なぜなら,なぜなら,なだたる,なにしろ,ならびに,はじめに,はずべき,はなはだ,ひいては,ひょんな,ふとした,ほかには,ほかにも,めっきり,もしくは,もっとも,あまり,あらぬ,ありし,あんな,いただ,いつか,いつも,いわば,および,かかる,かなり,きたる,きっと,けれど,ことに,こんな,さらに,しかし,しかも,じつは,じゃあ,すぐに,すぐに,すると,そこで,そして,そっと,それで,それに,そんな,だから,だけど,ただし,だって,たまに,つぎに,つまり,ですが,とある,どうか,ときに,とくに,とても,とんだ,どんな,なにせ,なのに,ならば,ほんの,まさか,または,むこう,むしろ,もっと,もっと,もっと,ものの,やはり,ゆえに,ようは,よって,ああ,あの,ある,かつ,かの,けど,こう,この,さて,さる,そう,その,だが,ただ,では,でも,どう,どの,なお,なぜ,のに,また,もし,よく,わが'.split(',');\n\t\t\tconst AW = 'けれども,ところで,において,について,かしら,がてら,くらい,ぐらい,けれど,ってば,ながら,などの,なんぞ,ばかり,ものか,ものの,かい,から,かり,きり,こそ,さえ,しか,ずつ,だけ,だの,たり,つつ,では,ても,でも,とも,なぞ,など,なり,にて,には,ので,のに,のみ,ほど,まで,まま,もん,やら,より,か,が,さ,し,ぜ,ぞ,て,で,と,な,に,ね,の,は,ば,へ,も,や,よ,わ,を'.split(',');\n\t\t\t\n\t\t\tconst AI1       = 'がおこな,のような,があり,がおき,ができ,がでて'.split(',');\n\t\t\tconst PRE_KANJI = 'お,ご'.split(',');\n\t\t\tconst PRE_NUM   = '第,約'.split(',');\n\t\t\t\n\t\t\tfunction getSegment(str, properNouns) {\n\t\t\t\tconst ts = createCharTypeArray(str);\n\t\t\t\tconst ws = Array(ts.length).fill(0);\n\t\t\t\n\t\t\t\tweightByCharTypes(ts, ws);\n\t\t\t\n\t\t\t\tconst strA = Array.from(str);\n\t\t\t\tif (properNouns.length) weightByPhrases(strA, ws, properNouns, -1);  // Divide\n\t\t\t\tweightByPhrases(strA, ws, IW, -1);  // Divide\n\t\t\t\tweightByPhrases(strA, ws, AW, 1);  // Concat\n\t\t\t\n\t\t\t\tweightByPhrases(strA, ws, AI1, -1, 1);  // Divide with offset\n\t\t\t\tweightByPhraseAndType(strA, ts, ws, PRE_KANJI, CLS_ALL,      'H', -1, 2);\n\t\t\t\tweightByPhraseAndType(strA, ts, ws, PRE_NUM,   CLS_WO_KANJI, 'N',  0, 2);\n\t\t\t\n\t\t\t\treturn [ts, ws];\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -----------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tconst CLS_WO_KANJI = 'SETIKNVO';\n\t\t\tconst CLS_ALL      = 'SETIKHNVO';\n\t\t\tconst CLS_ORIG     = 'NVO';\n\t\t\t\n\t\t\tconst CHAR_PATTERNS = [\n\t\t\t\t['S', /[「『（［｛〈《【〔〖〘〚＜“]/u],\n\t\t\t\t['E', /[」』）］｝〉》】〕〗〙〛＞”]/u],\n\t\t\t\t['T', /[、，。．？！を：・]/u],\n\t\t\t\t['I', /[ぁ-んゝ]/u],\n\t\t\t\t['K', /[ァ-ヴーｱ-ﾝﾞｰ]/u],\n\t\t\t\t['H', /[々〆ヵヶ]|[\\u4E00-\\u9FFF]|[\\u{20000}-\\u{2A6DF}]/u],  // Special Characters, CJK Unified Ideographs, CJK Unified Ideographs Extension B\n\t\t\t\t['N', /[0-9０-９]/u],\n\t\t\t\t['V', /\\s/u],\n\t\t\t];\n\t\t\t\n\t\t\tfunction createCharTypeArray(str) {\n\t\t\t\tconst ts = [];\n\t\t\t\tfor (const c of str) {\n\t\t\t\t\tts.push(getCharType(c));\n\t\t\t\t}\n\t\t\t\treturn ts;\n\t\t\t}\n\t\t\t\n\t\t\tfunction getCharType(c) {\n\t\t\t\tfor (const [t, p] of CHAR_PATTERNS) {\n\t\t\t\t\tif (p.test(c)) return t;\n\t\t\t\t}\n\t\t\t\treturn 'O';\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -----------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tconst PAIRS = {\n\t\t\t\t'*S': -1, 'S*': 2,\n\t\t\t\t'*E': 2,\n\t\t\t\t'*T': 99, 'T*': -99,\n\t\t\t\t'*V': -1, 'V*': -1,\n\t\t\t\t'II': 1, 'KK': 1, 'HH': 1,  'NN': 1, 'OO': 1, 'TT': 1,\n\t\t\t\t'HI': 1,\n\t\t\t\t'NH': 2, 'NK': 1, 'NI': 1,\n\t\t\t\t'ON': 1, 'NO': 1,\n\t\t\t};\n\t\t\t\n\t\t\tfunction weightByCharTypes(ts, ws) {\n\t\t\t\tfor (let i = 1; i < ts.length; i += 1) {\n\t\t\t\t\tconst t0 = ts[i - 1];\n\t\t\t\t\tconst t1 = ts[i];\n\t\t\t\t\tws[i] += (PAIRS[t0 + t1] ?? 0) + (PAIRS['*' + t1] ?? 0) + (PAIRS[t0 + '*'] ?? 0);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -----------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction divideByPhrases(strA, ws, phrases) {\n\t\t\t\tfor (const ph of phrases) {\n\t\t\t\t\tconst phA = Array.from(ph);\n\t\t\t\t\tconst phL = phA.length;\n\t\t\t\n\t\t\t\t\tfor (let bgn = 0;;) {\n\t\t\t\t\t\tconst idx0 = indexOfArray(strA, phA, bgn);\n\t\t\t\t\t\tif (idx0 === -1) break;\n\t\t\t\t\t\tconst idx1 = idx0 + phL;\n\t\t\t\n\t\t\t\t\t\tws[idx0] -= phL;\n\t\t\t\t\t\tfor (let i = 1; i < phL; i += 1) ws[idx0 + i] += phL;\n\t\t\t\t\t\tbgn = idx1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction divideByCombinedPhrases(strA, ws, phrases, al) {\n\t\t\t\tfor (const ph of phrases) {\n\t\t\t\t\tconst phA = Array.from(ph);\n\t\t\t\t\tconst phL = phA.length;\n\t\t\t\n\t\t\t\t\tfor (let bgn = 0;;) {\n\t\t\t\t\t\tconst idx0 = indexOfArray(strA, phA, bgn);\n\t\t\t\t\t\tif (idx0 === -1) break;\n\t\t\t\t\t\tconst idx1 = idx0 + phL;\n\t\t\t\n\t\t\t\t\t\tws[idx0 + al] -= phL - al;\n\t\t\t\t\t\tfor (let i = 1; i < phL - al; i += 1) ws[idx0 + al + i] += phL - al;\n\t\t\t\t\t\tbgn = idx1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction concatByPhrases(strA, ws, phrases) {\n\t\t\t\tfor (const ph of phrases) {\n\t\t\t\t\tconst phA = Array.from(ph);\n\t\t\t\t\tconst phL = phA.length;\n\t\t\t\n\t\t\t\t\tfor (let bgn = 0; ;) {\n\t\t\t\t\t\tconst idx0 = indexOfArray(strA, phA, bgn);\n\t\t\t\t\t\tif (idx0 === -1) break;\n\t\t\t\t\t\tconst idx1 = idx0 + phL;\n\t\t\t\n\t\t\t\t\t\tws[idx0] += phL;\n\t\t\t\t\t\tfor (let i = 1; i < phL; i += 1) ws[idx0 + i] += phL;\n\t\t\t\t\t\tbgn = idx1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction weightByPhrases(strA, ws, phrases, factor, offset = 0) {\n\t\t\t\tfor (const ph of phrases) {\n\t\t\t\t\tconst phA = Array.from(ph);\n\t\t\t\t\tconst phL = phA.length;\n\t\t\t\n\t\t\t\t\tfor (let bgn = 0;;) {\n\t\t\t\t\t\tconst idx0 = indexOfArray(strA, phA, bgn);\n\t\t\t\t\t\tif (idx0 === -1) break;\n\t\t\t\t\t\tconst idx1 = idx0 + phL;\n\t\t\t\n\t\t\t\t\t\tws[idx0 + offset] += (phL - offset) * factor;\n\t\t\t\t\t\tfor (let i = 1; i < phL - offset; i += 1) {\n\t\t\t\t\t\t\tws[idx0 + offset + i] += (phL - offset);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbgn = idx1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction weightByPhraseAndType(strA, ts, ws, phrases, prevCts, nextCts, prevW, nextW) {\n\t\t\t\tconst tsL = ts.length;\n\t\t\t\n\t\t\t\tfor (const ph of phrases) {\n\t\t\t\t\tconst phA = Array.from(ph);\n\t\t\t\t\tconst phL = phA.length;\n\t\t\t\n\t\t\t\t\tfor (let bgn = 0; ;) {\n\t\t\t\t\t\tconst idx0 = indexOfArray(strA, phA, bgn);\n\t\t\t\t\t\tif (idx0 === -1) break;\n\t\t\t\t\t\tconst idx1 = idx0 + phL;\n\t\t\t\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t(idx0 === 0   || (idx0 !== 0 && prevCts.includes(ts[idx0 - 1]))) &&\n\t\t\t\t\t\t\t(idx1 === tsL || (idx1 < tsL && nextCts.includes(ts[idx1])))\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tws[idx0] += prevW;\n\t\t\t\t\t\t\tif (idx1 < ws.length) ws[idx1] += nextW;\n\t\t\t\t\t\t\tfor (let i = 1; i < phL; i += 1) ws[idx0 + i] += phL;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbgn = idx1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction indexOfArray(array, searchElement, fromIndex = 0) {\n\t\t\t\tif (array === null || array === undefined) {\n\t\t\t\t\treturn -1;\n\t\t\t\t}\n\t\t\t\tif (array.length === 0) {\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t\tfor (let i = fromIndex; i < array.length - searchElement.length + 1; i += 1) {\n\t\t\t\t\tlet match = true;\n\t\t\t\n\t\t\t\t\tfor (let j = 0; j < searchElement.length; j += 1) {\n\t\t\t\t\t\tif (array[i + j] !== searchElement[j]) {\n\t\t\t\t\t\t\tmatch = false;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (match) {\n\t\t\t\t\t\treturn i;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -----------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction createFragment(str, ts, ws, opts) {\n\t\t\t\tconst df = document.createDocumentFragment();\n\t\t\t\tlet temp = '';\n\t\t\t\tlet bgn  = 0;\n\t\t\t\n\t\t\t\tlet idx = 0;\n\t\t\t\tfor (const c of str) {\n\t\t\t\t\tif (ws[idx] <= 0) {\n\t\t\t\t\t\tconst isOrig = isOriginalCharPhrase(ts, bgn, idx);\n\t\t\t\t\t\tappendPhrase(df, temp, isOrig, opts.styleSegment);\n\t\t\t\t\t\ttemp = '';\n\t\t\t\t\t\tbgn  = idx;\n\t\t\t\t\t}\n\t\t\t\t\ttemp += c;\n\t\t\t\t\tidx  += 1;\n\t\t\t\t}\n\t\t\t\tif (temp.length) {\n\t\t\t\t\tconst isOrig = isOriginalCharPhrase(ts, bgn, ts.length);\n\t\t\t\t\tappendPhrase(df, temp, isOrig, opts.styleSegment);\n\t\t\t\t}\n\t\t\t\treturn df;\n\t\t\t}\n\t\t\t\n\t\t\tfunction appendPhrase(df, str, isOrig, style) {\n\t\t\t\tif (isOrig) {\n\t\t\t\t\tdf.appendChild(document.createTextNode(str));\n\t\t\t\t} else {\n\t\t\t\t\tconst e = document.createElement('span');\n\t\t\t\t\te.appendChild(document.createTextNode(str));\n\t\t\t\t\tif (style.length) setClass(e, style);\n\t\t\t\t\tdf.appendChild(e);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction isOriginalCharPhrase(ts, bgn, end) {\n\t\t\t\tfor (let i = bgn; i < end; i += 1) {\n\t\t\t\t\tconst t = ts[i];\n\t\t\t\t\tif (!CLS_ORIG.includes(t)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t\n\t\t\tNS.jaSegmenter      = initialize;\n\t\t\tNS.jaApplySegmenter = apply;\n\t\t}\n\t}\n\n\t// Link --------------------------------------------------------------------\n\n\t{\n\t\t/**\n\t\t *\n\t\t * Common Functions\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-11-10\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction isUrlAnchor(url, a = null, outIsUp = null) {\n\t\t\tif (url !== null && url !== '') {\n\t\t\t\tconst p = url.indexOf('#');\n\t\t\t\tif (p !== -1) {\n\t\t\t\t\tconst id = url.substring(p + 1);\n\t\t\t\t\tif (id.length) {\n\t\t\t\t\t\tconst t = document.getElementById(id);\n\t\t\t\t\t\tif (t !== null) {\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tp === 0 ||\n\t\t\t\t\t\t\t\turl.substring(0, p) === location.href.replace(location.hash ? location.hash : '#', '')\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tif (a && outIsUp) {\n\t\t\t\t\t\t\t\t\tconst from = a.getBoundingClientRect().top;\n\t\t\t\t\t\t\t\t\tconst to   = t.getBoundingClientRect().top;\n\t\t\t\t\t\t\t\t\tif (to < from) outIsUp[0] = true;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t\t\n\n\t\t{\n\t\t\t/**\n\t\t\t *\n\t\t\t * Type\n\t\t\t *\n\t\t\t * @author Takuto Yanagida\n\t\t\t * @version 2021-12-06\n\t\t\t *\n\t\t\t */\n\t\t\t\n\t\t\t\n\t\t\tfunction apply(as, opts = {}) {\n\t\t\t\topts = Object.assign({\n\t\t\t\t\tstyleLinkImage   : ':ncLinkImage',\n\t\t\t\t\tstyleLinkSimple  : ':ncLinkSimple',\n\t\t\t\t\tstyleLinkAnchor  : ':ncLinkAnchor',\n\t\t\t\t\tstyleLinkExternal: ':ncLinkExternal',\n\t\t\t\t\tstyleLinkFile    : ':ncLinkFile',\n\t\t\t\t\tallowedClasses   : ALLOWED_CLASSES,\n\t\t\t\t\textensionTable   : EXT_TABLE,\n\t\t\t\t\tisUrlExternal    : isUrlExternal,\n\t\t\t\t}, opts);\n\t\t\t\n\t\t\t\tfor (const a of as) {\n\t\t\t\t\taddClass(a, a.getAttribute('href'), opts);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction applyByUrl(as, opts = {}) {\n\t\t\t\topts = Object.assign({\n\t\t\t\t\tstyleLinkAnchor  : ':ncLinkAnchor',\n\t\t\t\t\tstyleLinkExternal: ':ncLinkExternal',\n\t\t\t\t\tstyleLinkFile    : ':ncLinkFile',\n\t\t\t\t\textensionTable   : EXT_TABLE,\n\t\t\t\t\tisUrlExternal    : isUrlExternal,\n\t\t\t\t}, opts);\n\t\t\t\n\t\t\t\tfor (const a of as) {\n\t\t\t\t\taddClassByUrl(a, a.getAttribute('href'), opts);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tconst ALLOWED_CLASSES = [\n\t\t\t\t'alignleft',\n\t\t\t\t'aligncenter',\n\t\t\t\t'alignright',\n\t\t\t\t'size-thumbnail',\n\t\t\t\t'size-small',\n\t\t\t\t'size-medium-small',\n\t\t\t\t'size-medium',\n\t\t\t\t'size-medium-large',\n\t\t\t\t'size-medium_large',\n\t\t\t\t'size-large',\n\t\t\t\t'size-full'\n\t\t\t];\n\t\t\t\n\t\t\tconst EXT_TABLE = {\n\t\t\t\tdoc : 'doc',\n\t\t\t\tdocx: 'doc',\n\t\t\t\txls : 'xls',\n\t\t\t\txlsx: 'xls',\n\t\t\t\tppt : 'ppt',\n\t\t\t\tpptx: 'ppt',\n\t\t\t\tpdf : 'pdf'\n\t\t\t};\n\t\t\t\n\t\t\t\n\t\t\t// -------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction addClass(a, url, opts) {\n\t\t\t\tif (isLinkImage(a, opts)) {\n\t\t\t\t\tsetClass(a, opts.styleLinkImage);\n\t\t\t\t} else {\n\t\t\t\t\tif (isLinkEmpty(a)) {\n\t\t\t\t\t\taddClassByUrl(a, url, opts);\n\t\t\t\t\t} else if (isLinkSimple(a)) {\n\t\t\t\t\t\tsetClass(a, opts.styleLinkSimple);\n\t\t\t\t\t\tif (isLinkSimpleUrl(a, url)) {\n\t\t\t\t\t\t\tsetClass(a, opts.styleLinkSimple, true, 'url');\n\t\t\t\t\t\t}\n\t\t\t\t\t\taddClassByUrl(a, url, opts);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction isLinkImage(a, opts) {\n\t\t\t\tif (a.className) {\n\t\t\t\t\tfor (const c of a.className.split(' ')) {\n\t\t\t\t\t\tif (!opts.allowedClasses.includes(c)) return false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlet ok = false;\n\t\t\t\tfor (const c of a.childNodes) {\n\t\t\t\t\tif (c.nodeType === 1) {  // ELEMENT_NODE\n\t\t\t\t\t\tif (!ok && c.tagName === 'IMG') {\n\t\t\t\t\t\t\tok = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tok = false;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn ok;\n\t\t\t}\n\t\t\t\n\t\t\tfunction isLinkSimple(a) {\n\t\t\t\tif (a.className) return false;\n\t\t\t\tconst cs = a.childNodes;\n\t\t\t\tif (cs.length === 0) return false;\n\t\t\t\tfor (const c of cs) {\n\t\t\t\t\tif (c.className) return false;\n\t\t\t\t\tif (c.nodeType === 1) {  // ELEMENT_NODE\n\t\t\t\t\t\tif (c.tagName !== 'BR' && !getComputedStyle(c).display.includes('inline')) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\t\n\t\t\tfunction isLinkEmpty(a) {\n\t\t\t\treturn !a.className && a.childNodes.length === 0;\n\t\t\t}\n\t\t\t\n\t\t\tfunction isLinkSimpleUrl(a, url) {\n\t\t\t\treturn url !== null && url !== '' && a.childNodes.length && a.innerHTML.trim() === url;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction addClassByUrl(a, url, opts) {\n\t\t\t\tconst outIsUp = [false];\n\t\t\t\tif (isUrlAnchor(url, a, outIsUp)) {\n\t\t\t\t\tsetClass(a, opts.styleLinkAnchor, true, outIsUp[0] ? 'up' : '');\n\t\t\t\t} else if (opts.isUrlExternal(url)) {\n\t\t\t\t\tsetClass(a, opts.styleLinkExternal);\n\t\t\t\t}\n\t\t\t\tconst t = getFileType(url, opts.extensionTable);\n\t\t\t\tif (t) {\n\t\t\t\t\tsetClass(a, opts.styleLinkFile);\n\t\t\t\t\tsetClass(a, opts.styleLinkFile, true, t);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction isUrlExternal(url) {\n\t\t\t\tif (url !== null && url !== '') {\n\t\t\t\t\tif (!url.startsWith(`${location.protocol}//${location.host}`)) {\n\t\t\t\t\t\tif (url.match(/^https?:\\/\\//) || url.match(/^\\/\\//)) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\tfunction getFileType(url, extTab) {\n\t\t\t\tif (url !== null && url !== '' && !url.endsWith('/')) {\n\t\t\t\t\tconst d = url.indexOf('//');\n\t\t\t\t\tif (d !== -1) {\n\t\t\t\t\t\tconst s = url.indexOf('/', d + 2);\n\t\t\t\t\t\turl = (s === -1) ? '' : url.substring(s + 1);\n\t\t\t\t\t}\n\t\t\t\t\tconst p = url.lastIndexOf('.');\n\t\t\t\t\tif (p !== -1) {\n\t\t\t\t\t\tconst ext = url.substring(p + 1).toLowerCase();\n\t\t\t\t\t\treturn extTab[ext] ?? null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t\n\t\t\tNS.linkApply      = apply;\n\t\t\tNS.linkApplyByUrl = applyByUrl;\n\n\t\t\tNS.linkIsLinkImage = isLinkImage;\n\t\t}\n\n\t\t{\n\t\t\t/**\n\t\t\t *\n\t\t\t * Anchor Scroll\n\t\t\t *\n\t\t\t * @author Takuto Yanagida\n\t\t\t * @version 2021-11-29\n\t\t\t *\n\t\t\t */\n\t\t\t\n\t\t\t\n\t\t\tconst DURATION = 400;\n\t\t\t\n\t\t\tlet isScrolling = false;\n\t\t\tconst anchorWithListener = new Set();\n\t\t\t\n\t\t\tfunction initialize(as, opts = {}) {\n\t\t\t\topts = Object.assign({\n\t\t\t\t\tduration        : DURATION,\n\t\t\t\t\tobservedSelector: null,\n\t\t\t\t}, opts);\n\t\t\t\n\t\t\t\tfor (const a of as) {\n\t\t\t\t\tapply(a, opts);\n\t\t\t\t}\n\t\t\t\tdocument.addEventListener('wheel', () => { isScrolling = false; });\n\t\t\t\n\t\t\t\tif (opts['observedSelector']) {\n\t\t\t\t\tconst oes = document.querySelectorAll(opts['observedSelector']);\n\t\t\t\t\tif (oes.length) {\n\t\t\t\t\t\tconst mo = new MutationObserver(rs => {\n\t\t\t\t\t\t\tfor (const r of rs) {\n\t\t\t\t\t\t\t\tfor (const n of r.addedNodes) {\n\t\t\t\t\t\t\t\t\tif (n.nodeType === 1 && n.tagName === 'A') {\n\t\t\t\t\t\t\t\t\t\tapply(n, opts);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfor (const oe of oes) {\n\t\t\t\t\t\t\tmo.observe(oe, {\n\t\t\t\t\t\t\t\tchildList: true,\n\t\t\t\t\t\t\t\tsubtree  : true,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction apply(a, opts) {\n\t\t\t\tif (!anchorWithListener.has(a)) {\n\t\t\t\t\tfunction onClick(e) { doClick(e, opts); }\n\t\t\t\t\tif (a.href === '#' || a.href === '#top' || isUrlAnchor(a.href)) {\n\t\t\t\t\t\ta.addEventListener('click', onClick);\n\t\t\t\t\t\tanchorWithListener.add(a);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction doClick(e, opts) {\n\t\t\t\tif (e.button !== 0 || e.ctrlKey || e.shiftKey || e.altKey || e.metaKey) return;\n\t\t\t\tconst href = e.currentTarget.getAttribute('href');\n\t\t\t\tconst idx  = href.indexOf('#');\n\t\t\t\tif (idx !== -1) {\n\t\t\t\t\tsmoothScrollToHash(e, href.substring(idx), opts.duration);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction smoothScrollToHash(e, hash, duration = DURATION) {\n\t\t\t\tconst top = (hash === null || hash === '' || hash === '#' || hash === '#top');\n\t\t\t\tconst tar = top ? document.documentElement : document.getElementById(hash.substring(1));\n\t\t\t\tif (tar && !window.matchMedia('(prefers-reduced-motion: reduce)').matches) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\n\t\t\t\t\tsmoothScrollToElement(tar, duration);\n\t\t\t\t\tif (hash !== window.location.hash) {\n\t\t\t\t\t\thistory.pushState(null, null, (hash === '#top' ? '' : hash));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -----------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction smoothScrollToElement(tar, duration = DURATION, focus = true) {\n\t\t\t\tconst start = window.pageYOffset;\n\t\t\t\tlet posY = getScrollPos(tar);\n\t\t\t\tlet wh   = document.documentElement.offsetHeight;\n\t\t\t\n\t\t\t\tlet timeStart;\n\t\t\t\tisScrolling = true;\n\t\t\t\trequestAnimationFrame((time) => { timeStart = time; loop(time); });\n\t\t\t\n\t\t\t\tfunction loop(time) {\n\t\t\t\t\tif (!isScrolling) return;\n\t\t\t\t\tif (wh !== document.documentElement.offsetHeight) {  // For delay loading\n\t\t\t\t\t\tposY = getScrollPos(tar);\n\t\t\t\t\t\twh   = document.documentElement.offsetHeight;\n\t\t\t\t\t}\n\t\t\t\t\twindow.scrollTo(0, easing(time - timeStart, start, posY, duration));\n\t\t\t\t\tif (time - timeStart < duration) {\n\t\t\t\t\t\trequestAnimationFrame(loop)\n\t\t\t\t\t} else {\n\t\t\t\t\t\twindow.scrollTo(0, getScrollPos(tar));\n\t\t\t\t\t\tsetTimeout(() => window.scrollTo(0, getScrollPos(tar)), 50);\n\t\t\t\t\t\tif (focus && tar && tar !== document.documentElement) {\n\t\t\t\t\t\t\ttar.focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tisScrolling = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction getScrollPos(tar) {\n\t\t\t\tconst spt = parseInt(getComputedStyle(document.documentElement).scrollPaddingTop);\n\t\t\t\treturn tar.getBoundingClientRect().top + window.pageYOffset - spt;\n\t\t\t}\n\t\t\t\n\t\t\tfunction easing(t, b, c, d) {\n\t\t\t\tt /= d / 2;\n\t\t\t\tif (t < 1) return (c - b) / 2 * t * t + b;\n\t\t\t\tt--;\n\t\t\t\treturn -(c - b) / 2 * (t * (t - 2) - 1) + b;\n\t\t\t}\n\t\t\t\n\t\t\tNS.linkAnchorScroll = initialize;\n\n\t\t\tNS.smoothScrollToElement = smoothScrollToElement;\n\t\t}\n\t}\n\n\t// List --------------------------------------------------------------------\n\n\t{\n\t\t/**\n\t\t *\n\t\t * Customized\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-11-11\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction initialize(uls, opts = {}) {\n\t\t\topts = Object.assign({\n\t\t\t\tstyleList     : ':ncList',\n\t\t\t\tcustomizedType: [],\n\t\t\t\tdoClearStyle  : true,\n\t\t\t}, opts);\n\t\t\n\t\t\tfor (const ul of uls) {\n\t\t\t\tsetStyle(ul, opts);\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction setStyle(t, opts) {\n\t\t\tconst type = t.style.listStyleType;\n\t\t\tif (type !== '' && type !== 'none' && opts.customizedType.includes(type)) {\n\t\t\t\tif (opts.doClearStyle) {\n\t\t\t\t\tconst re = new RegExp('list-style\\\\s*:\\\\s*' + type + '\\\\s*;?', 'gi');\n\t\t\t\t\tif (t.getAttribute('style').match(re)) {\n\t\t\t\t\t\tt.removeAttribute('style');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tt.style.listStyleType = '';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tsetClass(t, opts.styleList, true, type);\n\t\t\t}\n\t\t}\n\t\t\n\t\tNS.listCustomized = initialize;\n\t}\n\n\t// Scroll Effect -----------------------------------------------------------\n\n\t{\n\t\t/**\n\t\t *\n\t\t * Scroll Effect\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-11-17\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction initialize(ts, opts = {}) {\n\t\t\tif (ts.length === 0) return;\n\t\t\n\t\t\topts = Object.assign({\n\t\t\t\tstyleEffect: ':ncScrollEffect',\n\t\t\t}, opts);\n\t\t\n\t\t\tonIntersect(doIntersect, ts, 0.5, '* 10000% 0px 10000%');\n\t\t\tfunction doIntersect(vs) {\n\t\t\t\tfor (let i = 0; i < ts.length; i += 1) {\n\t\t\t\t\tif (vs[i]) setClass(ts[i], opts['styleEffect'], true, 'visible');\n\t\t\t\t}\n\t\t\t}\n\t\t\n\t\t\twindow.addEventListener('beforeprint', () => {\n\t\t\t\tfor (const c of ts) {\n\t\t\t\t\tsetClass(c, opts['styleEffect'], true, 'visible');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t\n\t\tNS.scroll = initialize;\n\t}\n\n\t// Tab ---------------------------------------------------------------------\n\n\t{\n\t\t/**\n\t\t *\n\t\t * Common Functions\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-10-23\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction getFirstHeading(container) {\n\t\t\tconst cs = container.children;\n\t\t\tfor (let i = 0; i < cs.length; i += 1) {\n\t\t\t\tif (/^H[1-6]$/.test(cs[i].tagName)) return cs[i];\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t\t\n\t\tfunction createAnchor(h) {\n\t\t\tconst a = document.createElement('a');\n\t\t\ta.href  = '#' + h.id;\n\t\t\ta.title = h.elm.innerText;\n\t\t\tconst t = h.elm.title ? h.elm.title : h.elm.innerHTML;\n\t\t\n\t\t\ta.innerHTML = t;\n\t\t\ta.querySelectorAll('small').forEach(e => e.remove());\n\t\t\tif (a.innerText === '') {\n\t\t\t\ta.innerHTML = t;\n\t\t\t}\n\t\t\tspanning(a);\n\t\t\treturn a;\n\t\t}\n\t\t\n\t\tfunction spanning(e) {\n\t\t\tfor (const c of Array.from(e.children)) {\n\t\t\t\tif (c.tagName === 'A' || c.tagName === 'SMALL') {\n\t\t\t\t\tconst s = document.createElement('span');\n\t\t\t\t\ts.innerHTML = c.innerHTML;\n\t\t\t\t\te.replaceChild(s, c);\n\t\t\t\t\tspanning(s);\n\t\t\t\t} else {\n\t\t\t\t\tspanning(c);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\n\t\t{\n\t\t\t/**\n\t\t\t *\n\t\t\t * Scroll\n\t\t\t *\n\t\t\t * @author Takuto Yanagida\n\t\t\t * @version 2021-11-30\n\t\t\t *\n\t\t\t */\n\t\t\t\n\t\t\t\n\t\t\tfunction initialize(cs, opts = {}) {\n\t\t\t\tif (cs.length === 0) return;\n\t\t\t\n\t\t\t\topts = Object.assign({\n\t\t\t\t\tstyleBar    : ':ncTabBar',\n\t\t\t\t\tstyleCurrent: ':ncCurrent',\n\t\t\t\t\tstyleActive : ':ncActive',\n\t\t\t\t\thashPrefix  : 'tsc:',\n\t\t\t\t}, opts);\n\t\t\t\tconst is = [];\n\t\t\t\tfor (let i = 0; i < cs.length; i += 1) {\n\t\t\t\t\tconst inst = create(cs[i], i + 1, opts);\n\t\t\t\t\tif (inst) is.push(inst);\n\t\t\t\t}\n\t\t\t\twindow.addEventListener('hashchange', () => is.forEach(onHashChanged));\n\t\t\t}\n\t\t\t\n\t\t\tfunction onHashChanged(inst) {\n\t\t\t\tconst tar = getCurrentByHash(inst, location.hash);\n\t\t\t\tinst.active = tar;\n\t\t\t\tsetTimeout(() => update(inst), 10);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction create(cont, cid, opts) {\n\t\t\t\tconst inst = {\n\t\t\t\t\topts,\n\t\t\t\t\tvs    : null,\n\t\t\t\t\tuls   : [],\n\t\t\t\t\tactive: null,\n\t\t\t\t}\n\t\t\t\tconst hs = extractHeaders(cont, cid, opts.hashPrefix);\n\t\t\t\tif (hs.length === 0) return false;\n\t\t\t\n\t\t\t\tconst noHash = location.hash.length <= 1;\n\t\t\t\tconst bars   = [];\n\t\t\t\ths.forEach((h, idx) => {\n\t\t\t\t\tconst bar = createBar(hs, h, opts, noHash && idx === 0);\n\t\t\t\t\tcont.insertBefore(bar.ul, h.elm);\n\t\t\t\t\tbars.push(bar);\n\t\t\t\t\tinst.uls.push(bar.ul);\n\t\t\t\t});\n\t\t\t\tassignEvent(inst, bars);\n\t\t\t\n\t\t\t\tinst.active = getCurrentByHash(inst, location.hash);\n\t\t\t\tsetTimeout(() => update(inst), 100);  // For avoiding unnecessary update\n\t\t\t\treturn inst;\n\t\t\t}\n\t\t\t\n\t\t\tfunction getCurrentByHash(inst, hash) {\n\t\t\t\tconst id = hash.replace('#', '');\n\t\t\t\tif (id !== '') {\n\t\t\t\t\tconst tar = document.getElementById(id);\n\t\t\t\t\tif (tar && inst.uls.indexOf(tar) !== 0) {\n\t\t\t\t\t\treturn tar;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction extractHeaders(cont, cid, prefix) {\n\t\t\t\tconst fh = getFirstHeading(cont);\n\t\t\t\tif (!fh) return [];\n\t\t\t\tconst tn = fh.tagName;\n\t\t\t\tconst hs = [];\n\t\t\t\n\t\t\t\tfor (const elm of Array.from(cont.children)) {\n\t\t\t\t\tif (elm.tagName === tn) {\n\t\t\t\t\t\tconst id = `${prefix}${cid}-${hs.length + 1}`;\n\t\t\t\t\t\ths.push({ elm, id });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn hs;\n\t\t\t}\n\t\t\t\n\t\t\tfunction createBar(hs, curH, opts, activate) {\n\t\t\t\tconst ul = document.createElement('ul');\n\t\t\t\tul.id = curH.id;\n\t\t\t\tul.className = '';  // for Dummy\n\t\t\t\tsetClass(ul, opts.styleBar);\n\t\t\t\tif (activate) setClass(ul, opts.styleActive);\n\t\t\t\tconst as = [];\n\t\t\t\n\t\t\t\tfor (const h of hs) {\n\t\t\t\t\tconst a = createAnchor(h);\n\t\t\t\t\tconst li = document.createElement('li');\n\t\t\t\t\tif (h === curH) setClass(li, opts.styleCurrent);\n\t\t\t\t\tli.appendChild(a);\n\t\t\t\t\tul.appendChild(li);\n\t\t\t\t\tas.push(a);\n\t\t\t\t}\n\t\t\t\treturn { ul, as };\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction assignEvent(inst, bars) {\n\t\t\t\tfor (const bar of bars) {\n\t\t\t\t\tbar.as.forEach((a, i) => {\n\t\t\t\t\t\ta.addEventListener('click', () => onClick(inst, bars[i].ul));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tonIntersect((vs) => {\n\t\t\t\t\tinst.vs = vs;\n\t\t\t\t\tupdate(inst);\n\t\t\t\t}, inst.uls, 0);\n\t\t\t}\n\t\t\t\n\t\t\tfunction onClick(inst, clicked) {\n\t\t\t\tinst.active = clicked;\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tif (inst.active) {\n\t\t\t\t\t\tconst y = inst.active.getBoundingClientRect().top;\n\t\t\t\t\t\tinst.active = null;\n\t\t\t\t\t\tif (window.innerHeight < y) update(inst);\n\t\t\t\t\t}\n\t\t\t\t}, 1000);\n\t\t\t}\n\t\t\t\n\t\t\tfunction update(inst) {\n\t\t\t\tconst tar = inst.active ? inst.active : getFirstVisible(inst);\n\t\t\t\tfor (const ul of inst.uls) {\n\t\t\t\t\tsetClass(ul, inst.opts.styleActive, ul === tar);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction getFirstVisible(inst) {\n\t\t\t\tif (!inst.vs) return null;\n\t\t\t\treturn inst.uls.find((ul, i) => inst.vs[i]);\n\t\t\t}\n\t\t\t\n\t\t\tNS.tabScroll = initialize;\n\t\t}\n\n\t\t{\n\t\t\t/**\n\t\t\t *\n\t\t\t * Stack\n\t\t\t *\n\t\t\t * @author Takuto Yanagida\n\t\t\t * @version 2021-10-23\n\t\t\t *\n\t\t\t */\n\t\t\t\n\t\t\t\n\t\t\tfunction initialize(cs, opts = {}) {\n\t\t\t\tif (cs.length === 0) return;\n\t\t\t\n\t\t\t\topts = Object.assign({\n\t\t\t\t\tstyleBar      : ':ncTabBar',\n\t\t\t\t\tstyleCurrent  : ':ncCurrent',\n\t\t\t\t\tstyleActive   : ':ncActive',\n\t\t\t\t\thashPrefix    : 'tst:',\n\t\t\t\t\tmaxHeightRate : 0.8,\n\t\t\t\t\tdoRemoveHeader: false,\n\t\t\t\t}, opts);\n\t\t\t\tconst is = [];\n\t\t\t\tfor (let i = 0; i < cs.length; i += 1) {\n\t\t\t\t\tconst inst = create(cs[i], i + 1, opts);\n\t\t\t\t\tif (inst) is.push(inst);\n\t\t\t\t}\n\t\t\t\tonResize(() => is.forEach(resize), true);\n\t\t\t\twindow.addEventListener('hashchange', () => is.forEach(onHashChanged) );\n\t\t\t\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tconst id = location.hash.replace('#', '');\n\t\t\t\t\tif (id !== '') {\n\t\t\t\t\t\tconst tar = document.getElementById(id);\n\t\t\t\t\t\tif (tar) tar.scrollIntoView({ behavior: 'smooth' });\n\t\t\t\t\t}\n\t\t\t\t}, 10);\n\t\t\t}\n\t\t\t\n\t\t\tfunction onHashChanged(inst) {\n\t\t\t\tlet idx = getCurrentByHash(inst, location.hash);\n\t\t\t\tif (idx === null) idx = getAnchorPage(inst, location.hash);\n\t\t\t\tif (idx !== null) setTimeout(() => update(inst, idx), 10);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction create(cont, cid, opts) {\n\t\t\t\tconst inst = {\n\t\t\t\t\topts,\n\t\t\t\t\tcont,\n\t\t\t\t\tps    : null,\n\t\t\t\t\tbars  : [],\n\t\t\t\t\tcurIdx: 0,\n\t\t\t\t};\n\t\t\t\tconst [hs, ps] = extractHeadersAndPages(cont, cid, opts);\n\t\t\t\tif (hs.length === 0) return false;\n\t\t\t\tinst.ps = ps;\n\t\t\t\n\t\t\t\tconst bar0 = createBar(hs, opts);\n\t\t\t\tconst bar1 = createBar(hs, opts);\n\t\t\t\tinst.bars.push(bar0, bar1);\n\t\t\t\n\t\t\t\tcont.insertBefore(bar0.ul, cont.firstChild);\n\t\t\t\tfor (const p of ps) cont.appendChild(p);\n\t\t\t\tcont.appendChild(bar1.ul);\n\t\t\t\n\t\t\t\tassignEvent(inst);\n\t\t\t\n\t\t\t\tconst h = location.hash;\n\t\t\t\tlet idx = getCurrentByHash(inst, h);\n\t\t\t\tif (idx === null) idx = getAnchorPage(inst, h);\n\t\t\t\tif (idx === null) idx = isAccordion(inst) ? -1 : 0;\n\t\t\t\tsetTimeout(() => update(inst, idx), 10);\n\t\t\t\treturn inst;\n\t\t\t}\n\t\t\t\n\t\t\tfunction getCurrentByHash(inst, hash) {\n\t\t\t\tif (hash.indexOf('#') === -1) return null;\n\t\t\t\tconst re = new RegExp(hash + '$', 'g');\n\t\t\t\tconst as = inst.bars[0].as;\n\t\t\t\tfor (let i = 0; i < as.length; i += 1) {\n\t\t\t\t\tif (as[i].href.match(re)) return i;\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t\n\t\t\tfunction getAnchorPage(inst, hash) {\n\t\t\t\tconst id = hash.replace('#', '');\n\t\t\t\tif (id !== '') {\n\t\t\t\t\tconst tar = document.getElementById(id);\n\t\t\t\t\tif (tar) {\n\t\t\t\t\t\tconst idx = inst.ps.findIndex(p => p.contains(tar));\n\t\t\t\t\t\tif (idx !== -1) return idx;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction extractHeadersAndPages(cont, cid, opts) {\n\t\t\t\tconst fh = getFirstHeading(cont);\n\t\t\t\tif (!fh) return [];\n\t\t\t\tconst tn = fh.tagName;\n\t\t\t\tconst hs = [];\n\t\t\t\tconst ps = [];\n\t\t\t\tlet curP = null;\n\t\t\t\n\t\t\t\tfor (const elm of Array.from(cont.children)) {\n\t\t\t\t\tif (elm.tagName === tn) {\n\t\t\t\t\t\tconst id = `${opts.hashPrefix}${cid}-${hs.length + 1}`;\n\t\t\t\t\t\ths.push({ elm, id });\n\t\t\t\n\t\t\t\t\t\tif (curP) ps.push(curP);\n\t\t\t\t\t\tcurP = document.createElement('div');\n\t\t\t\t\t\tif (opts.doRemoveHeader) {\n\t\t\t\t\t\t\tcont.removeChild(elm);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcurP.appendChild(elm);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (curP) curP.appendChild(elm);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (curP) ps.push(curP);\n\t\t\t\treturn [hs, ps];\n\t\t\t}\n\t\t\t\n\t\t\tfunction createBar(hs, opts) {\n\t\t\t\tconst ul = document.createElement('ul');\n\t\t\t\tul.className = '';  // for Dummy\n\t\t\t\tsetClass(ul, opts.styleBar);\n\t\t\t\tconst as = [];\n\t\t\t\n\t\t\t\tfor (const h of hs) {\n\t\t\t\t\tconst a = createAnchor(h);\n\t\t\t\t\tconst li = document.createElement('li');\n\t\t\t\t\tli.appendChild(a);\n\t\t\t\t\tul.appendChild(li);\n\t\t\t\t\tas.push(a);\n\t\t\t\t}\n\t\t\t\treturn { ul, as };\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction assignEvent(inst) {\n\t\t\t\tfor (const bar of inst.bars) {\n\t\t\t\t\tbar.as.forEach((a, i) => {\n\t\t\t\t\t\ta.addEventListener('click', (e) => onClick(e, inst, i));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction onClick(e, inst, idx) {\n\t\t\t\te.preventDefault();\n\t\t\t\tif (getComputedStyle(e.target.parentElement).pointerEvents === 'none') return;\n\t\t\t\tlet url = e.target.href;\n\t\t\t\tif (inst.curIdx === idx) {\n\t\t\t\t\tidx = -1;\n\t\t\t\t\turl = url.replace(/#.*$/, '');\n\t\t\t\t}\n\t\t\t\thistory.pushState({}, null, url);\n\t\t\t\tupdate(inst, idx);\n\t\t\t\tscrollToTab(inst);\n\t\t\t}\n\t\t\t\n\t\t\tfunction isAccordion(inst) {\n\t\t\t\treturn getComputedStyle(inst.bars[0].ul).flexDirection === 'column';\n\t\t\t}\n\t\t\t\n\t\t\tfunction scrollToTab(inst) {\n\t\t\t\tif (inst.curIdx === -1) return;\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tconst [{ ul: ul0 }, { ul: ul1 }] = inst.bars;\n\t\t\t\t\tconst r0 = ul0.getBoundingClientRect();\n\t\t\t\t\tif (0 <= r0.top && r0.top <= window.innerHeight && 0 <= r0.bottom && r0.bottom <= window.innerHeight) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst r1 = ul1.getBoundingClientRect();\n\t\t\t\t\tif (isAccordion(inst) || (r1.top < 0 || window.innerHeight < r1.bottom)) {\n\t\t\t\t\t\tinst.cont.scrollIntoView({ behavior: 'smooth' });\n\t\t\t\t\t}\n\t\t\t\t}, 10);\n\t\t\t}\n\t\t\t\n\t\t\tfunction update(inst, idx) {\n\t\t\t\tconst ps = inst.ps;\n\t\t\t\tconst [{ as: a0 }, { as: a1 }] = inst.bars;\n\t\t\t\n\t\t\t\tfor (let i = 0; i < ps.length; i += 1) {\n\t\t\t\t\tsetClass(a0[i].parentElement, inst.opts.styleCurrent, i === idx);\n\t\t\t\t\tsetClass(a1[i].parentElement, inst.opts.styleCurrent, i === idx);\n\t\t\t\t\tsetClass(ps[i], inst.opts.styleCurrent, i === idx);\n\t\t\t\t}\n\t\t\t\tinst.curIdx = idx;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction resize(inst) {\n\t\t\t\tconst cont = inst.cont;\n\t\t\t\tif (isAccordion(inst)) {\n\t\t\t\t\tcont.style.minHeight = '';\n\t\t\t\t} else {\n\t\t\t\t\tconst minH = getMinHeight(inst);\n\t\t\t\t\tconst h = (minH < window.innerHeight * inst.opts.maxHeightRate) ? `${minH}px` : '';\n\t\t\t\t\tcont.style.minHeight = h;\n\t\t\t\n\t\t\t\t\tif (inst.curIdx === -1) {\n\t\t\t\t\t\tupdate(inst, 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction getMinHeight(inst) {\n\t\t\t\tconst [{ ul: ul0 }, { ul: ul1 }] = inst.bars;\n\t\t\t\n\t\t\t\tlet marginBtm = parseInt(getComputedStyle(ul0).marginBottom);\n\t\t\t\tlet marginTop = parseInt(getComputedStyle(ul1).marginTop);\n\t\t\t\tlet height = 0;\n\t\t\t\n\t\t\t\tfor (const p of inst.ps) {\n\t\t\t\t\tconst ps = getComputedStyle(p);\n\t\t\t\t\tconst mt = parseInt(ps.marginTop);\n\t\t\t\t\tconst mb = parseInt(ps.marginBottom);\n\t\t\t\t\tconst h  = p.getBoundingClientRect().height;\n\t\t\t\n\t\t\t\t\tmarginBtm = Math.max(marginBtm, mt);\n\t\t\t\t\tmarginTop = Math.max(marginTop, mb);\n\t\t\t\t\theight    = Math.max(height, h);\n\t\t\t\t}\n\t\t\t\treturn ul0.offsetHeight + ul1.offsetHeight + marginBtm + marginTop + height;\n\t\t\t}\n\t\t\t\n\t\t\tNS.tabStack = initialize;\n\t\t}\n\t}\n\n\t// Table -------------------------------------------------------------------\n\n\t{\n\t\t{\n\t\t\t/**\n\t\t\t *\n\t\t\t * Neat Width\n\t\t\t *\n\t\t\t * @author Takuto Yanagida\n\t\t\t * @version 2021-11-11\n\t\t\t *\n\t\t\t */\n\t\t\t\n\t\t\t\n\t\t\tfunction initialize(tabs, opts = {}) {\n\t\t\t\tif (tabs.length === 0) return;\n\t\t\t\n\t\t\t\tconst lt = tabs[tabs.length - 1];\n\t\t\t\tconst cm = Object.assign({\n\t\t\t\t\tfullWidthRate   : 0.95,\n\t\t\t\t\tcellMinWidth    : 80,\n\t\t\t\t\tcellMinAspect   : 2 / 3,  // width / height\n\t\t\t\t\tcellMinLength   : 8,\n\t\t\t\t\tmaxRowSize      : 200,\n\t\t\t\t\tmaxBorderWidth  : 2,\n\t\t\t\t\tbefore          : null,  // function (table) { ...; return delay; }\n\t\t\t\t\tafter           : null,  // function (table) { ... }\n\t\t\t\t\tstyleNeat       : ':ncTableNeat',\n\t\t\t\t\tstyleFull       : ':ncTableFull',\n\t\t\t\t\tstyleScrollRight: ':ncScrollRight',\n\t\t\t\t\tstyleScrollLeft : ':ncScrollLeft',\n\t\t\t\t}, opts, getCommonMetrics(lt));\n\t\t\t\n\t\t\t\tcm.padH += cm.maxBorderWidth * 2;\n\t\t\t\tcm.padV += cm.maxBorderWidth * 2;\n\t\t\t\tcm.dcTd = makeDummyCell(lt, 'td');\n\t\t\t\tcm.dcTh = makeDummyCell(lt, 'th');\n\t\t\t\n\t\t\t\tconst tarTabs = [], noTarTabs = [];\n\t\t\t\tfor (const t of tabs) {\n\t\t\t\t\tif (isTarget(t, cm)) tarTabs.push(t);\n\t\t\t\t\telse noTarTabs.push(t);\n\t\t\t\t}\n\t\t\t\tcm.gcCount = tarTabs.length;\n\t\t\t\n\t\t\t\tfor (const t of tarTabs) {\n\t\t\t\t\tconst delay = (cm.before) ? (cm.before(t) ?? 0) : false;\n\t\t\t\t\tst(() => {\n\t\t\t\t\t\tapply(t, cm);\n\t\t\t\t\t\tsetClass(t, cm.styleNeat);\n\t\t\t\t\t\tif (cm.after) cm.after(t);\n\t\t\t\t\t\tif (--cm.gcCount === 0) removeDummyCell(lt, cm);\n\t\t\t\t\t}, delay);\n\t\t\t\t}\n\t\t\t\tif (cm.fullWidthRate) {\n\t\t\t\t\tfor (const t of noTarTabs) {\n\t\t\t\t\t\tconst pw = t.parentElement.clientWidth;\n\t\t\t\t\t\tif (pw * cm.fullWidthRate < t.clientWidth) setClass(t, cm.styleFull);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfunction st(fn, d) { (d === false) ? fn() : setTimeout(fn, d); }\n\t\t\t\tinitScroll(tarTabs, cm);\n\t\t\t}\n\t\t\t\n\t\t\tfunction getCommonMetrics(tab) {\n\t\t\t\tconst td = tab.getElementsByTagName('td')[0];\n\t\t\t\tconst s = getComputedStyle(td);\n\t\t\t\tconst padH  = parseFloat(s.paddingLeft) + parseFloat(s.paddingRight);\n\t\t\t\tconst padV  = parseFloat(s.paddingTop) + parseFloat(s.paddingBottom);\n\t\t\t\tconst [charW, lineH] = getTextSize(td);\n\t\t\t\treturn { padH, padV, charW, lineH };\n\t\t\t}\n\t\t\t\n\t\t\tfunction getTextSize(elm) {\n\t\t\t\tconst d = document.createElement(elm.nodeName);\n\t\t\t\td.setAttribute('style', `position:fixed;margin:0;padding:0;font-family:${elm.style.fontFamily || 'inherit'};font-size:${elm.style.fontSize || 'inherit'};`);\n\t\t\t\td.innerHTML = '\\u3000';  // Full width space\n\t\t\t\telm.parentNode.appendChild(d);\n\t\t\t\tconst w = d.clientWidth;\n\t\t\t\tconst h = d.clientHeight;\n\t\t\t\td.parentNode.removeChild(d);\n\t\t\t\treturn [w, h];\n\t\t\t}\n\t\t\t\n\t\t\tfunction makeDummyCell(t, tagName) {\n\t\t\t\tconst d = document.createElement(tagName);\n\t\t\t\td.setAttribute('style', `position:fixed;display:inline-block;visibility:hidden;white-space:nowrap;`);\n\t\t\t\treturn t.appendChild(d);\n\t\t\t}\n\t\t\t\n\t\t\tfunction removeDummyCell(lt, cMat) {\n\t\t\t\tlt.removeChild(cMat.dcTd);\n\t\t\t\tlt.removeChild(cMat.dcTh);\n\t\t\t}\n\t\t\t\n\t\t\tfunction isTarget(tab, cMet) {\n\t\t\t\tif (tab.rows.length === 0) return false;\n\t\t\t\tif (cMet.maxRowSize < tab.rows.length) return false;\n\t\t\t\n\t\t\t\tconst { cellMinWidth, cellMinAspect } = cMet;\n\t\t\t\tfor (const tr of tab.rows) {\n\t\t\t\t\tif (!tr.hasChildNodes()) continue;\n\t\t\t\t\tfor (const n of tr.childNodes) {\n\t\t\t\t\t\tconst tn = n.tagName;\n\t\t\t\t\t\tif (tn !== 'TD' && tn !== 'TH') continue;\n\t\t\t\t\t\tif (1 < parseInt(n.getAttribute('colSpan'), 10)) continue;\n\t\t\t\t\t\tif (1 < parseInt(n.getAttribute('rowSpan'), 10)) continue;\n\t\t\t\t\t\tconst cw = n.clientWidth;\n\t\t\t\t\t\tconst ch = n.clientHeight;\n\t\t\t\t\t\tif (cw < cellMinWidth || cw / ch < cellMinAspect) return true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction initScroll(tabs, cMet) {\n\t\t\t\tconst rob = new ResizeObserver(oes => {\n\t\t\t\t\tfor (const oe of oes) onScroll(oe.target, cMet);\n\t\t\t\t});\n\t\t\t\tfor (const t of tabs) {\n\t\t\t\t\trob.observe(t);\n\t\t\t\t\tt.addEventListener('scroll', throttle(() => { onScroll(t, cMet); }));\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction onScroll(tab, cMet) {\n\t\t\t\tif (tab.scrollWidth - tab.clientWidth > 2) {  // for avoiding needless scrolling\n\t\t\t\t\tconst r = tab.scrollLeft / (tab.scrollWidth - tab.clientWidth);\n\t\t\t\t\tsetClass(tab, cMet.styleScrollRight, r < 0.95);\n\t\t\t\t\tsetClass(tab, cMet.styleScrollLeft, 0.05 < r);\n\t\t\t\t} else {\n\t\t\t\t\tsetClass(tab, cMet.styleScrollRight, false);\n\t\t\t\t\tsetClass(tab, cMet.styleScrollLeft, false);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction apply(tab, cMet) {\n\t\t\t\ttab.removeAttribute('width');\n\t\t\t\tif (tab.style.width) tab.style.width = null;\n\t\t\t\tif (tab.style.height) tab.style.height = null;\n\t\t\t\n\t\t\t\tconst grid  = makeCellGrid(tab);\n\t\t\t\tconst met   = Object.assign(getMetrics(tab, grid), cMet);\n\t\t\t\tconst newWs = calcNewWidths(grid, met);\n\t\t\t\tsetCellWidth(grid, newWs);\n\t\t\t\n\t\t\t\tconst cs = tab.getElementsByTagName('caption');\n\t\t\t\tif (cs.length) cs[0].innerHTML = `<span>${cs[0].innerHTML}</span>`;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction makeCellGrid(t) {\n\t\t\t\tconst css = collectCells(t);\n\t\t\t\tlet maxWidth = 0;\n\t\t\t\tfor (const cs of css) maxWidth = Math.max(maxWidth, cs.length);\n\t\t\t\tconst g = [];\n\t\t\t\tfor (const cs of css) g.push(new Array(maxWidth));\n\t\t\t\n\t\t\t\tfor (let y = 0; y < g.length; y += 1) {\n\t\t\t\t\tconst gr = g[y];\n\t\t\t\t\tconst tds = css[y];\n\t\t\t\t\tlet i = 0;\n\t\t\t\n\t\t\t\t\tfor (let x = 0; x < maxWidth; x += 1) {\n\t\t\t\t\t\tif (typeof gr[x] === 'number' || gr[x] === null) continue;\n\t\t\t\n\t\t\t\t\t\tconst td = tds[i]\n\t\t\t\t\t\tconst col = parseInt(td.getAttribute('colSpan') ?? 1, 10);\n\t\t\t\t\t\tconst row = parseInt(td.getAttribute('rowSpan') ?? 1, 10);\n\t\t\t\t\t\tgr[x] = td;\n\t\t\t\n\t\t\t\t\t\tif (1 < col) {\n\t\t\t\t\t\t\tfor (let p = 1; p < col; p += 1) gr[x + p] = p;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (1 < row) {\n\t\t\t\t\t\t\tfor (let q = 1; q < row; q += 1) {\n\t\t\t\t\t\t\t\tconst nr = g[y + q];\n\t\t\t\t\t\t\t\tfor (let p = 0; p < col; p += 1) nr[x + p] = null;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\ti += 1;\n\t\t\t\t\t\tif (tds.length <= i) break;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn g;\n\t\t\t}\n\t\t\t\n\t\t\tfunction collectCells(t, css = []) {\n\t\t\t\tfor (const tr of t.rows) {\n\t\t\t\t\tconst cs = [];\n\t\t\t\t\tif (tr.hasChildNodes()) {\n\t\t\t\t\t\tfor (const n of tr.childNodes) {\n\t\t\t\t\t\t\tconst tn = n.tagName;\n\t\t\t\t\t\t\tif (tn === 'TD' || tn === 'TH') cs.push(n);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcss.push(cs);\n\t\t\t\t}\n\t\t\t\treturn css;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction getMetrics(tab, grid) {\n\t\t\t\tconst origTabW = tab.clientWidth;\n\t\t\t\tconst origCellWs = [];\n\t\t\t\tfor (let x = 0; x < grid[0].length; x += 1) {\n\t\t\t\t\tfor (let y = 0; y < grid.length; y += 1) {\n\t\t\t\t\t\tconst g = grid[y][x];\n\t\t\t\t\t\tif (g instanceof HTMLTableCellElement && !g.getAttribute('colSpan')) {\n\t\t\t\t\t\t\torigCellWs.push(g.clientWidth);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn { origTabW, origCellWs };\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction calcNewWidths(grid, met) {\n\t\t\t\tfor (const gr of grid) {\n\t\t\t\t\tfor (const gc of gr) {\n\t\t\t\t\t\tif (typeof gc !== 'number' && gc !== null) gc.style.whiteSpace = 'nowrap';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconst gw = grid[0].length;\n\t\t\t\tconst newWs = new Array(gw).fill(0);\n\t\t\t\tconst fixWs = new Array(gw).fill(0);\n\t\t\t\n\t\t\t\tfor (const gr of grid) {\n\t\t\t\t\tfor (let x = 0; x < gw; x += 1) {\n\t\t\t\t\t\tconst td = gr[x];\n\t\t\t\t\t\tif (td === undefined || td === null || typeof td === 'number') continue;\n\t\t\t\t\t\tif (x < gw - 1 && typeof gr[x + 1] === 'number') continue;\n\t\t\t\t\t\tif (1 < parseInt(td.getAttribute('colSpan'), 10)) continue;\n\t\t\t\t\t\tif (1 < parseInt(td.getAttribute('rowSpan'), 10)) continue;\n\t\t\t\n\t\t\t\t\t\tconst minW = calcMinWidth(td, met);\n\t\t\t\t\t\tnewWs[x] = Math.max(newWs[x], minW);\n\t\t\t\t\t\tif (!minW) fixWs[x] = Math.max(fixWs[x], td.clientWidth);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\twidenTabWidth(newWs, fixWs, met);\n\t\t\t\treturn newWs;\n\t\t\t}\n\t\t\t\n\t\t\tfunction calcMinWidth(td, met) {\n\t\t\t\tconst { padH, padV, charW, lineH, dcTd, dcTh, cellMinWidth, cellMinAspect, cellMinLength } = met;\n\t\t\t\tif (calcMaxLineLength(td) < cellMinLength) return 0;\n\t\t\t\n\t\t\t\ttd.innerHTML = td.innerHTML.trim();\n\t\t\t\tconst dc = td.tagName === 'TD' ? dcTd : dcTh;\n\t\t\t\tdc.innerHTML = td.innerHTML;\n\t\t\t\tconst aw = dc.clientWidth - padH;\n\t\t\t\tconst ls = Math.round((dc.clientHeight - padV) / lineH);\n\t\t\t\tlet minW = 0;\n\t\t\t\tfor (let i = 2;; i += 1) {\n\t\t\t\t\tconst tempW = 0 | (aw / i + charW * i + padH);\n\t\t\t\t\tconst tempH = ls * (i * lineH) + padV;\n\t\t\t\t\tif (tempW < cellMinWidth || tempW / tempH < cellMinAspect || (minW && minW < tempW)) break;\n\t\t\t\t\tminW = tempW;\n\t\t\t\t}\n\t\t\t\treturn (minW + charW < dc.clientWidth) ? minW : 0;\n\t\t\t}\n\t\t\t\n\t\t\tfunction calcMaxLineLength(td) {\n\t\t\t\tconst ih = td.innerHTML.trim();\n\t\t\t\tconst ls = ih.split(/<\\s*br\\s*\\/?>/ui);\n\t\t\t\tconst ts = ls.map(e => e.replace(/<(\"[^\"]*\"|'[^']*'|[^'\">])*>/g, '').length);\n\t\t\t\treturn Math.max(...ts);\n\t\t\t}\n\t\t\t\n\t\t\tfunction widenTabWidth(newWs, fixWs, met) {\n\t\t\t\tconst { origTabW, origCellWs } = met;\n\t\t\t\tlet wNew = 0, wFix = 0;\n\t\t\t\tfor (let i = 0; i < newWs.length; i += 1) {\n\t\t\t\t\tif (newWs[i]) {\n\t\t\t\t\t\twNew += newWs[i];\n\t\t\t\t\t} else {\n\t\t\t\t\t\twFix += fixWs[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (origTabW < wNew + wFix) return;\n\t\t\t\tlet rem = origTabW - wFix;\n\t\t\t\tfor (let i = 0; i < newWs.length; i += 1) {\n\t\t\t\t\tif (!newWs[i]) continue;\n\t\t\t\t\tconst nw = newWs[i];\n\t\t\t\t\tconst w = Math.min(nw / wNew * rem, origCellWs[i]);\n\t\t\t\t\trem  -= (w - nw);\n\t\t\t\t\twNew -= (w - nw);\n\t\t\t\t\tnewWs[i] = 0 | w;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction setCellWidth(grid, ws) {\n\t\t\t\tfor (const gr of grid) {\n\t\t\t\t\tfor (let x = 0; x < gr.length; x += 1) {\n\t\t\t\t\t\tconst gc = gr[x], w = ws[x];\n\t\t\t\t\t\tif (!w || !(gc instanceof HTMLTableCellElement)) continue;\n\t\t\t\t\t\tgc.style.whiteSpace = null;\n\t\t\t\t\t\tgc.style.minWidth   = w + 'px';\n\t\t\t\t\t\tgc.style.width      = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tNS.tableNeatWidth = initialize;\n\t\t}\n\n\t\t{\n\t\t\t/**\n\t\t\t *\n\t\t\t * Usable View\n\t\t\t *\n\t\t\t * @author Takuto Yanagida\n\t\t\t * @version 2021-12-07\n\t\t\t *\n\t\t\t */\n\t\t\t\n\t\t\t\n\t\t\tfunction initialize(tabs, opts = {}) {\n\t\t\t\tif (tabs.length === 0) return;\n\t\t\t\tconst cm = Object.assign({\n\t\t\t\t\tcapableWindowHeightRate: 0.9,\n\t\t\t\t\tstyleHeaderContainer   : ':ncTableStickyHeaderContainer',\n\t\t\t\t\tstyleHeaderTable       : ':ncTableStickyHeaderTable',\n\t\t\t\t\tstyleScrollBar         : ':ncTableStickyScrollBar',\n\t\t\t\n\t\t\t\t\tstyleScrollRight: ':ncScrollRight',\n\t\t\t\t\tstyleScrollLeft : ':ncScrollLeft',\n\t\t\t\t\toffset          : 0,\n\t\t\t\t}, opts);\n\t\t\t\n\t\t\t\tconst cs = [], ts = [...tabs];\n\t\t\t\tfor (const tab of ts) {\n\t\t\t\t\tconst head = _createHeaderClone(tab, cm);\n\t\t\t\t\tconst bar  = _createBarClone(tab, cm);\n\t\t\t\t\tcs.push({ tab, head, bar });\n\t\t\t\n\t\t\t\t\tlet forced = false;\n\t\t\t\t\tconst el = (tar, op) => throttle(() => {\n\t\t\t\t\t\tif (forced) {\n\t\t\t\t\t\t\tforced = false;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tforced = true;\n\t\t\t\t\t\t\top.scrollLeft = tar.scrollLeft;\n\t\t\t\t\t\t\tif (head) onTableScroll(tab, head, cm);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\ttab.addEventListener('scroll', el(tab, bar));\n\t\t\t\t\tbar.addEventListener('scroll', el(bar, tab));\n\t\t\t\t}\n\t\t\t\tconst ro = new ResizeObserver((es) => {\n\t\t\t\t\tfor (const e of es) {\n\t\t\t\t\t\tconst idx = ts.indexOf(e.target);\n\t\t\t\t\t\tconst c = cs[idx];\n\t\t\t\t\t\tdoResize(e.contentRect, c.tab, c.head, c.bar, cm);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tfor (const t of ts) ro.observe(t);\n\t\t\t\n\t\t\t\twindow.addEventListener('scroll', throttle(() => {\n\t\t\t\t\tfor (const c of cs) onWindowScroll(c.tab, c.head, c.bar, cm);\n\t\t\t\t}), { passive: true });\n\t\t\t\n\t\t\t\tlet st = null;\n\t\t\t\tonResize(() => {\n\t\t\t\t\tcm.offset = getScrollOffset();\n\t\t\t\t\tif (st) clearTimeout(st);\n\t\t\t\t\tst = setTimeout(() => {\n\t\t\t\t\t\tfor (const c of cs) doResize(null, c.tab, c.head, c.bar, cm);\n\t\t\t\t\t}, 100);\n\t\t\t\t}, true);\n\t\t\t}\n\t\t\t\n\t\t\tfunction _createHeaderClone(tab, cm) {\n\t\t\t\tlet thead = tab.tHead;\n\t\t\t\tif (!thead) {\n\t\t\t\t\tthead = _createPseudoHeader(tab);\n\t\t\t\t\tif (!thead) return null;\n\t\t\t\t\ttab.tHead = thead;\n\t\t\t\t}\n\t\t\t\tconst hc = document.createElement('div');\n\t\t\t\tsetClass(hc, cm.styleHeaderContainer);\n\t\t\t\ttab.parentNode.appendChild(hc);\n\t\t\t\n\t\t\t\tconst ht = document.createElement('div');\n\t\t\t\tsetClass(ht, cm.styleHeaderTable);\n\t\t\t\thc.appendChild(ht);\n\t\t\t\n\t\t\t\tht.appendChild(thead.cloneNode(true));\n\t\t\t\treturn hc;\n\t\t\t}\n\t\t\t\n\t\t\tfunction _createPseudoHeader(tab) {\n\t\t\t\tconst trs = tab.tBodies[0].rows;\n\t\t\t\tif (trs.length === 0) return null;\n\t\t\t\n\t\t\t\tfunction containsOnlyTh(tr) {\n\t\t\t\t\tconst tds = tr.getElementsByTagName('td');\n\t\t\t\t\tconst ths = tr.getElementsByTagName('th');\n\t\t\t\t\tif (tds.length === 0 && ths.length > 0) return true;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tconst trsH = [];\n\t\t\t\tfor (const tr of trs) {\n\t\t\t\t\tif (!containsOnlyTh(tr)) break;\n\t\t\t\t\ttrsH.push(tr);\n\t\t\t\t}\n\t\t\t\tif (trsH.length === 0) return null;\n\t\t\t\n\t\t\t\tconst thead = tab.createTHead();\n\t\t\t\tfor (const tr of trsH) thead.appendChild(tr);\n\t\t\t\treturn thead;\n\t\t\t}\n\t\t\t\n\t\t\tfunction _createBarClone(tab, cm) {\n\t\t\t\tconst bar = document.createElement('div');\n\t\t\t\tsetClass(bar, cm.styleScrollBar);\n\t\t\t\tconst spacer = document.createElement('div');\n\t\t\t\tbar.appendChild(spacer);\n\t\t\t\ttab.parentNode.appendChild(bar);\n\t\t\t\treturn bar;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// ---------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction doResize(r, tab, head, bar, cm) {\n\t\t\t\ttab.style.overflowX = (tab.scrollWidth < tab.clientWidth + 2) ? 'hidden' : null;\n\t\t\t\n\t\t\t\tif (head) _updateHeaderSize(r, tab, head, cm);\n\t\t\t\tif (bar) _updateScrollBarSize(tab, bar);\n\t\t\t\tif (head || bar) onWindowScroll(tab, head, bar, cm);\n\t\t\t\tif (head) onTableScroll(tab, head, cm);\n\t\t\t}\n\t\t\t\n\t\t\tfunction _updateHeaderSize(r, tab, head, cm) {\n\t\t\t\tconst tw = r ? r.width : tab.getBoundingClientRect().width;\n\t\t\t\thead.style.maxWidth = tw + 'px';\n\t\t\t\thead.style.display  = 'none';\n\t\t\t\thead.style.top      = cm.offset + 'px';\n\t\t\t\n\t\t\t\tconst thead = tab.tHead;\n\t\t\t\tconst hw = thead.getBoundingClientRect().width;\n\t\t\t\tconst ht = head.firstChild;\n\t\t\t\tht.style.width = hw + 'px';\n\t\t\t\n\t\t\t\tconst oTrs = thead.rows;\n\t\t\t\tconst cTrs = ht.firstChild.rows;\n\t\t\t\tfor (let i = 0; i < oTrs.length; i += 1) {\n\t\t\t\t\tcopyWidth(oTrs[i], cTrs[i], 'td');\n\t\t\t\t\tcopyWidth(oTrs[i], cTrs[i], 'th');\n\t\t\t\t}\n\t\t\t\tfunction copyWidth(o, c, tag) {\n\t\t\t\t\tconst os = o.getElementsByTagName(tag);\n\t\t\t\t\tconst cs = c.getElementsByTagName(tag);\n\t\t\t\t\tfor (let i = 0; i < os.length; i += 1) {\n\t\t\t\t\t\tcs[i].style.width = os[i].getBoundingClientRect().width + 'px';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction _updateScrollBarSize(tab, bar) {\n\t\t\t\tconst disabled = (tab.scrollWidth < tab.clientWidth + 2);\n\t\t\t\tbar.style.overflowX     = disabled ? 'hidden' : null;\n\t\t\t\tbar.style.pointerEvents = disabled ? 'none'   : null;\n\t\t\t\n\t\t\t\tbar.style.maxWidth = `${tab.clientWidth}px`;\n\t\t\t\tbar.style.display = 'none';\n\t\t\t\tconst h = parseInt(getScrollBarWidth(document.documentElement));\n\t\t\t\tif (0 < h) bar.style.height = (h + 2) + 'px';\n\t\t\t\tbar.firstChild.style.width = `${tab.scrollWidth}px`;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// ---------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction onWindowScroll(tab, head, bar, cm) {\n\t\t\t\tconst r = tab.getBoundingClientRect();\n\t\t\t\tconst tBottom = r.bottom;\n\t\t\t\tconst rh = (tab.tHead ?? tab.tBodies[0]).getBoundingClientRect();\n\t\t\t\tconst hTop = rh.top, hBottom = rh.bottom;\n\t\t\t\tconst wY0 = cm.offset, wY1 = window.innerHeight;\n\t\t\t\n\t\t\t\tconst inView = tBottom - hTop < cm.capableWindowHeightRate * (wY1 - wY0);\n\t\t\t\tconst tLeft = r.left, tScrollLeft = tab.scrollLeft;\n\t\t\t\tif (head) {\n\t\t\t\t\tconst hCy = tab.tHead.offsetHeight;\n\t\t\t\t\tconst f = (!inView && hTop < wY0 && wY0 < tBottom - hCy);\n\t\t\t\t\t_updateHeaderVisibility(head, f, tLeft, tScrollLeft);\n\t\t\t\t}\n\t\t\t\tif (bar) {\n\t\t\t\t\tconst f = (!inView && hBottom < wY1 && wY1 < tBottom);\n\t\t\t\t\t_updateBarVisibility(bar, f, tLeft, tScrollLeft);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction _updateHeaderVisibility(head, visible, tabLeft, tabScrollLeft) {\n\t\t\t\thead.style.display = visible ? 'block' : 'none';\n\t\t\t\thead.style.left    = tabLeft + 'px';\n\t\t\t\thead.scrollLeft    = tabScrollLeft;\n\t\t\t}\n\t\t\t\n\t\t\tfunction _updateBarVisibility(bar, visible, tabLeft, tabScrollLeft) {\n\t\t\t\tbar.style.display = visible ? 'block' : 'none';\n\t\t\t\tbar.style.left    = tabLeft + 'px';\n\t\t\t\tbar.scrollLeft    = tabScrollLeft;\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// ---------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction onTableScroll(tab, head, cm) {\n\t\t\t\tconst sL = Math.max(0, Math.min(tab.scrollLeft, tab.scrollWidth - tab.offsetWidth));  // for iOS\n\t\t\t\thead.scrollLeft = sL;\n\t\t\t\n\t\t\t\tif (tab.scrollWidth - tab.clientWidth > 2) {  // for avoiding needless scrolling\n\t\t\t\t\tconst r = tab.scrollLeft / (tab.scrollWidth - tab.clientWidth);\n\t\t\t\t\tsetClass(head, cm.styleScrollRight, r < 0.95);\n\t\t\t\t\tsetClass(head, cm.styleScrollLeft, 0.05 < r);\n\t\t\t\t} else {\n\t\t\t\t\tsetClass(head, cm.styleScrollRight, false);\n\t\t\t\t\tsetClass(head, cm.styleScrollLeft, false);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// Utilities ---------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction getScrollBarWidth(parent) {\n\t\t\t\tconst d = document.createElement('div');\n\t\t\t\td.setAttribute('style', 'position:absolute;bottom:100%;width:calc(100vw - 100%);height:1px;');\n\t\t\t\tparent.appendChild(d);\n\t\t\t\tlet width = 0 | window.getComputedStyle(d).getPropertyValue('width');\n\t\t\t\n\t\t\t\tif (width === 0) {  // Window does not have any scroll bar\n\t\t\t\t\td.style.overflowY = 'scroll';\n\t\t\t\t\td.style.width = '';\n\t\t\t\t\tconst c = document.createElement('div');\n\t\t\t\t\tc.style.minHeight = '100px';\n\t\t\t\t\td.appendChild(c);\n\t\t\t\t\tconst cw = 0 | window.getComputedStyle(c).getPropertyValue('width');\n\t\t\t\t\twidth = d.offsetWidth - cw;\n\t\t\t\t}\n\t\t\t\tparent.removeChild(d);\n\t\t\t\treturn width;\n\t\t\t}\n\t\t\tNS.tableUsableView = initialize;\n\t\t}\n\t}\n\n\t// Utility (Query) ---------------------------------------------------------\n\n\t{\n\t\t/**\n\t\t *\n\t\t * Inner\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-11-25\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction getBreakPointSize() {\n\t\t\tlet bpW, bpH;\n\t\t\n\t\t\tconst w = window.innerWidth;\n\t\t\tif (w < 450) {\n\t\t\t\tbpW = 'phone-portrait';\n\t\t\t} else if (w < 600) {\n\t\t\t\tbpW = 'phone-landscape';\n\t\t\t} else if (w < 900) {\n\t\t\t\tbpW = 'tablet-portrait';\n\t\t\t} else if (w < 1200) {\n\t\t\t\tbpW = 'tablet-landscape';\n\t\t\t} else if (w < 1500) {\n\t\t\t\tbpW = 'desktop';\n\t\t\t} else {\n\t\t\t\tbpW = 'big-desktop';\n\t\t\t}\n\t\t\tconst h = window.innerHeight;\n\t\t\tif (h < 700) {\n\t\t\t\tbpH = 'tiny';\n\t\t\t} else if (h < 800) {\n\t\t\t\tbpH = 'small';\n\t\t\t} else if (h < 900) {\n\t\t\t\tbpH = 'medium';\n\t\t\t} else {\n\t\t\t\tbpH = 'large';\n\t\t\t}\n\t\t\treturn [bpW, bpH];\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction getBrowser() {\n\t\t\tconst ua = window.navigator.userAgent.toLowerCase();\n\t\t\tif (ua.includes('chrome')) {  // UA includes 'safari'.\n\t\t\t\treturn 'chrome';\n\t\t\t}\n\t\t\tif (ua.includes('safari')) {\n\t\t\t\treturn 'safari';\n\t\t\t}\n\t\t\tif (ua.includes('firefox')) {\n\t\t\t\treturn 'firefox';\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction getDevice() {\n\t\t\tconst ua = window.navigator.userAgent.toLowerCase();\n\t\t\n\t\t\tconst ret = [];\n\t\t\tif (ua.includes('android')) {\n\t\t\t\tret.push('android');\n\t\t\t}\n\t\t\tif (ua.includes('iphone')) {\n\t\t\t\tret.push('ios');\n\t\t\t\tret.push('iphone');\n\t\t\t} else if (ua.includes('ipad')) {\n\t\t\t\tret.push('ios');\n\t\t\t\tret.push('ipad');\n\t\t\t} else if (ua.includes('safari') && !ua.includes('chrome') && 'ontouchend' in document) {\n\t\t\t\tret.push('ios');\n\t\t\t\tret.push('ipad');\n\t\t\t\tret.push('ipad-desktop');\n\t\t\t}\n\t\t\tif (!ret.length) {\n\t\t\t\tret.push('desktop');\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\t\t\n\t\tNS['BROWSER'] = getBrowser();\n\t\tNS['DEVICE']  = getDevice();\n\n\t\tonResize(() => {\n\t\t\t[NS['BP_WIDTH'], NS['BP_HEIGHT']] = getBreakPointSize();\n\t\t}, true);\n\t}\n\n\t// Viewer ------------------------------------------------------------------\n\n\t{\n\t\t/**\n\t\t *\n\t\t * Dialog\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-11-18\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction initialize(fs, opts = {}) {\n\t\t\tif (fs.length === 0) return;\n\t\t\n\t\t\topts = Object.assign({\n\t\t\t\tstyleRoot   : ':ncViewer',\n\t\t\t\tstyleCloser : ':ncViewerCloser',\n\t\t\t\tstylePrev   : ':ncViewerPrev',\n\t\t\t\tstyleNext   : ':ncViewerNext',\n\t\t\t\tstyleCaption: ':ncViewerCaption',\n\t\t\n\t\t\t\tstyleOpen     : ':ncOpen',\n\t\t\t\tstyleVisible  : ':ncVisible',\n\t\t\t\tstyleInstantly: ':ncInstantly',\n\t\t\n\t\t\t\thashPrefix: 'viewer:',\n\t\t\t}, opts);\n\t\t\n\t\t\tconst is = fs.map(f => {\n\t\t\t\tconst inst = createViewer(opts, f.hash, f.frameInst, f.frame, f.caption);\n\t\t\t\tf.opener.addEventListener('click', e => _onOpen(inst, e));\n\t\t\t\treturn inst;\n\t\t\t});\n\t\t\tassignEventHandler(is);\n\t\t\tprocessHash(is, opts['hashPrefix']);\n\t\t}\n\t\t\n\t\tfunction assignEventHandler(is) {\n\t\t\tonResize(() => {\n\t\t\t\tfor (const inst of is) inst.fi.doResize();\n\t\t\t\tsetTimeout(() => { for (const inst of is) inst.fi.doResize(); }, 200);\n\t\t\t});\n\t\t\twindow.addEventListener('keydown', e => {\n\t\t\t\tif (currentId !== null && !e.altKey && !e.ctrlKey && !e.shiftKey) {\n\t\t\t\t\tconst cur = is[currentId];\n\t\t\t\t\tif (e.key === 'Escape') cur.dlg.click();\n\t\t\t\t\telse if (e.key === 'ArrowLeft') cur.btnPrev.click();\n\t\t\t\t\telse if (e.key === 'ArrowRight') cur.btnNext.click();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\t\n\t\tfunction processHash(is, hashPrefix) {\n\t\t\twindow.addEventListener('popstate', e => {\n\t\t\t\tif (currentId !== null) doClose(is[currentId]);\n\t\t\t\tif (e.state && e.state['name'] === 'nc-viewer' && e.state['id'] !== undefined) {\n\t\t\t\t\tdoOpen(is[e.state['id']]);\n\t\t\t\t}\n\t\t\t});\n\t\t\twindow.addEventListener('hashchange', () => checkHash(is, hashPrefix, location.hash));\n\t\t\tcheckHash(is, hashPrefix, location.hash);\n\t\t}\n\t\t\n\t\tfunction checkHash(is, hashPrefix, hash) {\n\t\t\tif (location.hash.indexOf('#' + hashPrefix) !== 0) return;\n\t\t\tconst ih = hash.replace('#' + hashPrefix, '');\n\t\t\tif (!ih) return;\n\t\t\tfor (let i = 0; i < is.length; i += 1) {\n\t\t\t\tif (is[i].hash === ih) {\n\t\t\t\t\tif (currentId !== null && currentId !== i) doClose(is[currentId]);\n\t\t\t\t\tif (currentId === null || currentId !== i) doOpen(is[i]);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tlet instanceCount = 0;\n\t\tlet prevInstance  = null;\n\t\tlet currentId     = null;\n\t\t\n\t\tfunction createViewer(opts, hash, frameInst, frame, caption = null) {\n\t\t\tconst inst = {};\n\t\t\tinst.opts = opts;\n\t\t\tinst.fi   = frameInst;\n\t\t\tinst.id   = instanceCount++;\n\t\t\tinst.hash = hash;\n\t\t\n\t\t\tinst.dlg = document.createElement('div');\n\t\t\tsetClass(inst.dlg, opts.styleRoot);\n\t\t\tinst.dlg.addEventListener('click', e => _onClose(e));\n\t\t\tinst.dlg.appendChild(frame);\n\t\t\n\t\t\tconst btn = document.createElement('button');\n\t\t\tsetClass(btn, opts.styleCloser);\n\t\t\tinst.dlg.appendChild(btn);\n\t\t\n\t\t\tinst.btnPrev = document.createElement('button');\n\t\t\tinst.btnNext = document.createElement('button');\n\t\t\tsetClass(inst.btnPrev, opts.stylePrev);\n\t\t\tsetClass(inst.btnNext, opts.styleNext);\n\t\t\tinst.dlg.appendChild(inst.btnPrev);\n\t\t\tinst.dlg.appendChild(inst.btnNext);\n\t\t\n\t\t\tif (caption) {\n\t\t\t\tconst divCap = document.createElement('div');\n\t\t\t\tdivCap.innerHTML = `<span>${caption}</span>`;\n\t\t\t\tsetClass(divCap, opts.styleCaption);\n\t\t\t\tinst.dlg.appendChild(divCap);\n\t\t\t}\n\t\t\tdocument.body.appendChild(inst.dlg);\n\t\t\n\t\t\t_setAdjacentInstance(inst, prevInstance);\n\t\t\tprevInstance = inst;\n\t\t\treturn inst;\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction doOpen(inst, instantly = false) {\n\t\t\tsetClass(inst.dlg, inst.opts.styleOpen);\n\t\t\tinst.fi.doOpen();\n\t\t\n\t\t\tif (instantly) {\n\t\t\t\tinst.fi.doResize();\n\t\t\t\tsetClass(inst.dlg, inst.opts.styleInstantly);\n\t\t\t\tsetClass(inst.dlg, inst.opts.styleVisible);\n\t\t\t\tsetTimeout(() => { setClass(inst.dlg, inst.opts.styleInstantly, false); }, 20);\n\t\t\n\t\t\t\tconst url = '#' + inst.opts.hashPrefix + inst.hash;\n\t\t\t\thistory.replaceState(null, '', url);\n\t\t\t} else {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tinst.fi.doResize();\n\t\t\t\t\tsetClass(inst.dlg, inst.opts.styleVisible);\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t\tcurrentId = inst.id;\n\t\t}\n\t\t\n\t\tfunction doClose(inst, instantly = false) {\n\t\t\tinst.fi.doClose();\n\t\t\n\t\t\tif (instantly) {\n\t\t\t\tsetClass(inst.dlg, inst.opts.styleInstantly);\n\t\t\t\tsetClass(inst.dlg, inst.opts.styleVisible, false);\n\t\t\t\tsetTimeout(() => { setClass(inst.dlg, inst.opts.styleInstantly, false); }, 20);\n\t\t\t} else {\n\t\t\t\tsetClass(inst.dlg, inst.opts.styleVisible, false);\n\t\t\t}\n\t\t\tsetTimeout(() => { setClass(inst.dlg, inst.opts.styleOpen, false); }, 200);\n\t\t\tcurrentId = null;\n\t\t}\n\t\t\n\t\t\n\t\t// -----------------------------------------------------------------------------\n\t\t\n\t\t\n\t\tfunction _setAdjacentInstance(inst, prev) {\n\t\t\tinst.btnNext.style.display = 'none';\n\t\t\tif (prev) {\n\t\t\t\tinst.btnPrev.addEventListener('click', e => {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\tdoClose(inst, true);\n\t\t\t\t\tdoOpen(prev, true);\n\t\t\t\t});\n\t\t\t\t_setNextInstance(prev, inst);\n\t\t\t} else {\n\t\t\t\tinst.btnPrev.style.display = 'none';\n\t\t\t}\n\t\t}\n\t\t\n\t\tfunction _setNextInstance(inst, next) {\n\t\t\tinst.btnNext.addEventListener('click', e => {\n\t\t\t\te.stopPropagation();\n\t\t\t\tdoClose(inst, true);\n\t\t\t\tdoOpen(next, true);\n\t\t\t});\n\t\t\tinst.btnNext.style.display = null;\n\t\t}\n\t\t\n\t\tfunction _onOpen(inst, e) {\n\t\t\te.preventDefault();\n\t\t\tdoOpen(inst);\n\t\t\n\t\t\tif (location.hash) {\n\t\t\t\tconst newUrl = location.href.substr(0, location.href.indexOf('#'));\n\t\t\t\thistory.replaceState(null, '', newUrl);\n\t\t\t}\n\t\t\tconst url = '#' + inst.opts.hashPrefix + inst.hash;\n\t\t\thistory.pushState({ name: 'nc-viewer', id: inst.id }, null, url);\n\t\t}\n\t\t\n\t\tfunction _onClose(e) {\n\t\t\te.preventDefault();\n\t\t\thistory.back();\n\t\t}\n\t\t\n\t\t/**\n\t\t *\n\t\t * Functions for Hash\n\t\t *\n\t\t * @author Takuto Yanagida\n\t\t * @version 2021-10-15\n\t\t *\n\t\t */\n\t\t\n\t\t\n\t\tfunction calcHash(str, asHex = true) {\n\t\t\tlet h = 0x811c9dc5;\n\t\t\tfor (let i = 0; i < str.length; i += 1) {\n\t\t\t\th ^= str.charCodeAt(i);\n\t\t\t\th += (h << 1) + (h << 4) + (h << 7) + (h << 8) + (h << 24);\n\t\t\t}\n\t\t\tif (asHex) return ('0000000' + (h >>> 0).toString(16)).substr(-8);\n\t\t\treturn h >>> 0;\n\t\t}\n\t\t\n\n\t\t{\n\t\t\t/**\n\t\t\t *\n\t\t\t * Functions for Touch Support\n\t\t\t *\n\t\t\t * @author Takuto Yanagida\n\t\t\t * @version 2021-10-18\n\t\t\t *\n\t\t\t */\n\t\t\t\n\t\t\t\n\t\t\tfunction getTouchPoint(ts) {\n\t\t\t\tconst pxo = window.pageXOffset, pyo = window.pageYOffset;\n\t\t\t\tlet x = 0, y = 0;\n\t\t\t\tif (ts.length === 1) {\n\t\t\t\t\tx = ts[0].pageX - pxo;\n\t\t\t\t\ty = ts[0].pageY - pyo;\n\t\t\t\t} else if (2 <= ts.length) {\n\t\t\t\t\tx = (ts[0].pageX + ts[1].pageX) / 2 - pxo;\n\t\t\t\t\ty = (ts[0].pageY + ts[1].pageY) / 2 - pyo\n\t\t\t\t}\n\t\t\t\treturn [x, y];\n\t\t\t}\n\t\t\t\n\t\t\tfunction touchDistance(ts) {\n\t\t\t\tconst x1 = ts[0].screenX, y1 = ts[0].screenY;\n\t\t\t\tconst x2 = ts[1].screenX, y2 = ts[1].screenY;\n\t\t\t\treturn Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\n\t\t\t}\n\t\t\t\n\t\t\tfunction preventWindowTouchMove(f) {\n\t\t\t\tlet isTouching = false;\n\t\t\t\twindow.addEventListener('touchmove', (e) => {\n\t\t\t\t\tif (!isTouching) return;\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopImmediatePropagation();\n\t\t\t\t}, { passive: false });\n\t\t\t\tf.addEventListener('touchstart', () => { isTouching = true; });\n\t\t\t\tf.addEventListener('touchend', () => { isTouching = false; });\n\t\t\t}\n\t\t\t\n\t\t\tfunction getCursorPoint(e) {\n\t\t\t\treturn [e.pageX - window.pageXOffset, e.pageY - window.pageYOffset];\n\t\t\t}\n\t\t\t\n\t\t\t/**\n\t\t\t *\n\t\t\t * Image Viewer\n\t\t\t *\n\t\t\t * @author Takuto Yanagida\n\t\t\t * @version 2021-11-18\n\t\t\t *\n\t\t\t */\n\t\t\t\n\t\t\t\n\t\t\tfunction initializeImageViewer(as, opts = {}) {\n\t\t\t\tif (as.length === 0) return;\n\t\t\t\n\t\t\t\topts = Object.assign({\n\t\t\t\t\tstyleOpener       : ':ncViewerOpener',\n\t\t\t\t\tstyleOpenerWrapper: ':ncViewerOpenerWrapper',\n\t\t\t\t}, opts);\n\t\t\t\n\t\t\t\tconst fs = as.map(a => {\n\t\t\t\t\tconst hash = calcHash(a.href);\n\t\t\t\t\tconst [frameInst, frame] = createImageFrame(opts, a.href);\n\t\t\t\t\tconst caption = extractImageCaption(a);\n\t\t\t\t\tassignImageOpenerStyle(a, opts['styleOpener'], opts['styleOpenerWrapper']);\n\t\t\t\n\t\t\t\t\treturn { opener: a, hash, frameInst, frame, caption };\n\t\t\t\t});\n\t\t\t\tinitialize(fs, opts);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -----------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction createImageFrame(opts, src) {\n\t\t\t\topts = Object.assign({\n\t\t\t\t\tstyleImageFrame: ':ncFrameImage',\n\t\t\t\t\tstyleLoaded    : ':ncLoaded',\n\t\t\t\t\tmaxZoomRate    : 10,\n\t\t\t\t}, opts);\n\t\t\t\n\t\t\t\tconst inst = {\n\t\t\t\t\topts, src,\n\t\t\t\n\t\t\t\t\tscale    : 1,\n\t\t\t\t\trealScale: 1,\n\t\t\t\t\tbaseSize : null,\n\t\t\t\t\tisLs     : false,\n\t\t\t\t\tmargin   : 0,\n\t\t\t\n\t\t\t\t\tfrm: null,\n\t\t\t\t\timg: null,\n\t\t\t\t};\n\t\t\t\n\t\t\t\tinst.frm = document.createElement('div');\n\t\t\t\tsetClass(inst.frm, inst.opts.styleImageFrame);\n\t\t\t\n\t\t\t\tinst.img = document.createElement('img');\n\t\t\t\tinst.img.addEventListener('click', e => e.stopPropagation());\n\t\t\t\tinst.frm.appendChild(inst.img);\n\t\t\t\n\t\t\t\t_enableMouseGesture(inst, inst.frm);\n\t\t\t\t_enableTouchGesture(inst, inst.frm);\n\t\t\t\n\t\t\t\tinst['doResize'] = () => setSize(inst);\n\t\t\t\tinst['doOpen']   = () => setSource(inst);\n\t\t\t\tinst['doClose']  = () => {};\n\t\t\t\treturn [inst, inst.frm];\n\t\t\t}\n\t\t\t\n\t\t\tfunction extractImageCaption(a) {\n\t\t\t\tif (a.parentNode.tagName === 'FIGURE') {\n\t\t\t\t\tconst fcs = a.parentNode.getElementsByTagName('figcaption');\n\t\t\t\t\tif (0 < fcs.length) {\n\t\t\t\t\t\treturn fcs[0].innerHTML;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t\n\t\t\tfunction assignImageOpenerStyle(a, styleOpener, styleOpenerWrapper) {\n\t\t\t\tsetClass(a, styleOpener);\n\t\t\t\tif (a.parentNode.tagName === 'FIGURE') {\n\t\t\t\t\tsetClass(a.parentNode, styleOpenerWrapper);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -----------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction setSize(inst) {\n\t\t\t\tconst winAs = inst.frm.offsetWidth / inst.frm.offsetHeight;\n\t\t\t\tconst imgAs = inst.img.offsetWidth / inst.img.offsetHeight;\n\t\t\t\tinst.isLs = (winAs < imgAs);\n\t\t\t\n\t\t\t\tconst cs = getComputedStyle(inst.img);\n\t\t\t\tinst.margin = parseInt(cs.outlineWidth) * 2;\n\t\t\t\n\t\t\t\tconst s = inst.img.style;\n\t\t\t\ts.minWidth  = '';\n\t\t\t\ts.minHeight = '';\n\t\t\t\tif (inst.isLs) {\n\t\t\t\t\ts.width  = `calc(100% - ${inst.margin}px)`;\n\t\t\t\t\ts.height = 'auto';\n\t\t\t\t} else {\n\t\t\t\t\ts.width    = 'auto';\n\t\t\t\t\ts.height   = `calc(100% - ${inst.margin}px)`;\n\t\t\t\t\ts.maxWidth = 'none';\n\t\t\t\t}\n\t\t\t\n\t\t\t\tinst.baseSize = inst.isLs ? inst.frm.clientWidth  : inst.frm.clientHeight;\n\t\t\t\tconst nbs     = inst.isLs ? inst.img.naturalWidth : inst.img.naturalHeight;\n\t\t\t\n\t\t\t\tinst.realScale = nbs / inst.baseSize;\n\t\t\t\tinst.scale     = 1;\n\t\t\t\t_doCenteringImage(inst.frm, inst.img);\n\t\t\t}\n\t\t\t\n\t\t\tfunction setSource(inst) {\n\t\t\t\tconst img = inst.img;\n\t\t\t\tif (!img.src) {\n\t\t\t\t\timg.style.opacity = '0';\n\t\t\t\t\timg.src = inst.src;\n\t\t\t\t\timg.addEventListener('load', () => {\n\t\t\t\t\t\tsetSize(inst);\n\t\t\t\t\t\tsetClass(inst.frm, inst.opts.styleLoaded);\n\t\t\t\t\t\tsetTimeout(() => { img.style.opacity = '1'; }, 0);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -----------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction _setScaledSize(inst, scale) {\n\t\t\t\tinst.scale = Math.max(1, Math.min(inst.opts.maxZoomRate, scale));\n\t\t\t\n\t\t\t\tconst size = (inst.baseSize * inst.scale - inst.margin) + 'px';\n\t\t\t\tif (inst.isLs) {\n\t\t\t\t\tinst.img.style.minWidth = size;\n\t\t\t\t} else {\n\t\t\t\t\tinst.img.style.minHeight = size;\n\t\t\t\t}\n\t\t\t\t_doCenteringImage(inst.frm, inst.img);\n\t\t\t}\n\t\t\t\n\t\t\tfunction _doCenteringImage(frm, img) {\n\t\t\t\tconst imgW = img.offsetWidth, imgH = img.offsetHeight;\n\t\t\t\tconst frmW = frm.clientWidth, frmH = frm.clientHeight;\n\t\t\t\tconst s = img.style;\n\t\t\t\ts.left = (imgW < frmW) ? (((frmW - imgW) / 2) + 'px') : 0;\n\t\t\t\ts.top  = (imgH < frmH) ? (((frmH - imgH) / 2) + 'px') : 0;\n\t\t\t}\n\t\t\t\n\t\t\tfunction _enableMouseGesture(inst, frm) {\n\t\t\t\tlet xS = 0, yS = 0;\n\t\t\t\tlet isMoving = false;\n\t\t\t\n\t\t\t\tfrm.addEventListener('mousedown', e => {\n\t\t\t\t\tif (e.button) return;  // when button is not left\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\t[xS, yS] = getCursorPoint(e);\n\t\t\t\t\tisMoving = true;\n\t\t\t\t});\n\t\t\t\tfrm.addEventListener('mousemove', e => {\n\t\t\t\t\tif (!isMoving) return;\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\n\t\t\t\t\tconst [cx, cy] = getCursorPoint(e);\n\t\t\t\t\tfrm.scrollLeft += xS - cx;\n\t\t\t\t\tfrm.scrollTop  += yS - cy;\n\t\t\t\t\txS = cx;\n\t\t\t\t\tyS = cy;\n\t\t\t\t});\n\t\t\t\tfrm.addEventListener('mousedrag', e => {\n\t\t\t\t\tif (!isMoving) return;\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t});\n\t\t\t\tfrm.addEventListener('mouseup', () => { isMoving = false; });\n\t\t\t\n\t\t\t\tfrm.addEventListener('wheel', e => {\n\t\t\t\t\tconst s = 0 > e.deltaY ? 1.1 : 0.9;\n\t\t\t\t\tzoomListener(e, inst.scale * s);\n\t\t\t\t}, true);\n\t\t\t\tfrm.addEventListener('dblclick', e => {\n\t\t\t\t\tif (inst.realScale < 1) return;\n\t\t\t\t\tzoomListener(e, inst.scale < inst.realScale ? inst.realScale : 1);\n\t\t\t\t}, true);\n\t\t\t\n\t\t\t\tfunction zoomListener(e, scale) {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\n\t\t\t\t\tconst [cx, cy] = getCursorPoint(e);\n\t\t\t\t\tconst ix = (cx + frm.scrollLeft) / inst.scale;\n\t\t\t\t\tconst iy = (cy + frm.scrollTop)  / inst.scale;\n\t\t\t\n\t\t\t\t\t_setScaledSize(inst, scale);\n\t\t\t\n\t\t\t\t\tfrm.scrollLeft = ix * inst.scale - cx;\n\t\t\t\t\tfrm.scrollTop  = iy * inst.scale - cy;\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction _enableTouchGesture(inst, frm) {\n\t\t\t\tlet ix = 0, iy = 0;\n\t\t\t\tlet lastTouchCount = 0;\n\t\t\t\tlet baseDist = 0;\n\t\t\t\n\t\t\t\tpreventWindowTouchMove(frm);  // for Android\n\t\t\t\n\t\t\t\tfrm.addEventListener('touchstart', e => {\n\t\t\t\t\tbaseDist = 0;\n\t\t\t\t\tupdatePoint(e.touches);\n\t\t\t\t});\n\t\t\t\tfrm.addEventListener('touchmove', e => {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\t\t\t\n\t\t\t\t\tconst ts = e.touches;\n\t\t\t\t\tif (lastTouchCount !== ts.length) {\n\t\t\t\t\t\tupdatePoint(ts);\n\t\t\t\t\t}\n\t\t\t\t\tconst [cx, cy] = getTouchPoint(ts);\n\t\t\t\n\t\t\t\t\tif (2 <= ts.length) {\n\t\t\t\t\t\tconst dist = touchDistance(ts);\n\t\t\t\t\t\tif (baseDist) {\n\t\t\t\t\t\t\tconst s = dist / (baseDist * inst.scale);\n\t\t\t\t\t\t\tif (s && s !== Infinity) {\n\t\t\t\t\t\t\t\t_setScaledSize(inst, inst.scale * s);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfrm.scrollLeft = ix * inst.scale - cx;\n\t\t\t\t\t\t\tfrm.scrollTop  = iy * inst.scale - cy;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbaseDist = dist / inst.scale;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfrm.scrollLeft = ix * inst.scale - cx;\n\t\t\t\t\t\tfrm.scrollTop  = iy * inst.scale - cy;\n\t\t\t\t\t}\n\t\t\t\t}, { passive: false });\n\t\t\t\n\t\t\t\tfunction touchPointToImagePoint(x, y) {\n\t\t\t\t\tconst fsx = frm.scrollLeft;\n\t\t\t\t\tconst fsy = frm.scrollTop;\n\t\t\t\t\tconst ix = (x + fsx) / inst.scale;\n\t\t\t\t\tconst iy = (y + fsy) / inst.scale;\n\t\t\t\t\treturn [ix, iy];\n\t\t\t\t}\n\t\t\t\n\t\t\t\tfunction updatePoint(ts) {\n\t\t\t\t\tlastTouchCount = ts.length;\n\t\t\t\t\t[ix, iy] = touchPointToImagePoint(...getTouchPoint(ts));\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tNS.viewerImage = initializeImageViewer;\n\t\t}\n\n\t\t{\n\t\t\t/**\n\t\t\t *\n\t\t\t * Iframe Viewer\n\t\t\t *\n\t\t\t * @author Takuto Yanagida\n\t\t\t * @version 2021-11-19\n\t\t\t *\n\t\t\t */\n\t\t\t\n\t\t\t\n\t\t\tfunction initializeIframeViewer(os, ifms, opts = {}) {\n\t\t\t\tif (os.length === 0) return;\n\t\t\t\n\t\t\t\topts = Object.assign({\n\t\t\t\t\tstyleOpener       : ':ncViewerOpener',\n\t\t\t\t\tstyleOpenerWrapper: ':ncViewerOpenerWrapper',\n\t\t\t\t}, opts);\n\t\t\t\n\t\t\t\tconst fs = os.map((o, i) => {\n\t\t\t\t\tconst hash = calcHash(ifms[i].src);\n\t\t\t\t\tconst [frameInst, frame] = createIframeFrame(opts, ifms[i]);\n\t\t\t\t\tassignIframeOpenerStyle(o, opts['styleOpener']);\n\t\t\t\n\t\t\t\t\treturn { opener: o, hash, frameInst, frame, caption: null };\n\t\t\t\t});\n\t\t\t\tinitialize(fs, opts);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -----------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction createIframeFrame(opts, ifm) {\n\t\t\t\topts = Object.assign({\n\t\t\t\t\tstyleIframeFrame: ':ncFrameIframe',\n\t\t\t\t\tstyleLoaded     : ':ncLoaded',\n\t\t\t\t}, opts);\n\t\t\t\n\t\t\t\tconst src = filterSource(ifm.src);\n\t\t\t\n\t\t\t\tifm.removeAttribute('src');\n\t\t\t\tifm.setAttribute('data-nc-lazy', '');\n\t\t\t\tif (!ifm.style.aspectRatio) {\n\t\t\t\t\tconst [w, h] = extractIframeSize(ifm);\n\t\t\t\t\tif (w && h) {\n\t\t\t\t\t\tifm.style.aspectRatio = `${w} / ${h}`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\n\t\t\t\tconst inst = {\n\t\t\t\t\topts, src, ifm,\n\t\t\t\n\t\t\t\t\tscale    : 1,\n\t\t\t\t\trealScale: 1,\n\t\t\t\t\tbaseSize : null,\n\t\t\t\t\tisLs     : false,\n\t\t\t\t\tmargin   : 0,\n\t\t\t\n\t\t\t\t\tfrm: null,\n\t\t\t\t};\n\t\t\t\n\t\t\t\tinst.frm = document.createElement('div');\n\t\t\t\tsetClass(inst.frm, inst.opts.styleIframeFrame);\n\t\t\t\n\t\t\t\tinst.ifm.addEventListener('click', e => e.stopPropagation());\n\t\t\t\tinst.frm.appendChild(inst.ifm);\n\t\t\t\n\t\t\t\tinst['doResize'] = () => {};\n\t\t\t\tinst['doOpen']   = () => setSource(inst);\n\t\t\t\tinst['doClose']  = () => pause(inst);\n\t\t\t\treturn [inst, inst.frm];\n\t\t\t}\n\t\t\t\n\t\t\tfunction assignIframeOpenerStyle(o, styleOpener) {\n\t\t\t\tsetClass(o, styleOpener);\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -----------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction setSource(inst) {\n\t\t\t\tconst ifm = inst.ifm;\n\t\t\t\tif (ifm.hasAttribute('data-nc-lazy')) {\n\t\t\t\t\tifm.removeAttribute('data-nc-lazy');\n\t\t\t\t\tifm.style.opacity = '0';\n\t\t\t\t\tifm.addEventListener('load', () => {\n\t\t\t\t\t\tsetClass(inst.frm, inst.opts.styleLoaded);\n\t\t\t\t\t\tsetTimeout(() => { ifm.style.opacity = '1'; }, 0);\n\t\t\t\t\t});\n\t\t\t\t\tifm.contentDocument.location.replace(inst.src);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tfunction pause(inst) {\n\t\t\t\tif (inst.src.startsWith('https://www.youtube.com')) {\n\t\t\t\t\tinst.ifm.contentWindow.postMessage('{\"event\":\"command\",\"func\":\"pauseVideo\",\"args\":\"\"}', '*');\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t\n\t\t\t// -----------------------------------------------------------------------------\n\t\t\t\n\t\t\t\n\t\t\tfunction filterSource(src) {\n\t\t\t\tif (src.startsWith('https://www.youtube.com')) {\n\t\t\t\t\tconst url = new URL(src);\n\t\t\t\t\tconst ps  = new URLSearchParams(url.search);\n\t\t\t\t\tps.append('enablejsapi', 1);\n\t\t\t\t\turl.search = ps;\n\t\t\t\t\tsrc = url.toString();\n\t\t\t\t}\n\t\t\t\treturn src;\n\t\t\t}\n\t\t\t\n\t\t\tfunction extractIframeSize(f) {\n\t\t\t\tlet w = parseInt(f.width);\n\t\t\t\tlet h = parseInt(f.height);\n\t\t\t\tif (w && h) return [w, h];\n\t\t\t\n\t\t\t\tconst sW = f.style.width;\n\t\t\t\tconst sH = f.style.height;\n\t\t\t\tif (sW.indexOf('px') !== sW.length - 2) return [0, 0];\n\t\t\t\tif (sH.indexOf('px') !== sH.length - 2) return [0, 0];\n\t\t\t\tw = parseInt(sW);\n\t\t\t\th = parseInt(sH);\n\t\t\t\tif (w && h) return [w, h];\n\t\t\t\treturn [0, 0];\n\t\t\t}\n\t\t\t\n\t\t\tNS.viewerIframe = initializeIframeViewer;\n\t\t}\n\t}\n\n})(window['NACSS']);\n"]}